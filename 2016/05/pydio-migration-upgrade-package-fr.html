<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Pydio : migration, upgrade, package [FR]
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="../../theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../../theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../theme/css/main.css">

    <link rel="stylesheet" href="../../theme/css/blog.css">
    <link rel="stylesheet" href="../../theme/css/github.css">
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aldevar - Le Blog Atom Feed" />
        <script src="../../theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
        <a id="site-title" href="../.."><h1><i class="icon-coffee"></i> Aldevar - Le Blog</h1></a>
        <p id="site-desc"> Un Blog IT </p>
    </hgroup>
    <nav>
        <ul id="nav-links">
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2016-05-27T23:02:00+02:00" pubdate>
                            Fri 27 May 2016
                        </time>
                        <a href="../../2016/05/pydio-migration-upgrade-package-fr.html" rel="bookmark"><h1>Pydio : migration, upgrade, package [FR]</h1></a>
                    </header>

                    <section class="post-content">
                        <p>The article is also available <a class="reference external" href="http://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-en/">in
english</a>.</p>
<p>Sous ce titre peu clair se cache une opération de que je viens de mener
afin d'opérer 3 opérations sur une instance pydio. Pour mettre les
choses dans leur contexte, Pydio était installé via l'archive tar.gz,
sur un serveur CentOS 6 et la version utilisée était la 6.0.7.</p>
<p>L'objectif initial est de mettre à jour Pydio en version 6.4.
Malheureusement, la version de php nécessaire n'est pas présente dans
Centos 6 (sauf via des dépôts externe que je ne souhaitais pas
utiliser). La première étape est donc de monter une nouvelle VM Centos7
puis d'installer Pydio avec yum via le dépôt Pydio et d'importer
l'ancienne configuration dans cette nouvelle instance.</p>
<p>Installer Pydio via le gestionnaire de paquet permet de plus facilement
le mettre à jour et facilite également l'automation &nbsp;pour un déploiement
automatique de Pydio ainsi que la gestion des plugins.</p>
<p>Ce sont ces étapes que je vais détailler ici.</p>
<p>Installation de mariadb et httpd</p>
<pre class="code sh literal-block">
yum install -y mariadb mariadb-server
systemctl start mariadb.service
systemctl <span class="nb">enable</span> mariadb.service
mysql_secure_installation
yum install httpd
systemctl <span class="nb">enable</span> httpd.service
systemctl start httpd.service
</pre>
<p>Installation des dépendances pour Pydio :</p>
<pre class="code literal-block">
yum -y install php php-gd php-ldap php-pear php-xml php-xmlrpc php-mbstring curl php-mcrypt* php-mysql
</pre>
<p>Installation des dépots Pydio</p>
<pre class="code literal-block">
wget https://download.pydio.com/pub/linux/centos/7/pydio-release-1-1.el7.centos.noarch.rpm
</pre>
<p>Si vous avez une licence pydio (gratuit jusqu'à 10 utilisateurs), vous
devez aussi récupérer le dépot enterprise</p>
<pre class="code literal-block">
wget https://API_KEY:API_SECRET&#64;download.pydio.com/auth/linux/centos/7/x86_64/pydio-enterprise-release-1-1.el7.centos.noarch.rpm
</pre>
<p>Avec API_KEY et API_SECRET &nbsp;dans votre dashboard sur pydio.com, onglet
licence</p>
<pre class="code literal-block">
rpm -ivh pydio-release-1-1.el7.centos.noarch.rpm
rpm -ivh pydio-enterprise-release-1-1.el7.centos.noarch.rpm
</pre>
<p>Edition du dépot pour ajouter API_KEY et API_SECRET</p>
<pre class="code literal-block">
vim /etc/yum.repos.d/pydio-enterprise.repo
</pre>
<p>Installation de pydio</p>
<pre class="code literal-block">
yum update
yum install pydio-enterprise
</pre>
<p>Modification du vhost par defaut :</p>
<pre class="code apache literal-block">
<span class="nt">&lt;VirtualHost</span> <span class="s">nom.du.vhost:80</span><span class="nt">&gt;</span>
<span class="nb">Alias</span> / <span class="sx">/usr/share/pydio/</span>
<span class="nb">Alias</span> <span class="sx">/pydio_public</span> <span class="sx">/var/lib/pydio/public/</span>

<span class="nt">&lt;Directory</span> <span class="s">/usr/share/pydio/</span><span class="nt">&gt;</span>
<span class="nb">Options</span> FollowSymLinks
<span class="nb">AllowOverride</span> Limit FileInfo
<span class="nb">Require</span> <span class="k">all</span> granted
<span class="nb">php_value</span> error_reporting <span class="m">2</span>
<span class="nb">php_value</span> upload_max_filesize <span class="m">100</span>M
<span class="nb">php_value</span> post_max_size <span class="m">100</span>M
<span class="nb">php_value</span> output_buffering <span class="k">Off</span>

<span class="nt">&lt;/Directory&gt;</span>

<span class="nt">&lt;Directory</span> <span class="s">/var/lib/pydio/public/</span><span class="nt">&gt;</span>
<span class="nb">AllowOverride</span> Limit FileInfo
<span class="nb">Require</span> <span class="k">all</span> granted
<span class="nb">php_value</span> error_reporting <span class="m">2</span>
<span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre>
<p>Modification du charset dans /etc/pydio/bootstrap_conf.php</p>
<pre class="code literal-block">
define(&quot;AJXP_LOCALE&quot;, &quot;fr_FR.UTF-8&quot;);
</pre>
<p>Création de la base de données:</p>
<pre class="code literal-block">
mysql -u root -p
create database pydio;
create user pydio&#64;localhost identified by 'mypassword';
grant all privileges on pydio.* to pydio&#64;localhost identified by 'mypassword';
update mysql.users set Super_Priv='Y' where user like pydio;
</pre>
<p>La dernière commande sert à donner les super privilège à l'utilisateur
pydio afin qu'il puisse créer des triggers.</p>
<p>Vient ensuite l'installation des plugins pydio:</p>
<pre class="code literal-block">
yum install pydio-plugin*
</pre>
<p>On termine par l'import de la base de données</p>
<pre class="code literal-block">
mysql -u pydio -p pydio &lt; mondumppydio.sql
</pre>
<p>Enfin, on lance l'interface de pydio et on passe via le wizard pour la
première configuration.&nbsp;Une fois terminé, on doit pouvoir se connecter
avec son compte habituel et retrouver tous ses fichiers.</p>

                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="../../category/tech.html">Tech</a></p>
                        <p>Tags: <a href="../../tag/centos.html">centos</a>, <a href="../../tag/linux.html">Linux</a>, <a href="../../tag/pydio.html">pydio</a>, </p>
                    </aside>
                    <hr/>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="../../theme/js/main.js"></script>
    </body>
</html>