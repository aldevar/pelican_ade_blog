<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Nutanix Template for Zabbix
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="../../theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../../theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../theme/css/main.css">

    <link rel="stylesheet" href="../../theme/css/blog.css">
    <link rel="stylesheet" href="../../theme/css/github.css">
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aldevar - Le Blog Atom Feed" />
        <script src="../../theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
        <a id="site-title" href="../.."><h1><i class="icon-coffee"></i> Aldevar - Le Blog</h1></a>
        <p id="site-desc"> Un Blog IT </p>
    </hgroup>
    <nav>
        <ul id="nav-links">
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2016-03-31T17:35:00+02:00" pubdate>
                            Thu 31 March 2016
                        </time>
                        <a href="../../2016/03/nutanix-template-for-zabbix.html" rel="bookmark"><h1>Nutanix Template for Zabbix</h1></a>
                    </header>

                    <section class="post-content">
                        <p>Cet article est également disponible <a class="reference external" href="http://blog.devarieux.net/2016/03/template_nutanix_pour_zabbix/">en
français</a></p>
<p>For the needs of our infrastructure, I built a Nutanix Template for the
monitoring plateforme Zabbix. This template automatically discover
containers, CVMs, hard drives, hypervisors and virtual machines.</p>
<p>Once the items are discovered, some metrics, graphs and triggers are
deployed</p>
<p>To be able to use this template, the prism's SNMP server needs to be
configured, the Nutanix MIB needs to be integrated in the zabbix server
and some macros needs to be set at the host level in Zabbix. We will go
through these few steps in the next part of this post.</p>
<p>The template is configured to use SNMPv3 in authPriv mode, using SHA
auth and AES privacy.</p>
<div class="section" id="prism-central">
<h2>Prism Central</h2>
<p>The prism configuration is quite simple, using the SNMP configuration
interface</p>
<p><img alt="2016-03-18 09_52_19-Nutanix Web Console" src="images/2016-03-18-09_52_19-Nutanix-Web-Console.png" /></p>
<p>Make sure at least one Transport is configured in UDP, on the port of
your choice (161 by default)</p>
<p><img alt="2016-03-18 09_52_56-Nutanix Web Console" src="images/2016/03/2016-03-18-09_52_56-Nutanix-Web-Console.png" /></p>
<p>Then, go in the 'Users' tab and add a new user for Zabbix.</p>
<p><img alt="2016-03-18 09_53_41-Nutanix Web Console" src="images/2016-03-18-09_53_41-Nutanix-Web-Console.png" /></p>
<p>While you are here, you can download the MIB, we will need it later.</p>
<p>Clic Save. The prim configuration is done.</p>
</div>
<div class="section" id="nutanix-mib">
<h2>Nutanix MIB</h2>
<p>One you have downloaded the Nutanix MIB, we need to upload it on the
Zabbix server. On CentOS, it is located in /usr/share/snmp/mibs</p>
<pre class="literal-block">
# ls /usr/share/snmp/mibs/NUTANIX*
/usr/share/snmp/mibs/NUTANIX-MIB
</pre>
<p>Restart Zabbix so it can use this new MIB</p>
<pre class="literal-block">
# systemctl restart zabbix-server
</pre>
<p>You can test the MIB and the prism configuration using the snmpwalk
command line tool. In the example, we are listing all the Nutanix
containers.</p>
<pre class="literal-block">
snmpwalk -v 3 -a SHA -A YOURSHAPASSWORD -u zabbix -x AES -X YOURAESPASSWORD IP.OF.PRISM.CENTRAL -l AuthPriv citContainerName
NUTANIX-MIB::citContainerName.1 = STRING: container00.
NUTANIX-MIB::citContainerName.2 = STRING: containerA.
NUTANIX-MIB::citContainerName.3 = STRING: containerB.
NUTANIX-MIB::citContainerName.4 = STRING: containerC.
NUTANIX-MIB::citContainerName.5 = STRING: RESERVED_SPACE.
NUTANIX-MIB::citContainerName.6 = STRING: containerD.
</pre>
<p>The server configuration is done, we can now configure Zabbix itself.</p>
</div>
<div class="section" id="zabbix">
<h2>Zabbix</h2>
<p>If it's not already done, create a new host for prism central in Zabbix.
The host needs 3 macros for the Nutanix Template to work on it.</p>
<p>Those 3 macros are</p>
<ul class="simple">
<li>{$NTX_SNMP_USER} : the SNMP user</li>
<li>{$NTX_SNMP_AUTH} : the SHA password</li>
<li>{$NTX_SNMP_PRIV} : the AES password</li>
</ul>
<p>Then, import this
<a class="reference external" href="http://blog.devarieux.net/wp-content/uploads/2016/03/Template_SNMP_Nutanix_Cluster.xml">Template</a>
in Zabbix and apply it on your prism central host.</p>
<p>By default, the VM discovery is disabled because I couldn't find a good
way to create hosts from the LLD process.</p>
<p>If you have a big Nutanix cluster and Zabbix shows a timeout error while
parsing the SNMP OIDs, you can increase this timeout in the Zabbix
configuration file</p>
<pre class="literal-block">
Timeout=10
</pre>
<p>Known bugs :</p>
<ul class="simple">
<li>Until NOS 4.6, LLD can't discover all hypervisors. This behavior is
the same when using snmpwalk. I guess this is a Nutanix problem.
Everything works fine in NOS 4.6</li>
<li>The number of found VMs is limited to 250. I guess this is a
limitation on the Nutanix side.</li>
</ul>
</div>

                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="../../category/supervision.html">Supervision</a></p>
                        <p>Tags: <a href="../../tag/nutanix.html">nutanix</a>, <a href="../../tag/supervision.html">supervision</a>, <a href="../../tag/template.html">template</a>, <a href="../../tag/zabbix.html">zabbix</a>, </p>
                    </aside>
                    <hr/>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="../../theme/js/main.js"></script>
    </body>
</html>