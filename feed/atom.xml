<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Aldevar - Le Blog</title><link href="https://blog.devarieux.net/" rel="alternate"></link><link href="https://blog.devarieux.net/feed/atom.xml" rel="self"></link><id>https://blog.devarieux.net/</id><updated>2021-02-23T21:45:00+01:00</updated><subtitle>Yet Another Blog</subtitle><entry><title>Zabbix et TimescaleDB 2 - Erreur Z3005</title><link href="https://blog.devarieux.net/2021/02/zabbix-timescaledb2.html" rel="alternate"></link><published>2021-02-23T21:45:00+01:00</published><updated>2021-02-23T21:45:00+01:00</updated><author><name>aldevar</name></author><id>tag:blog.devarieux.net,2021-02-23:/2021/02/zabbix-timescaledb2.html</id><summary type="html">&lt;p&gt;Depuis que Zabbix supporte officiellement le plugin PostreSQL TimescaleDB, je n'utilise plus que ce mode d'installation pour les différentes instances que j'ai à déployer.&lt;/p&gt;
&lt;p&gt;TimescaleDB est une time serie database et est donc particulièrement adapaté pour stocker des métriques de supervision. Le logiciel se présente comme un plugin à PostgreSQL …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Depuis que Zabbix supporte officiellement le plugin PostreSQL TimescaleDB, je n'utilise plus que ce mode d'installation pour les différentes instances que j'ai à déployer.&lt;/p&gt;
&lt;p&gt;TimescaleDB est une time serie database et est donc particulièrement adapaté pour stocker des métriques de supervision. Le logiciel se présente comme un plugin à PostgreSQL et permet de transformer certaines tables d'une base en mode time series. Le gros avantage est que cela permet de stocker l'ensemble des informations dans un endroit unique, que ce soit la configuration du logiciel (utilisateurs, droits d'accès, paramètres...) et aussi les métriques récupérées par le système de supervision. En plus de cela, timescaleDB propose le partitionnemet automatique des tables ainsi que la compression des données ayant plus de 7 jours.&lt;/p&gt;
&lt;p&gt;On a donc d'un coté un gain opérationnel car on n'a plus q'une base de données à gérer et de l'autre un gain en ressources car les tables sont adaptées à ce qu'elles stockent et peuvent être compréssées pour des économies de stockage substantielles.&lt;/p&gt;
&lt;p&gt;Lors de ma dernière installation, j'ai pu voir que le plugin TimescaleDB était sorti en version 2. La documentation de Zabbix ne spécifiant pas la version de TimescaleDB à installer, j'ai naturellement installé cette dernière version.&lt;/p&gt;
&lt;p&gt;Mal m'en a pris! Cette version 2 n'est pas compatible avec Zabbix 5.2! J'ai pu le voir rapidement lors du démarrage du service &lt;code&gt;zabbix-server&lt;/code&gt; avec ces logs que vous n'êtes pas obligé lire en entier. C'est un gros vomi d'erreurs comme on n'aime pas en voir (TL;DR - Plusieurs erreurs Z3005 - query failed - clairement en rapport avec TimescaleDB)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[Z3005] query failed: [0] PGRES_FATAL_ERROR:ERROR: relation &amp;quot;_timescaledb_config.bgw_policy_compress_chunk s&amp;quot; does not exist
LINE 1: select (p.older_than).integer_interval from _timescaledb_con...
^
[select (p.older_than).integer_interval from _timescaledb_config.bgw_policy_compress_chunks p inner join _timescaledb_catalog.hypertable h on (h.id = p.hypertable_id) where h.table_name=&amp;#39;history&amp;#39;]
0000000000000 [Z3005] query failed: [0] PGRES_FATAL_ERROR:ERROR: function add_compress_chunks_policy(unknown, integer) does not exist
LINE 1: select add_compress_chunks_policy(&amp;#39;history&amp;#39;, integer &amp;#39;612000...
^
HINT: No function matches the given name and argument types. You might need to add explicit type casts.
[select add_compress_chunks_policy(&amp;#39;history&amp;#39;, integer &amp;#39;612000&amp;#39;)]
0000000000000 failed to add compression policy to table &amp;#39;history&amp;#39;
0000000000000 [Z3005] query failed: [0] PGRES_FATAL_ERROR:ERROR: relation &amp;quot;_timescaledb_config.bgw_policy_compress_chunk s&amp;quot; does not exist
LINE 1: select (p.older_than).integer_interval from _timescaledb_con...
^
[select (p.older_than).integer_interval from _timescaledb_config.bgw_policy_compress_chunks p inner join _timescaledb_catalog.hypertable h on (h.id = p.hypertable_id) where h.table_name=&amp;#39;history_uint&amp;#39;]
0000000000000 [Z3005] query failed: [0] PGRES_FATAL_ERROR:ERROR: function add_compress_chunks_policy(unknown, integer) does not exist
LINE 1: select add_compress_chunks_policy(&amp;#39;history_uint&amp;#39;, integer &amp;#39;6...
^
HINT: No function matches the given name and argument types. You might need to add explicit type casts.
[select add_compress_chunks_policy(&amp;#39;history_uint&amp;#39;, integer &amp;#39;612000&amp;#39;)]
0000000000000 failed to add compression policy to table &amp;#39;history_uint&amp;#39;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cette erreur provient d'une incompatibilité entre Zabbix 5.2 et TimescaleDB 2. Cette incompatibilité est causée par des modifications de certaines fonctions de l'API de TimescaleDB, entre autre la fonction &lt;a class="reference external" href="https://docs.timescale.com/latest/api#add_compression_policy"&gt;add_compression_policy&lt;/a&gt;. A partir de là, on a deux solutions.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Soit on refait l'installation de TimescaleDB avec la dernière version 1.X.&lt;/li&gt;
&lt;li&gt;Soit on tente de corriger ces erreurs.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;J'ai opté pour la seconde option. En fouillant, j'ai trouvé un &lt;a class="reference external" href="https://support.zabbix.com/projects/ZBX/issues/ZBX-18854"&gt;ticket sur le Jira&lt;/a&gt; de Zabbix qui aborde ce problème. Dans les échanges, un utilisateur propose une solution avec quelques lignes à envoyer vers la db pour corriger tout ça. Voici comment la mettre en oeuvre.&lt;/p&gt;
&lt;p&gt;On commence par se préparer à mettre à jour la base de données&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# systemctl stop zabbix-server
# sudo -u postgres psql zabbix
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On peut maintenant envoyer le code SQL suivant :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TYPE&lt;/span&gt; &lt;span class="n"&gt;_timescaledb_catalog&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ts_interval&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is_time_interval&lt;/span&gt; &lt;span class="nb"&gt;BOOLEAN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time_interval&lt;/span&gt; &lt;span class="nb"&gt;INTERVAL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;integer_interval&lt;/span&gt; &lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="k"&gt;ALTER&lt;/span&gt; &lt;span class="k"&gt;TYPE&lt;/span&gt; &lt;span class="n"&gt;_timescaledb_catalog&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ts_interval&lt;/span&gt; &lt;span class="k"&gt;OWNER&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="n"&gt;zabbix&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="k"&gt;REPLACE&lt;/span&gt; &lt;span class="k"&gt;VIEW&lt;/span&gt; &lt;span class="n"&gt;_timescaledb_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bgw_policy_compress_chunks&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;job_id&lt;/span&gt;&lt;span class="p"&gt;,(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;hypertable_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)::&lt;/span&gt;&lt;span class="nb"&gt;INTEGER&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;hypertable_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;compress_after&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)::&lt;/span&gt;&lt;span class="n"&gt;_timescaledb_catalog&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ts_interval&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;older_than&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;timescaledb_information&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;jobs&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;proc_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;policy_compression&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;ALTER&lt;/span&gt; &lt;span class="k"&gt;VIEW&lt;/span&gt; &lt;span class="n"&gt;_timescaledb_config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bgw_policy_compress_chunks&lt;/span&gt; &lt;span class="k"&gt;OWNER&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="n"&gt;zabbix&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="k"&gt;REPLACE&lt;/span&gt; &lt;span class="k"&gt;FUNCTION&lt;/span&gt; &lt;span class="n"&gt;add_compress_chunks_policy&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hypertable&lt;/span&gt; &lt;span class="n"&gt;regclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;older_than&lt;/span&gt; &lt;span class="n"&gt;anyelement&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;if_not_exists&lt;/span&gt; &lt;span class="nb"&gt;BOOLEAN&lt;/span&gt; &lt;span class="k"&gt;DEFAULT&lt;/span&gt; &lt;span class="k"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;RETURNS&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt; &lt;span class="k"&gt;LANGUAGE&lt;/span&gt; &lt;span class="k"&gt;sql&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="err"&gt;$$&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;add_compression_policy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hypertable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;older_than&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;if_not_exists&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;$$&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;ALTER&lt;/span&gt; &lt;span class="k"&gt;FUNCTION&lt;/span&gt; &lt;span class="n"&gt;add_compress_chunks_policy&lt;/span&gt; &lt;span class="k"&gt;OWNER&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="n"&gt;zabbix&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;OR&lt;/span&gt; &lt;span class="k"&gt;REPLACE&lt;/span&gt; &lt;span class="k"&gt;FUNCTION&lt;/span&gt; &lt;span class="n"&gt;drop_chunks&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;older_than&lt;/span&gt; &lt;span class="n"&gt;anyelement&lt;/span&gt; &lt;span class="k"&gt;DEFAULT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="k"&gt;UNKNOWN&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt; &lt;span class="n"&gt;NAME&lt;/span&gt; &lt;span class="k"&gt;DEFAULT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;RETURNS&lt;/span&gt; &lt;span class="k"&gt;SETOF&lt;/span&gt; &lt;span class="nb"&gt;TEXT&lt;/span&gt; &lt;span class="k"&gt;LANGUAGE&lt;/span&gt; &lt;span class="k"&gt;sql&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="err"&gt;$$&lt;/span&gt;
&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;drop_chunks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;table_name&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;older_than&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="k"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;$$&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;ALTER&lt;/span&gt; &lt;span class="k"&gt;FUNCTION&lt;/span&gt; &lt;span class="n"&gt;drop_chunks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;anyelement&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;OWNER&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="n"&gt;zabbix&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On peut maintenant redémarrer le service zabbix-server (&lt;code&gt;systemctl start zabbix-server&lt;/code&gt;) et on voit dans les logs que les erreurs ont disparu.
Zabbix devrait rapidement corriger cela, dans un premier temps en mettant à jour la documentation et dans un second temps en adaptant l'application.&lt;/p&gt;
</content><category term="Supervision"></category><category term="timescaledb"></category><category term="zabbix"></category></entry><entry><title>Pilotage de Caddy par API</title><link href="https://blog.devarieux.net/2021/02/caddy-api.html" rel="alternate"></link><published>2021-02-21T00:23:00+01:00</published><updated>2021-02-21T00:23:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2021-02-21:/2021/02/caddy-api.html</id><summary type="html">&lt;p&gt;Comme promis dans l'article précédent sur Caddy, je vais parler de l'utilisation de l'API de Caddy. Un prochain article décrira comment générer un certificat wildcard pour un domaine hébergé chez OVH.&lt;/p&gt;
&lt;p&gt;En plus de permettre de lire la configuration, l'API de Caddy permet aussi d'en pousser une nouvelle, en totalité …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Comme promis dans l'article précédent sur Caddy, je vais parler de l'utilisation de l'API de Caddy. Un prochain article décrira comment générer un certificat wildcard pour un domaine hébergé chez OVH.&lt;/p&gt;
&lt;p&gt;En plus de permettre de lire la configuration, l'API de Caddy permet aussi d'en pousser une nouvelle, en totalité ou en partie. L'avantage est que, si la configuration envoyée est valide, celle ci est chargée à chaud et sinon un code retour autre que 200 est renvoyé, précisant l'erreur rencontrée.&lt;/p&gt;
&lt;p&gt;Attention au mode d'execution du service Caddy lorsqu'on commence à le configurer par API. Il est nécessaire d'utiliser le fichier de service décrit &lt;a class="reference external" href="https://caddyserver.com/docs/install#linux-service"&gt;dans la documentation&lt;/a&gt;. Sans cela, les modifications apportées seront perdues au prochain redémarrage du service.&lt;/p&gt;
&lt;p&gt;L'API est disponible par defaut seulement sur la boucle locale, port 2019. On peut déjà commencer par visualiser la configuration avant de commencer à en pousser une nouvelle.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl http://localhost:2019/config/ | python3 -m json.tool
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Le pipe vers la commande python permet d'obtenir directement un affichage json en mode pretty print.&lt;/p&gt;
&lt;div class="section" id="pousser-une-configuration-complete"&gt;
&lt;h2&gt;Pousser une configuration complète&lt;/h2&gt;
&lt;p&gt;La configuration à envoyer vers Caddy est préparée dans un fichier, qu'on va appeler &lt;code&gt;config.json&lt;/code&gt;. Ce fichier sera ensuite envoyé en tant que payload dans l'appel API.&lt;/p&gt;
&lt;p&gt;Première configuration simple avec un reverse proxy.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;apps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;http&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;servers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;quot;srv0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;quot;listen&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;:443&amp;quot;&lt;/span&gt;
                &lt;span class="p"&gt;],&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;quot;routes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                    &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;quot;handle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                            &lt;span class="p"&gt;{&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;quot;handler&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;reverse_proxy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;quot;upstreams&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                                    &lt;span class="p"&gt;{&lt;/span&gt;
                                        &lt;span class="nt"&gt;&amp;quot;dial&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;10.0.0.1:80&amp;quot;&lt;/span&gt;
                                    &lt;span class="p"&gt;}&lt;/span&gt;
                                &lt;span class="p"&gt;]&lt;/span&gt;
                            &lt;span class="p"&gt;}&lt;/span&gt;
                        &lt;span class="p"&gt;]&lt;/span&gt;
                    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Avec cette configuration, on a la génération du certificat TLS via Let's Encrypt ainsi que la redirection HTTP vers HTTPS. On pousse cette configuration avec la commande suivante :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl 127.0.0.1:2019/load -X POST -H &amp;quot;Content-Type: application/json&amp;quot; -d @config.json
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Passons maintenant à l'étape suivante. Nous allons ajouter plusieurs éléments de configuration&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;listen&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;127.0.0.1:2019&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;apps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;http&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;servers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;quot;srv0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;quot;listen&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;:443&amp;quot;&lt;/span&gt;
                &lt;span class="p"&gt;],&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;quot;routes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                    &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;quot;handle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                            &lt;span class="p"&gt;{&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;quot;handler&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;reverse_proxy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;quot;transport&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;quot;tls&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
                                &lt;span class="p"&gt;},&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;quot;upstreams&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                                    &lt;span class="p"&gt;{&lt;/span&gt;
                                        &lt;span class="nt"&gt;&amp;quot;dial&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;10.0.0.1:443&amp;quot;&lt;/span&gt;
                                    &lt;span class="p"&gt;}&lt;/span&gt;
                                &lt;span class="p"&gt;]&lt;/span&gt;
                            &lt;span class="p"&gt;}&lt;/span&gt;
                        &lt;span class="p"&gt;],&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;quot;match&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                            &lt;span class="p"&gt;{&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;quot;host&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                                    &lt;span class="s2"&gt;&amp;quot;sub.domain.com&amp;quot;&lt;/span&gt;
                                &lt;span class="p"&gt;]&lt;/span&gt;
                            &lt;span class="p"&gt;}&lt;/span&gt;
                        &lt;span class="p"&gt;]&lt;/span&gt;
                    &lt;span class="p"&gt;},&lt;/span&gt;

                &lt;span class="p"&gt;],&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;quot;tls_connection_policies&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                    &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;quot;certificate_selection&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;quot;any_tag&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                                &lt;span class="s2"&gt;&amp;quot;companycert&amp;quot;&lt;/span&gt;
                            &lt;span class="p"&gt;]&lt;/span&gt;
                        &lt;span class="p"&gt;}&lt;/span&gt;
                    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;tls&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;certificates&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;quot;load_files&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="p"&gt;{&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;quot;certificate&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/etc/pki/tls/certs/companycert.crt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;quot;key&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/etc/pki/tls/private/companycert.key&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;quot;tags&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                        &lt;span class="s2"&gt;&amp;quot;companycert&amp;quot;&lt;/span&gt;
                    &lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Qu'avons nous exactement?
Premièrement, nous créons une route qui utilise un handle. Un handle est un processus de Caddy qui permet d'activer certaines fonctionnalités spécifiques. Ici nous utilisons le handle &lt;code&gt;reverse_proxy&lt;/code&gt; mais il y en a &lt;a class="reference external" href="https://caddyserver.com/docs/json/apps/http/servers/routes/handle/"&gt;bien d'autres&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Ensuite, avec la directive &lt;code&gt;&amp;quot;upstream&amp;quot; &amp;quot;dial&amp;quot;&lt;/code&gt;, on spécifie le serveur de backend à utiliser. En précisant &lt;code&gt;:443&lt;/code&gt;, on force le reverse proxy à se connecter au backend en HTTPS.&lt;/p&gt;
&lt;p&gt;Puis la directive &lt;code&gt;&amp;quot;match&amp;quot; &amp;quot;host&amp;quot;&lt;/code&gt; permet de répondre aux requêtes destinées à &lt;code&gt;sub.domain.com&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;On termine enfin avec la configuration TLS. D'une part, on indique la politique TLS du serveur &amp;quot;srv0&amp;quot;. La possibilitée d'utiliser des tags est assez pratique pour ne pas avoir à répéter les chemins des certificats lorsqu'on utilise plusieurs éléments &amp;quot;server&amp;quot; dans la même configuration. Il est même possible de spécifier plusieurs tags, correspondant à plusieurs certificats. Caddy choisira le certificat le plus adapté au SNI de destination.&lt;/p&gt;
&lt;p&gt;De la même façon, on pousse la configuration complète vers Caddy.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl 127.0.0.1:2019/load -X POST -H &amp;quot;Content-Type: application/json&amp;quot; -d @config.json
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="mettre-a-jour-une-partie-de-la-configuration"&gt;
&lt;h2&gt;Mettre à jour une partie de la configuration&lt;/h2&gt;
&lt;p&gt;Pour mettre à jour ou remplacer une partie de la configuration, on va utiliser le chemin JSON qu'on souhaite mettre à jour et changer de verbe HTTP.&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;POST /config/[chemin]&lt;/dt&gt;
&lt;dd&gt;Configure ou remplace un objet. Si l'objet est une liste, l'élément est ajouté à la liste.&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Voici par exemple comment ajouter l'écoute sur le port 80, ce qui désactive la redirection automatique de HTTP vers HTTPS&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -X POST -H &amp;quot;Content-Type: application/json&amp;quot; -d &amp;#39;&amp;quot;:80&amp;quot;&amp;#39; &amp;quot;http://127.0.0.1:2019/config/apps/http/servers/srv0/listen&amp;quot;
&lt;/pre&gt;&lt;/div&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;PUT /config/[chemin]&lt;/dt&gt;
&lt;dd&gt;Créé un nouvel objet. Insert dans un liste&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Pour continuer sur l'exemple du port d'écoute, on peut ajouter le port d'écoute 80 de cette façon :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -X PUT -H &amp;quot;Content-Type: application/json&amp;quot; -d &amp;#39;&amp;quot;:80&amp;quot;&amp;#39; &amp;quot;http://127.0.0.1:2019/config/apps/http/servers/srv0/listen/0&amp;quot;
&lt;/pre&gt;&lt;/div&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;PATCH /config/[chemin]&lt;/dt&gt;
&lt;dd&gt;Remplace un objet ou une liste&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Dison qu'on souhaite remettre en place la redirection du port 80 vers 443. Cela est automatique lorsqu'on demande à Caddy d'écouter seulement sur le port 443. Cette commande va remplacer la liste &lt;code&gt;[&amp;quot;:80&amp;quot;, &amp;quot;:443&amp;quot;]&lt;/code&gt; par simplement &lt;code&gt;[&amp;quot;:443&amp;quot;]&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -X PATCH -H &amp;quot;Content-Type: application/json&amp;quot; -d &amp;#39;&amp;quot;:443&amp;quot;&amp;#39; &amp;quot;http://127.0.0.1:2019/config/apps/http/servers/srv0/listen/&amp;quot;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Voilà pour un tour rapide de l'utilisation de l'API de Caddy. Dans un prochain article j'expliquerai comment compiler Caddy avec des plugins et comment générer un certificat wildcard pour un domaine hébergé chez OVH, en remplissant le challenge DNS proposé par Let's Encrypt.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="caddy"></category><category term="web"></category><category term="automatisation"></category></entry><entry><title>Présentation de Caddy</title><link href="https://blog.devarieux.net/2021/02/caddy-presentation.html" rel="alternate"></link><published>2021-02-19T06:55:00+01:00</published><updated>2021-02-19T06:55:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2021-02-19:/2021/02/caddy-presentation.html</id><summary type="html">&lt;p&gt;Dans un tweet récent, j'expliquais voir trop peu de publications d'articles sur le serveur web / reverse proxy &lt;a class="reference external" href="https://caddyserver.com/"&gt;Caddy&lt;/a&gt;. Je pense que Caddy gagne a être connu, voici donc un premier article de présentation.&lt;/p&gt;
&lt;blockquote class="twitter-tweet" data-partner="tweetdeck"&gt;&lt;p lang="fr" dir="ltr"&gt;Je vois pas mal de partage d&amp;#39;articles sur Traefik dans mon fil Twitter. J&amp;#39;aime beaucoup …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;Dans un tweet récent, j'expliquais voir trop peu de publications d'articles sur le serveur web / reverse proxy &lt;a class="reference external" href="https://caddyserver.com/"&gt;Caddy&lt;/a&gt;. Je pense que Caddy gagne a être connu, voici donc un premier article de présentation.&lt;/p&gt;
&lt;blockquote class="twitter-tweet" data-partner="tweetdeck"&gt;&lt;p lang="fr" dir="ltr"&gt;Je vois pas mal de partage d&amp;#39;articles sur Traefik dans mon fil Twitter. J&amp;#39;aime beaucoup Traefik mais je lui préfère &lt;a href="https://twitter.com/caddyserver?ref_src=twsrc%5Etfw"&gt;@caddyserver&lt;/a&gt;.&lt;br&gt;Je profite donc de la reprise des activités sur mon blog pour vous préparer quelques articles sur Caddy et l&amp;#39;utilisation de son API.&lt;/p&gt;&amp;mdash; Alain Devarieux (@landvarx) &lt;a href="https://twitter.com/landvarx/status/1362078709436592130?ref_src=twsrc%5Etfw"&gt;February 17, 2021&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;&lt;p&gt;Caddy est un serveur web, de même que Apache ou Nginx. Il dispose également d'une fonctionnalité de reverse proxy et utilise des options de sécurités avancées par défaut (HTTPS par défaut avec Let's Encrypt ou ZeroSSL, TLS 1.3, OCSP Stapling, Cipher Suite modernes). Le logiciel est écrit en Go.
En plus de ces fonctionnalités de sécurités, Caddy est multiplateforme, il fonctionne avec un seul binaire, supporte les plugins et supporte plusieurs types de challenges ACME.&lt;/p&gt;
&lt;p&gt;Je ne vais pas revenir sur son installation, parfaitement décrite dans &lt;a class="reference external" href="https://caddyserver.com/docs/install"&gt;la documentation&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="configuration"&gt;
&lt;h2&gt;Configuration&lt;/h2&gt;
&lt;p&gt;Caddy peut se configurer de deux manières. Via le fichier de configuration, appelé &lt;code&gt;Caddyfile&lt;/code&gt; ou via son API avec un payload JSON. L'utilisation de l'API sera décrite dans un prochain article.
J'utilise Caddy principalement pour ses fonctionnalités de reverse proxy. Voyons donc quelques exemples de configuration de Caddy via le Caddyfile.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sub.domain.com {
    reverse_proxy 10.0.0.1:8000
    log {
        output file /var/log/caddy/sub.domain.com_access.log
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Bien, avec ça, nous avons un reverse proxy qui écoute sur le port 80 et 443, avec redirection automatique HTTP vers HTTPS. Les logs seront renvoyés vers un fichier. Avec cette configuration, le certificat Let's Encrypt est généré (si le DNS est bien configuré et que Caddy est accessible depuis l'exterieur) et seuls les protocoles TLS 1.2 et 1.3 sont supportés. Niveau sécurité, on est pas mal.&lt;/p&gt;
&lt;p&gt;De la même façon, le header &lt;code&gt;X-Forwarded-For&lt;/code&gt; est automatiquement intégré dans l'entête HTTP envoyé au serveur de backend. Cette intégration permet de gagner quelques lignes de configuration.
Voyons maintenant comment gérer l'utilisation de deux backends différents pour des URI différentes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sub.domain.com {
reverse_proxy /api/v1/* 10.0.0.2:4000
reverse_proxy / 10.0.0.1:3000

log {
        output file /var/log/caddy/sub.domain.com_access.log {
                roll_size 10MiB
                roll_keep 10
                }
        }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Là encore, c'est assez simple. On traite d'abord les requêtes vers &lt;code&gt;/api/v1&lt;/code&gt; qui sont envoyées vers un premier backend et le reste des requêtes est envoyé vers &lt;code&gt;10.0.0.1&lt;/code&gt;. J'en ai profité pour ajouter une rotation des logs.&lt;/p&gt;
&lt;p&gt;Tout cela fonctionne bien quand on a un site disponible publiquement et pour lequel Caddy peut générer un certificat Let's Encrypt. Voyons maintenant comment intégrer son propre certificat (autosigné ou non). Pour cet exemple, je m'appuie sur une configuration de Caddy pour servir un serveur Graylog&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;logs.domain.com {
        reverse_proxy 127.0.0.1:9000
        header X-Graylog-Server-URL https://logs.domain.com/
        tls /etc/pki/tls/certs/companycert.crt /etc/pki/tls/private/companycert.key
log {
        output file /var/log/caddy/graylog.log {
                roll_size 10MiB
                roll_keep 10
                }
        }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;L'option &lt;code&gt;tls&lt;/code&gt; permet de passer directement le certificat puis la clé privée du certificat. L'ajout d'un header se fait de façon assez simple ici aussi.&lt;/p&gt;
&lt;p&gt;Enfin, comment faire lorsqu'on souhaite servir son site en plain HTTP, sans TLS. L'option est assez simple et plutot ingénieuse. Il suffit de forcer le site en HTTP dans l'URL.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http://sub.domain.com {
    reverse_proxy 10.0.0.1:8000
    log {
        output file /var/log/caddy/sub.domain.com_access.log
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Avec cette configuration, Caddy ne va pas tenter de générer le certificat Let's Encrypt ni proposer de redirection HTTP vers HTTPS.&lt;/p&gt;
&lt;p&gt;Dans le prochain article nous verrons comment utiliser l'API de Caddy en lecture et en écriture totale ou partielle de configuration.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="caddy"></category><category term="web"></category></entry><entry><title>VPN Meraki et Windows 10</title><link href="https://blog.devarieux.net/2021/02/vpn-meraki-win10.html" rel="alternate"></link><published>2021-02-17T21:47:00+01:00</published><updated>2021-02-17T21:47:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2021-02-17:/2021/02/vpn-meraki-win10.html</id><summary type="html">&lt;p&gt;Un des avantages du VPN Meraki est qu'il ne nécessite pas de client de spécifique pour Windows. Le problème principal est que sa configuration nécessite quelques manipulations. Beaucoup de nos prestatiares rencontrent des difficultés pour s'y connecter et nous remontent régulièrement qu'ils ont des échecs de connexions avec le code …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Un des avantages du VPN Meraki est qu'il ne nécessite pas de client de spécifique pour Windows. Le problème principal est que sa configuration nécessite quelques manipulations. Beaucoup de nos prestatiares rencontrent des difficultés pour s'y connecter et nous remontent régulièrement qu'ils ont des échecs de connexions avec le code erreur 628, ou encore le message &amp;quot;The connection was terminated by the remote computer before it could be completed.&amp;quot;.
Voici donc comment configurer un VPN Meraki sous Windows 10. Avec en bonus, la configuration de la base de registre en cas d'erreur 809 qui apparait lorsque le client VPN se trouve derrière du NAT.&lt;/p&gt;
&lt;div class="section" id="configuration-du-client-vpn-l2tp"&gt;
&lt;h2&gt;Configuration du client VPN L2TP&lt;/h2&gt;
&lt;p&gt;Dans les paramètres VPN de Windows 10, ajouter un nouveau VPN et y entrer les informations de connexion. Jusque là, rien de bien compliqué.&lt;/p&gt;
&lt;img alt="Windows 10 - Add VPN" src="/images/Meraki_VPN_WIN10_Settings.png" /&gt;
&lt;p&gt;Ensuite, il faut se rendre dans les options d'adaptateurs (Change adapter options). Cela ouvre le Control Panel. Clique droit sur la connexion VPN concernée puis Propriété. Ici, dans l'onglet Securité, dans le second menu déroulant, il faut sélectionner &amp;quot;Require Encryption (Disconnect if server decline)&amp;quot;.
Puis, dans le partie Authentication, il faut cocher Allow these protocols puis 'Unencrypted password (PAP). Cette option n'envoie pas le mot de passe en clair sur le réseau. Celui ci transit par un canal chiffré entre le poste client et le MX Meraki.&lt;/p&gt;
&lt;img alt="Windows 10 - VPN Properties" src="/images/Meraki_VPN_Win10_Properties01.png" /&gt;
&lt;p&gt;Ensuite, il faut cliquer sur le bouton 'Advanced Settings' et entrer la PSK dans la fenêtre qui s'ouvre.
On peut enfin valider le tout et se connecter au VPN. Si cela ne fonctionne pas, il est possible que ce soit une option de Windows dans la base de registre qui empêche la communication a travers les réseaux natés. Pour corriger cela, il faut ouvrir la base de registre en mode administrateur puis créer cette clé :&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\PolicyAgent
Nom : AssumeUDPEncapsulationContextOnSendRule
Type: DWORD
Valeur: 2
Base: Decimal
&lt;/pre&gt;
&lt;p&gt;Après un reboot, la connexion devrait fonctionner.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="cisco"></category><category term="meraki"></category><category term="vpn"></category><category term="reseau"></category></entry><entry><title>Migrer des règles de NAT VyOS vers NSX-V</title><link href="https://blog.devarieux.net/2021/02/migrate-nat-vyos-nsxv.html" rel="alternate"></link><published>2021-02-10T09:22:00+01:00</published><updated>2021-02-10T09:22:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2021-02-10:/2021/02/migrate-nat-vyos-nsxv.html</id><summary type="html">&lt;p&gt;Il y a quelques temps, j'ai procédé une modification majeure de l'architecture BGP d'un hébergeur. Cette modification imposait de transposer les règles de NAT présentent sur les routeurs BGP VyOS vers les routeurs NSX-V, plus proche du coeur de réseau.
Il y avait environ 400 règles de NAT à transposer …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Il y a quelques temps, j'ai procédé une modification majeure de l'architecture BGP d'un hébergeur. Cette modification imposait de transposer les règles de NAT présentent sur les routeurs BGP VyOS vers les routeurs NSX-V, plus proche du coeur de réseau.
Il y avait environ 400 règles de NAT à transposer. Ceux qui ont déjà fait du NAT sur NSX savent que réaliser ce genre de manipulation manuellement n'est pas une sinécure. L'interface n'est clairement pas adaptée pour ce genre de tâche. Par contre, NSX dispose d'une API plutot bien documentée.
De l'autre coté, VyOS. VyOS est un système d'exploitation réseau, basé sur Debian avec des commandes similaires à ce qu'on peut trouver sur un routeur.&lt;/p&gt;
&lt;p&gt;En discutant avec &lt;a class="reference external" href="https://baturin.org/"&gt;Daniil Baturin&lt;/a&gt;, principal mainteneur de VyOS, sur la meilleur façon de procéder, celui ci m'a indiqué la &lt;a class="reference external" href="https://github.com/vyos/vyos-1x/blob/current/python/vyos/configtree.py"&gt;lib configtree&lt;/a&gt; qui permet de manipuler un fichier de configuration VyOS. Avec l'aide de cette lib, j'ai pu écrire ce script Python qui lit le fichier vyos.conf préalablement récupéré par mes soins et génére puis pousse les règles de NAT vers NSX-V.&lt;/p&gt;
&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;vyos.configtree&lt;/span&gt;
  &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;
  &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;requests.auth&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HTTPBasicAuth&lt;/span&gt;

  &lt;span class="c1"&gt;# Set variables for edg_id and nsxmanager&lt;/span&gt;
  &lt;span class="n"&gt;edge_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;edge-XXX&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;nsx_manager&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;nsxmanager.localdomain&amp;#39;&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_nat_dest_rule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
      &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="sd"&gt;      From VyOS config section &amp;quot;nat destination rule X&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;      Return the DNAT rule X as dict&lt;/span&gt;
&lt;span class="sd"&gt;      &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
      &lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dstaddr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;srcaddr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inbound-interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inbound-interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inbound-interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;translation&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;translateaddr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;translation&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_nat_source_rule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
      &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="sd"&gt;      From VyOS config section &amp;quot;nat source rule X&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;      Return the SNAT rule X as dict&lt;/span&gt;
&lt;span class="sd"&gt;      &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
      &lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;srcaddr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dstaddr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;outbound-interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;outbound-interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;outbound-interface&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;translation&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]):&lt;/span&gt;
          &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;translateaddr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;return_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;translation&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;address&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create_dstnat_payload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;natdst&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
      &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="sd"&gt;      From all VyOS DNAT rules, create a XML payload that can be sent to NSX&lt;/span&gt;
&lt;span class="sd"&gt;      &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
      &lt;span class="n"&gt;start_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;natRules&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;end_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;/natRules&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
      &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;natdst&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
          &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;natRule&amp;gt;&amp;lt;action&amp;gt;dnat&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;originalAddress&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/originalAddress&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;translatedAddress&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{1}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/translatedAddress&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;loggingEnabled&amp;gt;false&amp;lt;/loggingEnabled&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;enabled&amp;gt;true&amp;lt;/enabled&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;originalPort&amp;gt;any&amp;lt;/originalPort&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;translatedPort&amp;gt;any&amp;lt;/translatedPort&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dstaddr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;translateaddr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="n"&gt;descr_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;description&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/description&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;description&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
              &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;descr_payload&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;protocol&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;all&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                  &lt;span class="n"&gt;proto_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;protocol&amp;gt;any&amp;lt;/protocol&amp;gt;&amp;quot;&lt;/span&gt;
              &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                  &lt;span class="n"&gt;proto_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;protocol&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/protocol&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;protocol&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

          &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="n"&gt;proto_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;protocol&amp;gt;any&amp;lt;/protocol&amp;gt;&amp;quot;&lt;/span&gt;
          &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;proto_payload&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;srcaddr&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="n"&gt;src_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;dnatMatchSourceAddress&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/dnatMatchSourceAddress&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;srcaddr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
              &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;src_payload&lt;/span&gt;

          &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;/natRule&amp;gt;&amp;quot;&lt;/span&gt;

      &lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;start_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;end_payload&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;payload&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create_srcnat_payload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;natsrc&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
      &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="sd"&gt;      From all VyOS SNAT rules, create a XML payload that can be sent to NSX&lt;/span&gt;
&lt;span class="sd"&gt;      &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
      &lt;span class="n"&gt;start_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;natRules&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;end_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;/natRules&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
      &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;natsrc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
          &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;natRule&amp;gt;&amp;lt;action&amp;gt;snat&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;originalAddress&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/originalAddress&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;translatedAddress&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{1}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/translatedAddress&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;loggingEnabled&amp;gt;false&amp;lt;/loggingEnabled&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;enabled&amp;gt;true&amp;lt;/enabled&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;originalPort&amp;gt;any&amp;lt;/originalPort&amp;gt;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s2"&gt;                          &amp;lt;translatedPort&amp;gt;any&amp;lt;/translatedPort&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;srcaddr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;translateaddr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="n"&gt;descr_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;description&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/description&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;description&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
              &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;descr_payload&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;protocol&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;protocol&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;all&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                  &lt;span class="n"&gt;proto_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;protocol&amp;gt;any&amp;lt;/protocol&amp;gt;&amp;quot;&lt;/span&gt;
              &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                  &lt;span class="n"&gt;proto_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;protocol&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/protocol&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;protocol&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

          &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="n"&gt;proto_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;protocol&amp;gt;any&amp;lt;/protocol&amp;gt;&amp;quot;&lt;/span&gt;
          &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;proto_payload&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;dstaddr&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
              &lt;span class="n"&gt;src_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;snatMatchDestinationAddress&amp;gt;&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;lt;/snatMatchDestinationAddress&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rule&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dstaddr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
              &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;src_payload&lt;/span&gt;

          &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;base_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;/natRule&amp;gt;&amp;quot;&lt;/span&gt;

      &lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;start_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;mid_payload&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;end_payload&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;payload&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
      &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vyos.conf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="n"&gt;config_string&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vyos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configtree&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ConfigTree&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config_string&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

      &lt;span class="c1"&gt;# We start with DNAT rules&lt;/span&gt;
      &lt;span class="n"&gt;destrulesid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;list_nodes&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rule&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="n"&gt;natdest_all&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;destruleid&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;destrulesid&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="sd"&gt;          We build a huge DNAT dict where keys are rules id and items are dict of rule parameter :&lt;/span&gt;
&lt;span class="sd"&gt;          &amp;#39;1&amp;#39;: {&amp;#39;dstaddr&amp;#39;: &amp;#39;1.2.3.4&amp;#39;,&lt;/span&gt;
&lt;span class="sd"&gt;                &amp;#39;outbound-interface&amp;#39;: &amp;#39;eth1&amp;#39;,&lt;/span&gt;
&lt;span class="sd"&gt;                &amp;#39;log&amp;#39;: &amp;#39;enable&amp;#39;,&lt;/span&gt;
&lt;span class="sd"&gt;                &amp;#39;protocol&amp;#39;: &amp;#39;all&amp;#39;,&lt;/span&gt;
&lt;span class="sd"&gt;                &amp;#39;translateaddr&amp;#39;: &amp;#39;10.1.2.3&amp;#39;}&lt;/span&gt;
&lt;span class="sd"&gt;          &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
          &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rule &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;destruleid&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
          &lt;span class="n"&gt;natdest&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_nat_dest_rule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
          &lt;span class="n"&gt;natdest_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;destruleid&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;natdest&lt;/span&gt;
      &lt;span class="c1"&gt;#print(natdest_all)&lt;/span&gt;

      &lt;span class="c1"&gt;# Continue with SNAT rules&lt;/span&gt;
      &lt;span class="n"&gt;srcrulesid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;list_nodes&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rule&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="n"&gt;natsrc_all&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;srcruleid&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;srcrulesid&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="sd"&gt;          Same as the DNAT dict&lt;/span&gt;
&lt;span class="sd"&gt;          &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
          &lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rule &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;srcruleid&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
          &lt;span class="n"&gt;srcdest&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;get_nat_source_rule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
          &lt;span class="n"&gt;natsrc_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;srcruleid&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;srcdest&lt;/span&gt;
      &lt;span class="c1"&gt;#print(natsrc_all)&lt;/span&gt;

      &lt;span class="c1"&gt;# We now have two huge dictionnaries with DNAT and SNAT rules from VyOS&lt;/span&gt;
      &lt;span class="c1"&gt;# We are going to process them and POST them to NSX :crossed_fingers:&lt;/span&gt;

      &lt;span class="c1"&gt;# Replace edge-XXX with the right edge-id&lt;/span&gt;
      &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://&lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt;/api/4.0/edges/&lt;/span&gt;&lt;span class="si"&gt;{1}&lt;/span&gt;&lt;span class="s2"&gt;/nat/config/rules&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nsx_manager&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;edge_id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s1"&gt;&amp;#39;Accept&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;application/xml&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s1"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;application/xml&amp;#39;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;

      &lt;span class="n"&gt;dstnat_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create_dstnat_payload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;natdest_all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;srcnat_payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create_srcnat_payload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;natsrc_all&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

      &lt;span class="c1"&gt;# This script is ment to be be run only once&lt;/span&gt;
      &lt;span class="c1"&gt;# Write your Vsphere login and password here&lt;/span&gt;
      &lt;span class="c1"&gt;# Don&amp;#39;t commit your login and passord to git!!!!!!!!!&lt;/span&gt;
      &lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;
      &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;

      &lt;span class="c1"&gt;# POST DNAT rules&lt;/span&gt;
      &lt;span class="c1"&gt;# This request append the rules to the existing ones&lt;/span&gt;
      &lt;span class="c1"&gt;#print(dstnat_payload)&lt;/span&gt;
      &lt;span class="n"&gt;dstresponse&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;POST&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dstnat_payload&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;HTTPBasicAuth&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dstresponse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dstresponse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

      &lt;span class="c1"&gt;# POST SNAT rules&lt;/span&gt;
      &lt;span class="c1"&gt;# This request append the rules to the existing ones&lt;/span&gt;
      &lt;span class="c1"&gt;#print(srcnat_payload)&lt;/span&gt;
      &lt;span class="n"&gt;srcresponse&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;POST&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;srcnat_payload&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;HTTPBasicAuth&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;srcresponse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;srcresponse&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</content><category term="Automatisation"></category><category term="automatisation"></category><category term="python"></category><category term="vyos"></category><category term="nsx"></category><category term="reseau"></category></entry><entry><title>Cisco Hyperflex - Supprimer la configuration réseau de réplication</title><link href="https://blog.devarieux.net/2021/02/reset-hyperflex-replication-network.html" rel="alternate"></link><published>2021-02-03T21:40:00+01:00</published><updated>2021-02-03T21:40:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2021-02-03:/2021/02/reset-hyperflex-replication-network.html</id><summary type="html">&lt;p&gt;Cette semaine, j'ai pris le temps de jouer avec une instance de demo Cisco Hyperflex sur &lt;a class="reference external" href="https://dcloud.cisco.com/"&gt;dcloud.cisco.com&lt;/a&gt;. Cette demo permet de jouer un peu avec deux instances Hyperflex et notamment de mettre en place un PRA entre ces deux instances.
Pour mettre en oeuvre ce PRA, il faut …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Cette semaine, j'ai pris le temps de jouer avec une instance de demo Cisco Hyperflex sur &lt;a class="reference external" href="https://dcloud.cisco.com/"&gt;dcloud.cisco.com&lt;/a&gt;. Cette demo permet de jouer un peu avec deux instances Hyperflex et notamment de mettre en place un PRA entre ces deux instances.
Pour mettre en oeuvre ce PRA, il faut au préalable configurer un réseau de réplication (Replication Network) qui doit permettre aux clusters Hyperflex de communiquer entre eux et transférer les données. Malheureusement, par inattention, j'ai fait une erreur lors de la configuration de ce réseau. J'ai paramétré une mauvaise adresse de réseau et une mauvaise gateway et la réplication refusait de fonctionner.&lt;/p&gt;
&lt;p&gt;Cette erreur de configuration m'a posé plus de problèmes que ce que je pensais car il n'est pas possible de reconfigurer ce réseau une fois qu'il est enregistré... Cela est indiqué noir sur blanc dans la &lt;a class="reference external" href="https://www.cisco.com/c/en/us/td/docs/hyperconverged_systems/HyperFlex_HX_DataPlatformSoftware/AdminGuide/2_5/b_HyperFlexSystems_AdministrationGuide_2_5/b_HyperFlexSystems_AdministrationGuide_2_5_chapter_01111.html#task_agm_yqs_m1b"&gt;documenation Cisco Hyperflex&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Ce problème ne peut pas se régler par l'interface graphique. Il faut passer par la ligne de commande, directement sur le cluster. Ces commandes doivent être exécutées sur une des controller VM du cluster.
Le première commande permet de supprimer un appairage déjà existant entre 2 cluster. La suivante supprime effectivement la confguration du réseau de réplication.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;stcli dp peer forget --all
stcli drnetwork cleanup
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Une fois ces commandes executées, on peut de nouveau configurer le réseau de réplication.&lt;/p&gt;
&lt;img alt="Hyperflex Replication Network" src="/images/drnetwork.png" /&gt;
</content><category term="Tech"></category><category term="hyperflex"></category><category term="cisco"></category></entry><entry><title>Monitoring 101 : Que faut-il surveiller?</title><link href="https://blog.devarieux.net/2017/11/monitoring-101-que-surveiller.html" rel="alternate"></link><published>2017-11-12T16:52:00+01:00</published><updated>2017-11-12T16:52:00+01:00</updated><author><name>aldevar</name></author><id>tag:blog.devarieux.net,2017-11-12:/2017/11/monitoring-101-que-surveiller.html</id><summary type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Les métriques sont la partie la plus visible d'une architecture de supervision. Ce sont des données en général facile à récupérer et à stocker. Par conséquent, il arrive souvent qu'on n'investisse pas assez de temps dans la compréhension des données collectées, du pourquoi nous les collectons et ce que …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Les métriques sont la partie la plus visible d'une architecture de supervision. Ce sont des données en général facile à récupérer et à stocker. Par conséquent, il arrive souvent qu'on n'investisse pas assez de temps dans la compréhension des données collectées, du pourquoi nous les collectons et ce que nous en faisons. Dans la manjorité des architectures de supervision, on se concentre sur la détection simple des problèmes: détecter si un evènement ou un état à eu lieu (une ligne d'erreur dans un log, un processus qui tombe). Puis, quand on reçoit la notification du problème, on se connecte sur la plateforme de supervision pour visualiser les métriques et essayer de comprendre ce qu'il se passe. Dans cette version de la supervision, les métriques sont vues comme un supplément à la detection d'erreurs.&lt;/p&gt;
&lt;p&gt;Afin de tenter de sortir de l'ornière et utiliser pleinement les métriques comme moyen d'alerte, nous devons nous mettre d'accord sur la définition de métrique. Je vous donne donc ma version de cette définition.
Les métriques sont les mesures des propriétés d'une partie d'un logiciel ou de materiel. Pour qu'une métrique soit utile, il faut conserver une trace de son état en général en enregistrant l'observation d'une valeur à un temps donné. Une observation contient une valeur, un timestamp et parfois des propriétés (source, tag...)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="les-metriques"&gt;
&lt;h2&gt;Les Métriques&lt;/h2&gt;
&lt;p&gt;Il y a 3 catégories de métriques. Les métriques systèmes, les métriques applicatives et les évenements. Chacune de ses catégories se traite différemment et ne sert pas le même objectif.&lt;/p&gt;
&lt;div class="section" id="les-metriques-systemes"&gt;
&lt;h3&gt;Les Métriques Systèmes&lt;/h3&gt;
&lt;p&gt;Ce sont les métriques liées à l'infrastructure servant la partie applicative. Cette infrastrcuture est composée de différentes ressources qui peuvent être de bas niveau comme le materiel physique (CPU, RAM, Disques, Réseau) ou de plus haut niveau comme une base de données qui peut aussi être considéré comme une ressource afin qu'une application puisse fournir des résultats. C'est la notion de middleware. Ces métriques peuvent être classées en 3 grandes catégories :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Taux de disponiblité&lt;/strong&gt;: Pourcentage de temps durant lequel la ressource est capable de répondre à des requêtes.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Taux d'utilisation&lt;/strong&gt;: Pourcentage de temps durant lequel la ressource est occupée à répondre à des requêtes.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Contention&lt;/strong&gt;: C'est la quantité de requêtes que la ressource ne peut servir car elle est occupée. Cela peut être une file d'attente, des I/O Wait...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Voici quelques exemples de métriques systèmes :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="21%" /&gt;
&lt;col width="23%" /&gt;
&lt;col width="30%" /&gt;
&lt;col width="26%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Ressource&lt;/th&gt;
&lt;th class="head"&gt;Disponibilité&lt;/th&gt;
&lt;th class="head"&gt;Utilisation&lt;/th&gt;
&lt;th class="head"&gt;Contention&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Base de données&lt;/td&gt;
&lt;td&gt;% de temps durant
lequel la DB est
joignable&lt;/td&gt;
&lt;td&gt;% de temps durant
lequel chaque
connection est occupée&lt;/td&gt;
&lt;td&gt;Nombre de requêtes
en file d'attente&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Mémoire Vive&lt;/td&gt;
&lt;td&gt;N/A&lt;/td&gt;
&lt;td&gt;% de la RAM totale
utilisée&lt;/td&gt;
&lt;td&gt;Utilisation du swap&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="les-metriques-applicatives"&gt;
&lt;h3&gt;Les Métriques Applicatives&lt;/h3&gt;
&lt;p&gt;C'est ici qu'est mesurée l'experience utilisateur ainsi que la santé global du service. Comme pour les métriques système, elles sont classées en plusieurs catégories.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Performance&lt;/strong&gt;: Cette métrique quantifie l'efficacité d'un composant. La métrique de performance la plus commune est la latence, qui représente le temps nécessaire pour accomplir une tâche. Il y a plusieurs façon d'exprimer cette métrique. On peut en faire une moyenne ou utiliser les percentiles, du type &amp;quot;99% des requêtes ont reçu une réponse en moins de 0.2 secondes&amp;quot;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Debit&lt;/strong&gt;: ou également &lt;strong&gt;entrées sorties&lt;/strong&gt;. C'est la quantité de requêtes traitée par unité de temps. Par exemple, un nombre de pages affichées par seconde.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Succès&lt;/strong&gt;: C'est le pourcentage d'entrées sorties traitées dont l'execution s'est bien déroulée. Par exemple, le nombre de code HTTP 2XX.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Echec&lt;/strong&gt;: A l'inverse, le pourcentage d'entrée sorties traitées dont l'execution s'est mal déroulée. Par exemple, le nombre de code HTTP 5XX.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ces métriques permettent de rapidement répondre aux questions qui intéressent les utilisateurs finaux du service. Le service est-il disponible et remplit-il sa mission? A quelle vitesse le fait-il? Avec quelles résultats?&lt;/p&gt;
&lt;p&gt;Voici quelques exemples de métriques applicatives pour un service web:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="19%" /&gt;
&lt;col width="68%" /&gt;
&lt;col width="12%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Catégorie&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;th class="head"&gt;Valeur&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Performance&lt;/td&gt;
&lt;td&gt;99ème percentil du temps de réponse (s)&lt;/td&gt;
&lt;td&gt;0.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Débit&lt;/td&gt;
&lt;td&gt;Requêtes par seconde&lt;/td&gt;
&lt;td&gt;220&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Succès&lt;/td&gt;
&lt;td&gt;Pourcentage de code retour HTTP 2XX&lt;/td&gt;
&lt;td&gt;99.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Echec&lt;/td&gt;
&lt;td&gt;Pourcentage de code retour HTTP 5XX&lt;/td&gt;
&lt;td&gt;0.2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="les-evenements"&gt;
&lt;h3&gt;Les Evenements&lt;/h3&gt;
&lt;p&gt;En plus des métriques systèmes et applicatives, il y a certaine information qu'on souhaite récupérer de façon plus sporadique. Certains systèmes permettent de superviser des évenements. Les évenements n'ont pas lieu de façon fréquentes et il est souvent difficile voir impossible de les prévoir.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Tâche planifiée en échec&lt;/li&gt;
&lt;li&gt;Virus détecté dans un système de fichier&lt;/li&gt;
&lt;li&gt;Trap SNMP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Contrairement aux métriques qui doivent être analysées dans leur context, les évenements contiennent en général en eux-même suffisamment d'informations pour être directement interprétés.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;Dans le doute, ne pas hésiter à collecter les données. Sachant que ces données doivent être &lt;strong&gt;bien comprises&lt;/strong&gt; (je sais ce que cette donnée signifie), avoir une &lt;strong&gt;granularité&lt;/strong&gt; adequat (si la granularité est trop large, je perds en précision; si la granularité est trop fine je risque d'impacter le système que je supervise) et être &lt;strong&gt;conservée suffisamment&lt;/strong&gt; longtemps pour comprendre quels sont les comportements normaux et anormaux.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="Supervision"></category></entry><entry><title>HyperText Acte 1</title><link href="https://blog.devarieux.net/2017/11/hypertexte-acte-1.html" rel="alternate"></link><published>2017-11-03T22:45:00+01:00</published><updated>2017-11-03T22:45:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2017-11-03:/2017/11/hypertexte-acte-1.html</id><summary type="html">&lt;p class="first last"&gt;Voici une collection de liens trouvés ou partagés dernièrement. Je les penses suffisamment utiles pour vous les partager à mon tour.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Bienvenue dans Hypertexte Acte 1. Vous trouverez ici des articles en général plutôt techniques et majoritairement en anglais sur différents sujets dont l'administration système, le réseau, la virtualisation ou encore le savoir être en entreprise (soft skill).&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;[EN] Un article de Quinn Norton sur l'état de l'art en developpement. Il compare le developpement des applications actuelles à des constructions de ponts. La comparaison souffre de quelques biais mais l'article vaut vraiment le coup d'être lu : &lt;a class="reference external" href="https://www.emptywheel.net/2017/09/14/software-is-a-long-con/"&gt;SOFTWARE IS A LONG CON&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;[EN] Suite à la sortie des CPU dédiés serveurs &lt;tt class="docutils literal"&gt;Intel Xeon Scalable&lt;/tt&gt;, FRANK DENNEMAN passe en revu les nouveautés apportées par ces CPU en terme de virtualisation de l'execution. Un article incontournable si vous administrez des clusters de virtualisation : &lt;a class="reference external" href="http://frankdenneman.nl/2017/09/26/vsphere-focused-guide-intel-xeon-scalable-family/"&gt;A vSphere Focused Guide to the Intel Xeon Scalable Family&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;[FR] Un podcast, en français, consacré au DevOps. Deux épisodes publiés à ce jour: &lt;a class="reference external" href="https://soundcloud.com/devobs"&gt;DevObs&lt;/a&gt;. Mon seul regret est qu'il n'y a pas de flux RSS pour ajouter simplement ce podcast dans une appli dédiée.&lt;/li&gt;
&lt;li&gt;[EN] Linux : Auditer la suppression des fichiers avec Auditd. Permet de 'trouver le coupable' si on ne sait pas comment des fichiers disparaissent du filesystem : &lt;a class="reference external" href="http://run.tournament.org.il/audit-delete-commands-in-linux/"&gt;Audit delete commands in Linux&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Lors de la migration de ce blog en statique via Pelican, je me suis lancé à la recherche d'une solution d'analyse de traffic. Je souhaitais une solution non intrusive (sans code à charger par le navigateur), un peu du style awstat. Je suis tombé sur le &lt;a class="reference external" href="http://goaccess.io"&gt;projet Goaccess&lt;/a&gt;, que je ne connaissais pas et qui rempli admirablement bien son rôle en faisant de l'analyse des logs apache en temps réel.&lt;/li&gt;
&lt;li&gt;[FR] La semaine prochaine, du 7/11 au 9/11 aura lieu l'évenement européen de Nutanix: le .NEXT Europe à Nice. Je participerai à une discussion le 8/11 à 13h afin de faire un retour d'experience sur la mise en oeuvre de cette solution dans mon entreprise. Nutanix a récemment sortie la version 5 d'AOS qui propose un grand nombre de nouvelles fonctionnalités. C'est pourquoi sur VirtualementVotre, on n'hésite plus à poser la question : &lt;a class="reference external" href="http://www.virtualementvotre.ch/blog/2017/10/30/pourquoi-nutanix-ahv-est-une-reelle-option/"&gt;Pourquoi Nutanix AHV est une réelle option ?&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;[FR] Un looooong article expliquant &lt;a class="reference external" href="https://medium.com/&amp;#64;djo/obsession-service-client-captain-train-cb0b91467fd9"&gt;l’obsession du service client chez Captain Train&lt;/a&gt;. Vraiment passionant et instructif.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;C'est ici que ça se termine. N'hésitez pas à revenir dans quelques temps pour le prochain numéro d'hypertexte. En attendant, n'hésitez pas à me &lt;a class="reference external" href="https://twitter.com/landvarx"&gt;contacter sur twitter&lt;/a&gt; si vous avez un lien qui aurait sa place dans un futur article.&lt;/p&gt;
</content><category term="Tech"></category><category term="lien"></category></entry><entry><title>Migration du Blog sur Pelican</title><link href="https://blog.devarieux.net/2017/11/migration-blog-pelican.html" rel="alternate"></link><published>2017-11-02T22:45:00+01:00</published><updated>2017-11-02T22:45:00+01:00</updated><author><name>Aldevar</name></author><id>tag:blog.devarieux.net,2017-11-02:/2017/11/migration-blog-pelican.html</id><summary type="html">&lt;p class="first last"&gt;Migration du blog sur Pelican, generateur de site static en Python.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Après avoir passé plusieurs années avec Wordpress, j'ai décidé de passé le blog en static sur &lt;a class="reference external" href="https://blog.getpelican.com"&gt;Pelican&lt;/a&gt;. Les raisons de ce choix sont multpiples :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Wordpress est très vulnérable aux attaques et demande un grand niveau d'attention pour que le blog reste en sécurité. Notamment pour ce qui concerne les plugins.&lt;/li&gt;
&lt;li&gt;Wordpress est très puissant, peut être trop puissant pour un simple blog.&lt;/li&gt;
&lt;li&gt;J'avais besoin de nouveauté et de simplicité.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dorénavant, les articles seront rédigés en reStructuredText puis compilés par Pelican afin de générer ce site statique. Dans l'opération, les commentaires ont disparu.&lt;/p&gt;
</content><category term="MyLife"></category><category term="blog"></category><category term="python"></category><category term="pelican"></category></entry><entry><title>Monitoring 101 : Les alertes durant les astreintes</title><link href="https://blog.devarieux.net/2017/10/monitoring-101-alertes-durant-astreintes.html" rel="alternate"></link><published>2017-10-29T19:30:00+01:00</published><updated>2017-10-29T19:30:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2017-10-29:/2017/10/monitoring-101-alertes-durant-astreintes.html</id><summary type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Après avoir déployé un système de supervision dans une infrastructure de
taille moyenne et avoir passé quelques temps en rotation dans une équipe
d'astreinte, j'ai tiré un certains nombre de conclusions sur ce que
devrait être la supervision et surtout les alertes qui doivent être
levées lors des astreintes …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Après avoir déployé un système de supervision dans une infrastructure de
taille moyenne et avoir passé quelques temps en rotation dans une équipe
d'astreinte, j'ai tiré un certains nombre de conclusions sur ce que
devrait être la supervision et surtout les alertes qui doivent être
levées lors des astreintes. L'écriture et l'audit de règles d'alertes
doivent respecter certains principes afin que les astreintes se
déroulent le plus sereinement possible:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Une alerte envoyée en astreinte doit être urgente, réelle et
concrète. C'est à dire qu'il doit être possible d'intervenir pour
corriger le problème.&lt;/li&gt;
&lt;li&gt;Une alerte doit être levée pour des problèmes imminent ou en cours.&lt;/li&gt;
&lt;li&gt;Ne pas hésiter à supprimer les alertes générant du bruit. L'excès de
supervision nuit à la supervision.&lt;/li&gt;
&lt;li&gt;La meilleur façon de comprendre un problème est d'alerter sur ses
symptômes.&lt;/li&gt;
&lt;li&gt;Corollaire : Eviter d'alerter directement sur les causes.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Avant de détailler un peu plus ces principes, voici les 3 règles majeurs
qui, à mon sens, doivent servir de guide:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;A chaque fois que je reçois une alerte, &lt;strong&gt;je dois la considérer comme
urgente&lt;/strong&gt; et agir comme tel. Je ne peux agir comme ça trop souvent
avant de ressentir une lassitude.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Chaque alerte doit être concrète&lt;/strong&gt;. Je dois pouvoir réaliser une
action pour la corriger.&lt;/li&gt;
&lt;li&gt;Chaque action sur alerte doit se faire avec un certain &lt;strong&gt;niveau
d'expertise&lt;/strong&gt;. Si le problème peut être traité par un script, alors
je n'aurais pas du être dérangé.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Vu comme ça, c'est un peu ambitieux mais ces règles doivent avant tout
servir de guides pour l'écriture et la revue des alertes. Voici quelques
questions qu'on peut se poser lors de l'écriture d'une nouvelle règle:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Cette nouvelle règle ne vient-elle pas surcharger une règle déjà
existante qui est elle-même urgente, concrète et impactante.&lt;/li&gt;
&lt;li&gt;Vais-je un jour ignorer cette alerte sachant qu'elle est bénigne?
Puis-je affiner cette règle pour éviter cette situation?&lt;/li&gt;
&lt;li&gt;Cette alerte se lève-t-elle pour une condition qui va réellement
impacter les utilisateurs?&lt;/li&gt;
&lt;li&gt;Il y a-t-il des actions à mener en réponse à cette alerte? Cette
action doit-elle être réalisée tout de suite ou peut-elle attendre
demain matin, ou lundi, ou le trimestre prochain?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Evidemment, aucun système d'alerte dans une infrastructure croissante et
changeante n'est aussi parfait que celui que je viens de décrire mais ce
sont quelques règles qui permettent de s'en approcher autant que
possible.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="avoir-une-vue-utilisateurs"&gt;
&lt;h2&gt;Avoir une vue utilisateurs&lt;/h2&gt;
&lt;p&gt;C'est ce que qu'on appelle la &amp;quot;&lt;strong&gt;supervision des symptômes&lt;/strong&gt;&amp;quot;, opposée
à la &amp;quot;&lt;strong&gt;supervision des causes&lt;/strong&gt;&amp;quot;. Un petit exemple afin de préciser
le propos : vos utilisateurs se soucient-ils de savoir si votre serveur
SQL est down? Non, ils s'inquiètent si leur requêtes sont en échecs (je
vous entends déjà pleurer sur vos petits check 'SQL Server' Nagios).&lt;/p&gt;
&lt;p&gt;En général, les utilisateurs se soucient d'un petit nombre d’éléments:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Disponibilité&lt;/strong&gt;. Pas d'erreur 500, de requête en attente, de pages
a moitié chargées. Un service qui ne fonctionne pas pleinement doit
être considéré comme un service non disponible.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Latence.&lt;/strong&gt;&amp;nbsp;ça doit aller vite!&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exactitude des données&lt;/strong&gt;. Les données doivent être en sécurité.
Elles doivent aussi être à jour.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fonctionnalités.&lt;/strong&gt;Le service doit fournir toutes ses
fonctionnalités, même si ce n'est pas une fonction principale du
service. Par exemple, l'auto-complétion dans un champ de recherche.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;C'est à peu prêt tout.&lt;/p&gt;
&lt;p&gt;La différence entre un serveur de base de données &lt;em&gt;down&lt;/em&gt; et des données
utilisateurs non disponible est très importante. La première est une
cause, la seconde est un symptôme et l’indisponibilité des données peu
provenir de plusieurs choses. On peut avoir un problème d'I/O ou de CPU
sur le serveur de BDD, rendant les temps de réponses trop long. Vous
n'allez pas pour autant lever une alerte chaque fois que le CPU est à
100% ou chaque fois que l'I/O Wait monte à 60%. Avoir une vue
utilisateur permet de directement savoir si un problème nécessite une
intervention.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="alerter-sur-les-causes-c-est-nul-mais-parfois-on-n-a-pas-le-choix"&gt;
&lt;h2&gt;Alerter sur les causes, c'est nul! (mais parfois, on n'a pas le choix)&lt;/h2&gt;
&lt;p&gt;On sait bien que si le serveur de BDD est down les utilisateurs n'auront
pas accès à leur données et il est très tentant de superviser juste le
serveur de BDD et d'ajouter une supervision sur la bonne connexion du
service à la BDD. Ceci pose d'autres problèmes :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Il faudra de toute façon vérifier les symptômes. Peut être avons nous
des déconnexions réseaux intempestives, de la contention sur le CPU
ou sur les performances du stockages (qui a dit backup en cours?) ou
une tonnes d'autres problèmes auxquels on ne pense pas. On doit donc
vérifier les symptômes.&lt;/li&gt;
&lt;li&gt;Si on attrape les symptômes et les causes, on se retrouve avec une
redondance des alertes et on a donc soit de la duplication d'alerte
soit la mise en place d'un système de dépendances entre les alertes
qui ajoute de la complexité.&lt;/li&gt;
&lt;li&gt;Peut être qu'un cluster de base de données a été créé et qu'on ne se
soucie plus de savoir qu'un serveur est tombé.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Mais il est vrai que parfois, les alertes sur les causes sont
nécessaires. Par exemple, en général, il n'y a pas de symptômes sur des
problèmes d'espace disque plein à 95% et il est pourtant nécessaire
d'agir avant qu'un manque d'espace ne vienne perturber le service. Ce
type d'alerte est à utiliser avec parcimonie.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="des-tickets-des-emails"&gt;
&lt;h2&gt;Des tickets, des emails...&lt;/h2&gt;
&lt;p&gt;Qu'on le veuille ou non, on se retrouve toujours avec des alertes qu'on
peut qualifier de non critique. Elles méritent qu'on s'en occupe, mais
pas forcement maintenant.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Dans ce cas, l'ouverture d'un ticket peut-être utile. Votre
plateforme du supervision ouvre un ticket que vous pourrez traiter
lorsque vous aurez plus de temps (après la nuit par exemple).&lt;/li&gt;
&lt;li&gt;Chaque alerte devrait automatiquement être tracée quelque part. Par
seulement les envoyer par e-mail, sur un canal IRC ou dans un canal
Slack. En général, ce type d'envoie permet juste de mieux ignorer les
alertes.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Le point soulevé ici est qu'il est important de créer un système
d'astreinte qui limite la lassitude, responsabilise sur la réactivité et
qui ne va pas trop régulièrement réveiller la personne d'astreinte,
l'interrompre dans son dîner ou l'empêcher de passer du temps avec sa
famille.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="procedure"&gt;
&lt;h2&gt;Procédure&lt;/h2&gt;
&lt;p&gt;Il est préférable d'avoir une documentation dédiée pour chaque alerte ou
famille d'alerte qui est susceptible d'être levée. Cette documentation
doit expliquer ce que signifie l'alerte et comment elle peut être
résolue.&lt;/p&gt;
&lt;p&gt;Cette documentation ne doit pas être un long pavé expliquant toute
l'architecture en long et en large. Elle doit expliquer brièvement les
points à vérifier et les différentes actions à mener.&lt;/p&gt;
&lt;p&gt;Inversement, la documentation ne doit pas être une simple commande à
taper ou une action simpliste à réaliser. Cela signifierai que l'action
de correction est scriptable et n'aurait pas du déranger la personne
d'astreinte. L'alerte devrait être levée si l’exécution du script ne
corrige pas le problème et nécessite alors une intervention humaine.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ne-soyez-pas-naif"&gt;
&lt;h2&gt;Ne soyez pas naïf!&lt;/h2&gt;
&lt;p&gt;Voici quelques bonnes raisons de ne pas respecter ces règles :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Vous avez une cause connue qui fait qu'un service répond de façon
aléatoire&lt;/strong&gt;. Dans ce cas, alerter sur un les symptômes ne sera pas
d'une grande aide et il est plus simple d'alerter sur la cause.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les symptômes apparaissent quand c'est déjà trop tard&lt;/strong&gt;, par
exemple quand il n'y a plus d'espace disque.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le système d'alerte semble être plus complexe que le problème qu'il
tente de détecter&lt;/strong&gt;. Le but est de tendre vers plus de simplicité,
plus de robustesse et des système auto-réparant. Avant d'atteindre
cet objectif sur le moyen terme, il est possible qu'il soit plus
efficace d'avoir un système d'alerte complexe mais qui soit fiable et
ne lève pas trop de faux positifs.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Supervision"></category></entry><entry><title>State SaltStack pour déploiement de Zabbix-agent</title><link href="https://blog.devarieux.net/2016/08/state-saltstack-deploiement-de-zabbix-agent.html" rel="alternate"></link><published>2016-08-10T15:36:00+02:00</published><updated>2016-08-10T15:36:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-08-10:/2016/08/state-saltstack-deploiement-de-zabbix-agent.html</id><summary type="html">&lt;p&gt;SaltStack est un gestionnaire de configuration comparable à Ansible,
Chef ou Puppet fonctionnant sur le modèle Client/Serveur. Le serveur
Salt est appelé 'master' et les clients des 'minions'. Les states sont
des listes de commandes que le serveur fait exécuter par le client. On
utilise YAML pour écrire les …&lt;/p&gt;</summary><content type="html">&lt;p&gt;SaltStack est un gestionnaire de configuration comparable à Ansible,
Chef ou Puppet fonctionnant sur le modèle Client/Serveur. Le serveur
Salt est appelé 'master' et les clients des 'minions'. Les states sont
des listes de commandes que le serveur fait exécuter par le client. On
utilise YAML pour écrire les states.&lt;/p&gt;
&lt;p&gt;Comme je l'avais promis
à&amp;nbsp;&lt;a class="reference external" href="https://twitter.com/SteveDESTIVELLE"&gt;&amp;#64;SteveDESTIVELLE&lt;/a&gt;&amp;nbsp;voici le
state SaltStack que nous utilisons pour déployer rapidement et
simplement l'agent Zabbix sur nos serveurs.&lt;/p&gt;
&lt;p&gt;Ce state installe zabbix-agent sur les serveur Windows 32 et 64bits, sur
les CentOS 6 et 7 ainsi que sur Debian Wheezy. Il est assez simple d'y
ajouter la prise en charge d'autres OS. Sur les linux, le repository
Zabbix est déployé pour faciliter l'installation et la mise à jour de
l'agent. Enfin, le state pousse également le fichier de configuration de
zabbix-agent. Pensez à bien y ajouter le nom ou l'adresse IP de votre
serveur (fichier&amp;nbsp;files/linux/zabbix/zabbix_agentd.conf&amp;nbsp; et
files/windows/zabbix/conf/zabbix_agentd.win.conf&amp;nbsp;).&lt;/p&gt;
&lt;p&gt;Enfin, le state ouvre le firewall Windows, n'oubliez pas d'ajouter l'IP
de votre serveur Zabbix ligne 122 de init.sls&amp;nbsp;&amp;nbsp;.&lt;/p&gt;
&lt;p&gt;Pour télécharger les fichiers, ça se passe &lt;a class="reference external" href="https://github.com/aldevar/Zabbix_SaltState"&gt;sur
github&lt;/a&gt;.&lt;/p&gt;
</content><category term="Supervision"></category><category term="automation"></category><category term="yaml"></category><category term="zabbix-agent"></category></entry><entry><title>Superviser un serveur HAproxy avec Zabbix</title><link href="https://blog.devarieux.net/2016/08/superviser-serveur-haproxy-zabbix.html" rel="alternate"></link><published>2016-08-01T08:30:00+02:00</published><updated>2016-08-01T08:30:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-08-01:/2016/08/superviser-serveur-haproxy-zabbix.html</id><summary type="html">&lt;p&gt;Après avoir monté le &lt;a class="reference external" href="/monter-cluster-galera-mariadb.html"&gt;cluster MariaDB
Galera&lt;/a&gt;
et placé un serveur &lt;a class="reference external" href="/galera-load-balancing-failover-haproxy.html"&gt;HAproxy en
frontal&lt;/a&gt;,
il me restait encore à mettre en place la supervision de ce cluster. Je
voulais notamment, en dehors de la supervision de base&amp;nbsp;qu'on peut
déployer sur un serveur (classiquement processeurs / RAM / disques /
Réseau) pouvoir visualiser …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Après avoir monté le &lt;a class="reference external" href="/monter-cluster-galera-mariadb.html"&gt;cluster MariaDB
Galera&lt;/a&gt;
et placé un serveur &lt;a class="reference external" href="/galera-load-balancing-failover-haproxy.html"&gt;HAproxy en
frontal&lt;/a&gt;,
il me restait encore à mettre en place la supervision de ce cluster. Je
voulais notamment, en dehors de la supervision de base&amp;nbsp;qu'on peut
déployer sur un serveur (classiquement processeurs / RAM / disques /
Réseau) pouvoir visualiser l'état du cluster rapidement.&lt;/p&gt;
&lt;p&gt;Je me suis lancé dans la recherche d'un template Zabbix déjà existant
pour superviser HAproxy mais je n'ai rien trouvé de convainquant.&amp;nbsp;Je me
suis décidé à écrire mon propre template et donc le script qui va avec.&lt;/p&gt;
&lt;p&gt;Avant d'utiliser ce script, il faut activer les stats dans le fichiers
de configuration d'HAproxy dans la section [global]&lt;/p&gt;
&lt;pre class="code sh literal-block"&gt;
&lt;span class="c1"&gt;# turn on stats unix socket
&lt;/span&gt;stats socket /var/lib/haproxy/stats
&lt;/pre&gt;
&lt;p&gt;Le script Python va ensuite lire les données en communiquant avec le
socket d'HAproxy directement et retourner la statistique demandée pour
le couple frontend/serveur.&lt;/p&gt;
&lt;p&gt;Voici le script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#! /usr/bin/python&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;itertools&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;

&lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;px&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;sv&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;queryStat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Usage: run script with one or three arguments&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;One argument: &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;    discovery : json output of discovered pxname and svname &lt;/span&gt;&lt;span class="se"&gt;\n\n&lt;/span&gt;&lt;span class="s2"&gt;Three arguments:&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;    pxname : pxname in which you want to process the stat&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;    svname : svname in the pxname in which you want to process the stat&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s2"&gt;    stat : stat you want to query for pxname,svname&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;allstats&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Popen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;echo &amp;quot;show stat&amp;quot; | socat /var/lib/haproxy/stats stdio&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PIPE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;communicate&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;discovery&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;haDiscovery&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;myLine&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;allstats&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
        &lt;span class="n"&gt;lineStats&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myLine&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;pxname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;lineStats&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;svname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;lineStats&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;haDiscovery&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{#PXNAME}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pxname&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{#SVNAME}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;svname&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;data&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;haDiscovery&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;statNameList&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;allstats&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;monDico&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;myLine&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;allstats&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="n"&gt;statList&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myLine&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;px&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;statList&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;sv&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;statList&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
        &lt;span class="n"&gt;monDico&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;itertools&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;izip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;statNameList&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;statList&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="n"&gt;monDico&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;queryStat&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Une fois toutes ces métriques récupérées, j'ai pu construire un
dashboard Grafana afin d'avoir rapidement sous les yeux l'état général
du cluster.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/Grafana-Galera.png"&gt;&lt;img alt="Grafana-GaleraMariaDB et HAproxy" class="image-process-large-photo" src="/images/Grafana-Galera.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Le script, le template Zabbix et le fichier de paramétrage de l'agent
sont disponible &lt;a class="reference external" href="https://github.com/aldevar/Zabbix_HAproxy"&gt;sur
Github&lt;/a&gt;&lt;/p&gt;
</content><category term="Supervision"></category></entry><entry><title>Zabbix - Superviser un cluster Ceph</title><link href="https://blog.devarieux.net/2016/07/zabbix-superviser-cluster-ceph.html" rel="alternate"></link><published>2016-07-05T21:45:00+02:00</published><updated>2016-07-05T21:45:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-07-05:/2016/07/zabbix-superviser-cluster-ceph.html</id><summary type="html">&lt;p&gt;Ceph est une solution open source de stockage distribué avec réplication
des données et une forte tolérance aux pannes. Différentes commandes
existent pour vérifier l'état du cluster et nous allons voir comment les
exploiter avec des scripts Python pour que Zabbix puisse récupérer les
métriques.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Ceph_Logo" src="/images/Ceph_Logo.png" /&gt;&lt;/p&gt;
&lt;p&gt;Je suis parti d'un &lt;a class="reference external" href="https://github.com/thelan/ceph-zabbix"&gt;template …&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;Ceph est une solution open source de stockage distribué avec réplication
des données et une forte tolérance aux pannes. Différentes commandes
existent pour vérifier l'état du cluster et nous allons voir comment les
exploiter avec des scripts Python pour que Zabbix puisse récupérer les
métriques.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Ceph_Logo" src="/images/Ceph_Logo.png" /&gt;&lt;/p&gt;
&lt;p&gt;Je suis parti d'un &lt;a class="reference external" href="https://github.com/thelan/ceph-zabbix"&gt;template déjà
existant&lt;/a&gt;, avec un script bash
qui exécute les commandes, parse la sortie et retourne la métrique
attendue. Ce script, à mon avis, a cependant un problème. A chaque
exécution,&amp;nbsp;il exécute toutes les commandes, parse toutes les réponses et
retourne enfin la métrique attendue suivant l'argument passé en entrée.
Ce comportement peu optimisé induit que parfois, suivant la charge du
serveur, l’exécution du script peut prendre trop de temps et l'item
Zabbix tombe en timeout. Ce n'est évidemment pas un comportement que
nous souhaitons avoir.&lt;/p&gt;
&lt;p&gt;Puisqu'il fallait reprendre le script, je me suis lancé dans sa complète
réécriture en Python. J'ai pu ainsi profiter du format json proposé par
les outils Ceph pour l'output des données et également du module json
inclus dans Python. Cela m'a permis de gagner du temps (pour moi et le
processeur) car je peux parser les données plus facilement. Le script
bash utilise beaucoup d'expressions régulières via sed. Dorénavant, je
n'ai qu'à appeler le bon objet json et l'afficher.&lt;/p&gt;
&lt;p&gt;La version actuel du template comporte 3 scripts. Je peux encore
optimisé tout cela en 1 seul fichier, ce sera pour la prochaine version.
Le premier script nommé cephpools.py permet la découverte automatique
des pools rados Ceph. Le second, cephimages.py, permet quant à lui la
découverte automatique des images rbd de chaque pool. C'est également ce
script qui est appelé pour récupérer la taille des images.&lt;/p&gt;
&lt;p&gt;Enfin, le script principal ceph-status.py s'occupe de retourner les
valeurs des métriques à &amp;nbsp;Zabbix : état des pg, santé du cluster, IOPS,
état des mon etc.&lt;/p&gt;
&lt;p&gt;Vous pouvez retrouver ces scripts et template zabbix &lt;a class="reference external" href="https://github.com/aldevar/ceph-zabbix"&gt;sur la page github
dédiée&lt;/a&gt;&lt;/p&gt;
</content><category term="Supervision"></category><category term="ceph"></category><category term="devops"></category><category term="python"></category><category term="zabbix"></category></entry><entry><title>Zimbra : Envoi de mails via un relais SMTP authentifié</title><link href="https://blog.devarieux.net/2016/06/relais-smtp-authentifie-zimbra.html" rel="alternate"></link><published>2016-06-24T08:30:00+02:00</published><updated>2016-06-24T08:30:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-06-24:/2016/06/relais-smtp-authentifie-zimbra.html</id><summary type="html">&lt;p&gt;Héberger soi même ses données c'est bien, le faire correctement c'est
mieux. Le problème majeur lorsqu'on souhaite héberger soi même ses mails
est qu'il est difficile de s'assurer que les mails soient bien reçus par
nos correspondants.&lt;/p&gt;
&lt;p&gt;Il arrive souvent que l'IP fournie par l’hébergeur fasse partie d'un
bloc …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Héberger soi même ses données c'est bien, le faire correctement c'est
mieux. Le problème majeur lorsqu'on souhaite héberger soi même ses mails
est qu'il est difficile de s'assurer que les mails soient bien reçus par
nos correspondants.&lt;/p&gt;
&lt;p&gt;Il arrive souvent que l'IP fournie par l’hébergeur fasse partie d'un
bloc d'IP bannie par plusieurs serveur SMTP. Il est toujours possible de
se faire débloquer des principales blacklists mais la plupart des
services mails possèdent leur propre blacklist (coucou barracuda). Même
un SPF et un DKIM bien configuré ne suffisent pas à outrepasser ces
blocages.&lt;/p&gt;
&lt;p&gt;Plusieurs solutions s'offraient à moi pour contourner ce problème.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Changer d'adresse IP: ça peut fonctionner mais impossible de savoir
tant qu'on a pas testé la nouvelle IP. Forte &amp;nbsp;probabilité que cette
IP fasse également partie d'un bloc blacklisté&lt;/li&gt;
&lt;li&gt;Passer sur un hébergeur Zimbra : Intéressant, mais souvent très cher.
De l'ordre de 5€/mois et par compte minimum.&lt;/li&gt;
&lt;li&gt;Passer par un relais SMTP : J'ai opté pour cette solution même si
elle n'est pas idéal car cela ajoute intermédiaire et une dépendance
pour le service.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour mettre cette solution en oeuvre, j'ai choisi le service smtp2go. Il
y en a beaucoup d'autres et la plupart proposent des services gratuits
pour un envoi limité de mails. Avec smtp2go, le service est gratuit
jusqu'à 1000 mails par mois ce qui devrait être suffisant.&lt;/p&gt;
&lt;p&gt;Une fois l'inscription effectuée, il faut encore configurer Zimbra pour
qu'il utilise ce relais. L'interface web d'administration propose bien
d'ajouter des relais SMTP mais impossible de s'y authentifier. La
configuration d'un relais STMP authentifié doit être faite en ligne de
commande.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;monzimbra]# su - zimbra
## On ajoute le relais SMTP
[root&amp;#64;monzimbra]# zmprov ms monzimbra.mondomaine.com&amp;nbsp;zimbraMtaRelayHost relaissmtp.relaisdomaine.com:port
## On créé un fichier text de mapping login/mdp pour le relais
[root&amp;#64;monzimbra]# echo relaissmtp.relaisdomaine.com USERNAME:PASSWORD &amp;gt; /opt/zimbra/conf/relay_password
## Création de la table postfix
[root&amp;#64;monzimbra]# postmap /opt/zimbra/conf/relay_password
## Pour tester. Cette commande doit retourner le couple login/mdp
[root&amp;#64;monzimbra]# postmap -q relaissmtp.relaisdomaine.com /opt/zimbra/conf/relay_password
## Configuration de postfix pour qu'il utilise la map de login/mdp
[root&amp;#64;monzimbra]# zmprov ms monzimbra.mondomaine.com zimbraMtaSmtpSaslPasswordMaps lmdb:/opt/zimbra/conf/relay_password
## Configuration de postfix pour qu'il utilise l'authentification SSL
[root&amp;#64;monzimbra]# zmprov ms monzimbra.mondomaine.com zimbraMtaSmtpSaslAuthEnable yes
## Configuration de postfix pour qu'il n'utilise pas le canonical name du relais (problème de login/mdp sinon)
[root&amp;#64;monzimbra]# zmproc ms monzimbra.mondomaine.com zimbraMtaSmtpCnameOverridesServername no
## Configuration de TLS
[root&amp;#64;monzimbra]# zmprov ms monzimbra.mondomaine.com zimbraMtaSmtpTlsSecurityLevel may
&lt;/pre&gt;
&lt;p&gt;C'est terminé, tous les domaines attachés au serveur passeront
dorénavant vers ce relais SMTP.&lt;/p&gt;
</content><category term="Tech"></category><category term="email"></category><category term="relais"></category><category term="smtp"></category><category term="spam"></category><category term="zimbra"></category></entry><entry><title>Galera Mariadb: Load balancing et Failover HAproxy</title><link href="https://blog.devarieux.net/2016/06/galera-load-balancing-failover-haproxy.html" rel="alternate"></link><published>2016-06-21T21:47:00+02:00</published><updated>2016-06-21T21:47:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-06-21:/2016/06/galera-load-balancing-failover-haproxy.html</id><summary type="html">&lt;p&gt;Après avoir mis en place le &lt;a class="reference external" href="http://blog.devarieux.net/2016/06/monter-cluster-galera-mariadb/"&gt;cluster Galera
Mariadb&lt;/a&gt;,
nous avons besoin d'un point d'accès au cluster. Ce point d'accès peut
être un proxy mysql ou tout autre serveur HA.&lt;/p&gt;
&lt;p&gt;Nous allons configurer HAproxy avec l'option leastconn pour qu'il envoie
les paquets vers la machine ayant le moins de connexions …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Après avoir mis en place le &lt;a class="reference external" href="http://blog.devarieux.net/2016/06/monter-cluster-galera-mariadb/"&gt;cluster Galera
Mariadb&lt;/a&gt;,
nous avons besoin d'un point d'accès au cluster. Ce point d'accès peut
être un proxy mysql ou tout autre serveur HA.&lt;/p&gt;
&lt;p&gt;Nous allons configurer HAproxy avec l'option leastconn pour qu'il envoie
les paquets vers la machine ayant le moins de connexions (Load
Balancing) et nous allons mettre en place un check http pour qu'en cas
de problème sur un noeud, HAproxy ne lui envoie plus de paquets
(FailOver).&lt;/p&gt;
&lt;p&gt;Pour cela, nous avons besoin du script clustercheck présent
ici&amp;nbsp;&lt;a class="reference external" href="https://github.com/olafz/percona-clustercheck"&gt;https://github.com/olafz/percona-clustercheck&lt;/a&gt;. Ce script doit être
présent sur chaque noeud du cluster mariadb.&lt;/p&gt;
&lt;div class="section" id="preparation-des-noeuds-du-cluster"&gt;
&lt;h2&gt;Préparation des nœuds du cluster&lt;/h2&gt;
&lt;p&gt;Toutes les opérations détaillées dans cette section doivent être
effectuées sur tous les nœuds du cluster mariadb.&lt;/p&gt;
&lt;p&gt;On commence par récupérer le script clustercheck, puis on créé un
utilisateur mysql pour l’exécution du script et on place le script au
bon endroit&lt;/p&gt;
&lt;pre class="literal-block"&gt;
wget&amp;nbsp;https://raw.githubusercontent.com/olafz/percona-clustercheck/master/clustercheck
mysql&amp;gt; GRANT PROCESS ON *.* TO 'clustercheckuser'&amp;#64;'localhost' IDENTIFIED BY 'clustercheckpassword!'
chmod +x clustercheck
mv clustercheck /usr/bin
&lt;/pre&gt;
&lt;p&gt;L'étape suivante consiste à créer un service xinetd dont la tâche sera
de lancer le script clustercheck à la demande.&lt;/p&gt;
&lt;p&gt;Création du fichier&amp;nbsp;&lt;tt class="docutils literal"&gt;/etc/xinetd.d/mariadbcheck&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# default: on
# description: mariadbcheck
service mariadbcheck
{
        disable = no
        flags = REUSE
        socket_type = stream
        port = 9200
        wait = no
        user = nobody
        server = /usr/bin/clustercheck clustercheckuser clustercheckpassword!
        log_on_failure += USERID
        only_from = 0.0.0.0/0
        per_source = UNLIMITED }
&lt;/pre&gt;
&lt;p&gt;Dans le champ only_from, vous pouvez mettre l'adresse ip d'HAproxy si
vous le souhaitez (avec un /32 à la fin).&lt;/p&gt;
&lt;p&gt;Pour avoir un service propre et bien configuré, on l'ajoute aussi dans
&lt;tt class="docutils literal"&gt;/etc/services&lt;/tt&gt; en commentant les anciens services utilisant le port
9200 (service wap, a priori votre serveur ne devrait pas en avoir besoin
:) )&lt;/p&gt;
&lt;pre class="literal-block"&gt;
mariadbcheck&amp;nbsp; &amp;nbsp; &amp;nbsp;9200/tcp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;   &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#&amp;nbsp;mariadbcheck
#wap-wsp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 9200/tcp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # WAP connectionless session service
#wap-wsp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 9200/udp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; # WAP connectionless session service
&lt;/pre&gt;
&lt;p&gt;On redémarre xinetd et on devrait avoir le port 9200 en écoute.&lt;/p&gt;
&lt;p&gt;Pour vérifier que ça fonctionne, lancez la commande &lt;tt class="docutils literal"&gt;clustercheck&lt;/tt&gt;.
Elle doit renvoyer du text contenant &lt;tt class="docutils literal"&gt;HTTP/1.1 200 OK&lt;/tt&gt; qui sera le
retour attendu par HAproxy pour s'assurer que le noeud du cluster est
atteignable.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-d-haproxy"&gt;
&lt;h2&gt;Configuration d'HAproxy&lt;/h2&gt;
&lt;p&gt;La plus gros du boulot est fait. Reste à définir le cluster dans
HAproxy.&lt;/p&gt;
&lt;p&gt;Ceci se fait dans le fichier de conf en y ajoutant à la fin :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
listen galera-mariadb 0.0.0.0:3306
  balance leastconn
  option httpchk
  mode tcp
  server mariadb01 ip.de.mariadb.01:3306 check port 9200 inter 5000 fastinter 2000 rise 2 fall 2
  server mariadb02 ip.de.mariadb.02:3306 check port 9200 inter 5000 fastinter 2000 rise 2 fall 2
  server mariadb03 ip.de.mariadb.03:3306 check port 9200 inter 5000 fastinter 2000 rise 2 fall 2
&lt;/pre&gt;
&lt;p&gt;Après avoir redémarré HAproxy, le cluster doit être joignable et on doit
pouvoir prouver le load balancing :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;haproxy]# mysql -uroot -p -h127.0.0.1 -e &amp;quot;show variables like 'wsrep_node_name' ;&amp;quot;
+-----------------+---------------+
| Variable_name   | VALUE         |
+-----------------+---------------+
| wsrep_node_name |   mariadb01   |
+-----------------+---------------+
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;haproxy]# mysql -uroot -p -h127.0.0.1 -e &amp;quot;show variables like 'wsrep_node_name' ;&amp;quot;
+-----------------+---------------+
| Variable_name   | VALUE         |
+-----------------+---------------+
| wsrep_node_name |   mariadb02   |
+-----------------+---------------+
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;haproxy]# mysql -uroot -p -h127.0.0.1 -e &amp;quot;show variables like 'wsrep_node_name' ;&amp;quot;
+-----------------+---------------+
| Variable_name   | VALUE         |
+-----------------+---------------+
| wsrep_node_name |   mariadb03   |
+-----------------+---------------+
&lt;/pre&gt;
&lt;/div&gt;
</content><category term="Linux, Tech"></category><category term="cluster"></category><category term="failover"></category><category term="galera"></category><category term="ha"></category><category term="haproxy"></category><category term="mariadb"></category><category term="mysql"></category></entry><entry><title>Pas à pas - monter un cluster Galera Mariadb</title><link href="https://blog.devarieux.net/2016/06/monter-cluster-galera-mariadb.html" rel="alternate"></link><published>2016-06-20T22:40:00+02:00</published><updated>2016-06-20T22:40:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-06-20:/2016/06/monter-cluster-galera-mariadb.html</id><summary type="html">&lt;p&gt;Lorsque je me suis mis dans l'idée de monter un cluster Galera Mariadb
pour remplacer notre cluster Mysql, je pensais trouver facilement de la
documentation en ligne. On trouve en effet beaucoup d'articles de blogs
expliquant comment créer son cluster Galera malheureusement cette techno
évolue vite et les articles sont …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Lorsque je me suis mis dans l'idée de monter un cluster Galera Mariadb
pour remplacer notre cluster Mysql, je pensais trouver facilement de la
documentation en ligne. On trouve en effet beaucoup d'articles de blogs
expliquant comment créer son cluster Galera malheureusement cette techno
évolue vite et les articles sont rarement à jour.&lt;/p&gt;
&lt;p&gt;La documentation qu'on peut trouver sur le site de mariadb est également
assez succinct et c'est en compilant des articles depuis plusieurs
sources que j'ai pu monter ce cluster.&lt;/p&gt;
&lt;p&gt;Galera est une technologie de clusterisation de base de données bien
plus efficace que ce qu'on peut faire actuellement avec mysql. Un
cluster classique mysql fonctionne en mode actif/passif et si le nœud
actif tombe, il est nécessaire de faire une opération manuelle pour
passer un des nœud passif en actif. De plus, si un nœud reste éteint
durant une période prolongée, il ne peut plus rattraper son retard sur
le nœud primaire et sort du cluster. Galera règle ces problèmes avec un
cluster de nœuds actifs/actifs. Chaque nœud est capable de recevoir des
écritures et Galera s'occupe de synchroniser tout ça.&lt;/p&gt;
&lt;p&gt;Pour réaliser le cluster, j'ai utilisé 4 serveurs Centos 7 : 3 nœuds
mariadb (il faut un chiffre impair pour respecter le quorum) et un
serveur haproxy en frontal en mode répartition de charge (leastconn) qui
fait office de passerelle&amp;nbsp;d'accès. Les machines s'appellent
respectivement mariadb01, mariadb02, mariadb03 et mariadb-proxy.&lt;/p&gt;
&lt;p&gt;Cet article s'attache à la mise en oeuvre du cluster en lui même. Un
second article détaillera &lt;a class="reference external" href="http://blog.devarieux.net/2016/06/galera-load-balancing-failover-haproxy/"&gt;le déploiement
d'haproxy&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="configuration-du-noeud-mariadb01"&gt;
&lt;h2&gt;Configuration du nœud mariadb01&lt;/h2&gt;
&lt;p&gt;On commence par récupérer le repo mariadb pour CentOS
ici&amp;nbsp;&lt;a class="reference external" href="https://downloads.mariadb.org/mariadb/repositories/"&gt;https://downloads.mariadb.org/mariadb/repositories/&lt;/a&gt; ce qui devrait
vous donner quelque chose comme ça:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
# Put this file in /etc/yum.repos.d/
# MariaDB 10.1 CentOS repository list - created 2016-06-20 19:31 UTC
# http://downloads.mariadb.org/mariadb/repositories/
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.1/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
&lt;/pre&gt;
&lt;p&gt;On peut ensuite installer les paquets nécessaires&lt;/p&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;tt class="docutils literal"&gt;yum &lt;span class="pre"&gt;-y&lt;/span&gt; install &lt;span class="pre"&gt;MariaDB-server&lt;/span&gt; &lt;span class="pre"&gt;MariaDB-client&lt;/span&gt; galera rsync xinetd&lt;/tt&gt;&lt;/div&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;On édite ensuite le fichier de configuration de galera&lt;/div&gt;
&lt;div class="line"&gt;&lt;tt class="docutils literal"&gt;vim /etc/my.cnf.d/server.conf&lt;/tt&gt;&lt;/div&gt;
&lt;div class="line"&gt;Et dans la zone du fichier dédiée à galera:&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;pre class="literal-block"&gt;
[galera]
# Mandatory settings
wsrep_on=ON
wsrep_provider='/lib64/galera/libgalera_smm.so'
wsrep_cluster_address='gcomm://'
wsrep_cluster_name='galera'
wsrep_node_name='mariadb01'
wsrep_sst_method=rsync
binlog_format=row
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0
&lt;/pre&gt;
&lt;p&gt;On ne donne aucune adresse pour le moment au cluster. On laisse la
valeur par défaut gcomm://. On reviendra sur cette partie plus tard.&lt;/p&gt;
&lt;p&gt;Avant de démarrer le premier nœud du cluster, on lance la sécurisation
de l'instance mariadb avec la commande&amp;nbsp;mysql_secure_installation.&lt;/p&gt;
&lt;p&gt;Une fois cette étape effectuée, on peut démarrer le cluster. Cette
commande ne doit être lancée qu'une seule fois et seulement sur le
premier noeud configuré.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
galera_new_cluster
&lt;/pre&gt;
&lt;p&gt;On se connecte ensuite sur l'instance mysql pour vérifier que le cluster
est bien opérationnel:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;mariadb01 ~]# mysql -u root -p
Enter password:
Welcome to the MariaDB monitor. Commands end with ; or \g.
Your MariaDB connection id is 18705
Server version: 10.1.14-MariaDB MariaDB Server

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&amp;gt; SHOW GLOBAL STATUS WHERE Variable_name IN ('wsrep_ready', 'wsrep_cluster_size', 'wsrep_cluster_status', 'wsrep_connected');
+----------------------+---------+
| Variable_name        | Value   |
+----------------------+---------+
| wsrep_cluster_size   |    1    |
| wsrep_cluster_status | Primary |
| wsrep_connected      |    ON   |
| wsrep_ready          |    ON   |
+----------------------+---------+
4 rows in set (0.01 sec)
&lt;/pre&gt;
&lt;p&gt;Et voilà notre cluster Galera composée de 1 nœud pour le moment :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-de-mariadb02-et-mariadb03"&gt;
&lt;h2&gt;Configuration de mariadb02 et mariadb03&lt;/h2&gt;
&lt;p&gt;On reprend les mêmes étapes que pour mariadb01 en adaptant le fichier de
configuration. On n'oublie pas de lancer mysql_secure_installation.&lt;/p&gt;
&lt;p&gt;Le fichier de conf de mariadb02 :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[galera]
# Mandatory settings
wsrep_on=ON
wsrep_provider='/lib64/galera/libgalera_smm.so'
wsrep_cluster_address='gcomm://mariadb01,mariadb02'
wsrep_cluster_name='galera'
wsrep_node_name='mariadb02'
wsrep_sst_method=rsync
binlog_format=row
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0
&lt;/pre&gt;
&lt;p&gt;On peut lancer le service mariadb de façon classique et vérifier que le
cluster est opérationnel :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;mariadb02 ~]# systemctl start mariadb
[root&amp;#64;mariadb02 ~]# mysql -u root -p
Enter password:
Welcome to the MariaDB monitor. Commands end with ; or \g.
Your MariaDB connection id is 18905
Server version: 10.1.14-MariaDB MariaDB Server

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&amp;gt; SHOW GLOBAL STATUS WHERE Variable_name IN ('wsrep_ready', 'wsrep_cluster_size', 'wsrep_cluster_status', 'wsrep_connected');
+----------------------+---------+
| Variable_name        | Value   |
+----------------------+---------+
| wsrep_cluster_size   |    2    |
| wsrep_cluster_status | Primary |
| wsrep_connected      |    ON   |
| wsrep_ready          |    ON   |
+----------------------+---------+
4 rows in set (0.01 sec)
&lt;/pre&gt;
&lt;p&gt;On a bien 2 nœuds dans notre cluster, passons à mariadb03&lt;/p&gt;
&lt;p&gt;Le fichier de conf de mariadb03 :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[galera]
# Mandatory settings
wsrep_on=ON
wsrep_provider='/lib64/galera/libgalera_smm.so'
wsrep_cluster_address='gcomm://mariadb01,mariadb02,mariadb03'
wsrep_cluster_name='galera'
wsrep_node_name='mariadb03'
wsrep_sst_method=rsync
binlog_format=row
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0
&lt;/pre&gt;
&lt;p&gt;Idem, on lance le service et on vérifie que tout est ok:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;mariadb02 ~]# systemctl start mariadb
[root&amp;#64;mariadb02 ~]# mysql -u root -p
Enter password:
Welcome to the MariaDB monitor. Commands end with ; or \g.
Your MariaDB connection id is 18905
Server version: 10.1.14-MariaDB MariaDB Server

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&amp;gt; SHOW GLOBAL STATUS WHERE Variable_name IN ('wsrep_ready', 'wsrep_cluster_size', 'wsrep_cluster_status', 'wsrep_connected');
+----------------------+---------+
| Variable_name        | Value   |
+----------------------+---------+
| wsrep_cluster_size   |    3    |
| wsrep_cluster_status | Primary |
| wsrep_connected      |    ON   |
| wsrep_ready          |    ON   |
+----------------------+---------+
4 rows in set (0.01 sec)
&lt;/pre&gt;
&lt;p&gt;Trois nœuds dans le cluster, c'est bon!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-finale"&gt;
&lt;h2&gt;Configuration finale&lt;/h2&gt;
&lt;p&gt;On corrige maintenant les adresses de cluster sur les serveurs mariadb01
et mariadb02 en y mettant la même valeur que dans le fichier de conf de
mariadb03&lt;/p&gt;
&lt;pre class="literal-block"&gt;
wsrep_cluster_address='gcomm://mariadb01,mariadb02,mariadb03'
&lt;/pre&gt;
&lt;p&gt;Puis on redémarrer les services&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;mariadb02 ~]# systemctl restart mariadb
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;mariadb01 ~]# systemctl restart mariadb
&lt;/pre&gt;
&lt;p&gt;C'est terminé.&lt;/p&gt;
&lt;p&gt;A ce stade, vous devez pouvoir vous connecter sur n'importe quel noeud,
créer une base, elle sera dupliquée dans la foulée sur les autres nœuds.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="bdd"></category><category term="cluster"></category><category term="galera"></category><category term="Linux"></category><category term="mariadb"></category></entry><entry><title>Pydio - migration, upgrade, package [EN]</title><link href="https://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-en.html" rel="alternate"></link><published>2016-05-27T23:02:00+02:00</published><updated>2016-05-27T23:02:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-05-27:/2016/05/pydio-migration-upgrade-package-en.html</id><summary type="html">&lt;p&gt;Cet article est également disponible &lt;a class="reference external" href="http://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-fr/"&gt;en
français&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This unclear title reveals an operation i've just done to make 3 moves
in one. Pydio 6.0.7 was running on a CentOS 6 server, installed via the
tar.gz archive.&lt;/p&gt;
&lt;p&gt;The primary goal was to upgrade Pydio to 6.4. Unfortunately …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Cet article est également disponible &lt;a class="reference external" href="http://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-fr/"&gt;en
français&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This unclear title reveals an operation i've just done to make 3 moves
in one. Pydio 6.0.7 was running on a CentOS 6 server, installed via the
tar.gz archive.&lt;/p&gt;
&lt;p&gt;The primary goal was to upgrade Pydio to 6.4. Unfortunately, there was
dependcies problems with php. Pydio 6.4 needs php 5.4 and CentOS only
brings 5.3 (you can install php 5.4 via other repos but I didn't want
this). The first was to create a new Centos7 VM, then install Pydio on
it using yum and the Pydio repo and finally import the old config in the
brand new Pydio.&lt;/p&gt;
&lt;p&gt;Installing Pydio through the package manager allows you to update it
easily and it also ease the automation for an autmatic deployement.
Also, the plugin management is facilitated.&lt;/p&gt;
&lt;p&gt;These are the steps I'll describe here.&lt;/p&gt;
&lt;p&gt;Install mariadb and httpd&lt;/p&gt;
&lt;pre class="code sh literal-block"&gt;
yum install -y mariadb mariadb-server
systemctl start mariadb.service
systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; mariadb.service
mysql_secure_installation
yum install httpd
systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; httpd.service
systemctl start httpd.service
&lt;/pre&gt;
&lt;p&gt;Installing Pydio dependancies :&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
yum -y install php php-gd php-ldap php-pear php-xml php-xmlrpc php-mbstring curl php-mcrypt* php-mysql
&lt;/pre&gt;
&lt;p&gt;Installing Pydio repositories&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
wget https://download.pydio.com/pub/linux/centos/7/pydio-release-1-1.el7.centos.noarch.rpm
&lt;/pre&gt;
&lt;p&gt;If you own a licence (free up to 10 users), you can also have the
enterprise repo.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
wget https://API_KEY:API_SECRET&amp;#64;download.pydio.com/auth/linux/centos/7/x86_64/pydio-enterprise-release-1-1.el7.centos.noarch.rpm
&lt;/pre&gt;
&lt;p&gt;With API_KEY and API_SECRET &amp;nbsp;in your dashboard on pydio.com, licence
tab&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
rpm -ivh pydio-release-1-1.el7.centos.noarch.rpm
rpm -ivh pydio-enterprise-release-1-1.el7.centos.noarch.rpm
&lt;/pre&gt;
&lt;p&gt;Edit the repo file to add your API_KEY and API_SECRET&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
vim /etc/yum.repos.d/pydio-enterprise.repo
&lt;/pre&gt;
&lt;p&gt;InstallPydio&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
yum update
yum install pydio-enterprise
&lt;/pre&gt;
&lt;p&gt;I use to modify the default vhost file /etc/httpd/conf.d/pydio.conf&lt;/p&gt;
&lt;pre class="code apache literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span class="s"&gt;nom.du.vhost:80&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nb"&gt;Alias&lt;/span&gt; / &lt;span class="sx"&gt;/usr/share/pydio/&lt;/span&gt;
&lt;span class="nb"&gt;Alias&lt;/span&gt; &lt;span class="sx"&gt;/pydio_public&lt;/span&gt; &lt;span class="sx"&gt;/var/lib/pydio/public/&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;Directory&lt;/span&gt; &lt;span class="s"&gt;/usr/share/pydio/&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nb"&gt;Options&lt;/span&gt; FollowSymLinks
&lt;span class="nb"&gt;AllowOverride&lt;/span&gt; Limit FileInfo
&lt;span class="nb"&gt;Require&lt;/span&gt; &lt;span class="k"&gt;all&lt;/span&gt; granted
&lt;span class="nb"&gt;php_value&lt;/span&gt; error_reporting &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="nb"&gt;php_value&lt;/span&gt; upload_max_filesize &lt;span class="m"&gt;100&lt;/span&gt;M
&lt;span class="nb"&gt;php_value&lt;/span&gt; post_max_size &lt;span class="m"&gt;100&lt;/span&gt;M
&lt;span class="nb"&gt;php_value&lt;/span&gt; output_buffering &lt;span class="k"&gt;Off&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;Directory&lt;/span&gt; &lt;span class="s"&gt;/var/lib/pydio/public/&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nb"&gt;AllowOverride&lt;/span&gt; Limit FileInfo
&lt;span class="nb"&gt;Require&lt;/span&gt; &lt;span class="k"&gt;all&lt;/span&gt; granted
&lt;span class="nb"&gt;php_value&lt;/span&gt; error_reporting &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Customize the charset in /etc/pydio/bootstrap_conf.php&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
define(&amp;quot;AJXP_LOCALE&amp;quot;, &amp;quot;fr_FR.UTF-8&amp;quot;);
&lt;/pre&gt;
&lt;p&gt;Create the database:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
mysql -u root -p
create database pydio;
create user pydio&amp;#64;localhost identified by 'mypassword';
grant all privileges on pydio.* to pydio&amp;#64;localhost identified by 'mypassword';
use mysql
update mysql.users set Super_Priv='Y' where user like pydio;
&lt;/pre&gt;
&lt;p&gt;The last command gives the Super Privileges to the pydio user for it to
be able to create triggers.&lt;/p&gt;
&lt;p&gt;Install the Pydio plugins;&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
yum install pydio-plugin*
&lt;/pre&gt;
&lt;p&gt;The last step is to import your old pydio database in your brand new one&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
mysql -u pydio -p pydio &amp;lt; mondumppydio.sql
&lt;/pre&gt;
&lt;p&gt;Finally, you can go to the pydio page and go through the First Run
Wizard. Once done, you should be able to connect with your account and
find all your files.&lt;/p&gt;
</content><category term="Tech"></category><category term="centos"></category><category term="Linux"></category><category term="pydio"></category></entry><entry><title>Pydio : migration, upgrade, package [FR]</title><link href="https://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-fr.html" rel="alternate"></link><published>2016-05-27T23:02:00+02:00</published><updated>2016-05-27T23:02:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-05-27:/2016/05/pydio-migration-upgrade-package-fr.html</id><summary type="html">&lt;p&gt;The article is also available &lt;a class="reference external" href="http://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-en/"&gt;in
english&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Sous ce titre peu clair se cache une opération de que je viens de mener
afin d'opérer 3 opérations sur une instance pydio. Pour mettre les
choses dans leur contexte, Pydio était installé via l'archive tar.gz,
sur un serveur CentOS 6 et …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The article is also available &lt;a class="reference external" href="http://blog.devarieux.net/2016/05/pydio-migration-upgrade-package-en/"&gt;in
english&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Sous ce titre peu clair se cache une opération de que je viens de mener
afin d'opérer 3 opérations sur une instance pydio. Pour mettre les
choses dans leur contexte, Pydio était installé via l'archive tar.gz,
sur un serveur CentOS 6 et la version utilisée était la 6.0.7.&lt;/p&gt;
&lt;p&gt;L'objectif initial est de mettre à jour Pydio en version 6.4.
Malheureusement, la version de php nécessaire n'est pas présente dans
Centos 6 (sauf via des dépôts externe que je ne souhaitais pas
utiliser). La première étape est donc de monter une nouvelle VM Centos7
puis d'installer Pydio avec yum via le dépôt Pydio et d'importer
l'ancienne configuration dans cette nouvelle instance.&lt;/p&gt;
&lt;p&gt;Installer Pydio via le gestionnaire de paquet permet de plus facilement
le mettre à jour et facilite également l'automation &amp;nbsp;pour un déploiement
automatique de Pydio ainsi que la gestion des plugins.&lt;/p&gt;
&lt;p&gt;Ce sont ces étapes que je vais détailler ici.&lt;/p&gt;
&lt;p&gt;Installation de mariadb et httpd&lt;/p&gt;
&lt;pre class="code sh literal-block"&gt;
yum install -y mariadb mariadb-server
systemctl start mariadb.service
systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; mariadb.service
mysql_secure_installation
yum install httpd
systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; httpd.service
systemctl start httpd.service
&lt;/pre&gt;
&lt;p&gt;Installation des dépendances pour Pydio :&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
yum -y install php php-gd php-ldap php-pear php-xml php-xmlrpc php-mbstring curl php-mcrypt* php-mysql
&lt;/pre&gt;
&lt;p&gt;Installation des dépots Pydio&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
wget https://download.pydio.com/pub/linux/centos/7/pydio-release-1-1.el7.centos.noarch.rpm
&lt;/pre&gt;
&lt;p&gt;Si vous avez une licence pydio (gratuit jusqu'à 10 utilisateurs), vous
devez aussi récupérer le dépot enterprise&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
wget https://API_KEY:API_SECRET&amp;#64;download.pydio.com/auth/linux/centos/7/x86_64/pydio-enterprise-release-1-1.el7.centos.noarch.rpm
&lt;/pre&gt;
&lt;p&gt;Avec API_KEY et API_SECRET &amp;nbsp;dans votre dashboard sur pydio.com, onglet
licence&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
rpm -ivh pydio-release-1-1.el7.centos.noarch.rpm
rpm -ivh pydio-enterprise-release-1-1.el7.centos.noarch.rpm
&lt;/pre&gt;
&lt;p&gt;Edition du dépot pour ajouter API_KEY et API_SECRET&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
vim /etc/yum.repos.d/pydio-enterprise.repo
&lt;/pre&gt;
&lt;p&gt;Installation de pydio&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
yum update
yum install pydio-enterprise
&lt;/pre&gt;
&lt;p&gt;Modification du vhost par defaut :&lt;/p&gt;
&lt;pre class="code apache literal-block"&gt;
&lt;span class="nt"&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span class="s"&gt;nom.du.vhost:80&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nb"&gt;Alias&lt;/span&gt; / &lt;span class="sx"&gt;/usr/share/pydio/&lt;/span&gt;
&lt;span class="nb"&gt;Alias&lt;/span&gt; &lt;span class="sx"&gt;/pydio_public&lt;/span&gt; &lt;span class="sx"&gt;/var/lib/pydio/public/&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;Directory&lt;/span&gt; &lt;span class="s"&gt;/usr/share/pydio/&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nb"&gt;Options&lt;/span&gt; FollowSymLinks
&lt;span class="nb"&gt;AllowOverride&lt;/span&gt; Limit FileInfo
&lt;span class="nb"&gt;Require&lt;/span&gt; &lt;span class="k"&gt;all&lt;/span&gt; granted
&lt;span class="nb"&gt;php_value&lt;/span&gt; error_reporting &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="nb"&gt;php_value&lt;/span&gt; upload_max_filesize &lt;span class="m"&gt;100&lt;/span&gt;M
&lt;span class="nb"&gt;php_value&lt;/span&gt; post_max_size &lt;span class="m"&gt;100&lt;/span&gt;M
&lt;span class="nb"&gt;php_value&lt;/span&gt; output_buffering &lt;span class="k"&gt;Off&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;Directory&lt;/span&gt; &lt;span class="s"&gt;/var/lib/pydio/public/&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nb"&gt;AllowOverride&lt;/span&gt; Limit FileInfo
&lt;span class="nb"&gt;Require&lt;/span&gt; &lt;span class="k"&gt;all&lt;/span&gt; granted
&lt;span class="nb"&gt;php_value&lt;/span&gt; error_reporting &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Modification du charset dans /etc/pydio/bootstrap_conf.php&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
define(&amp;quot;AJXP_LOCALE&amp;quot;, &amp;quot;fr_FR.UTF-8&amp;quot;);
&lt;/pre&gt;
&lt;p&gt;Création de la base de données:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
mysql -u root -p
create database pydio;
create user pydio&amp;#64;localhost identified by 'mypassword';
grant all privileges on pydio.* to pydio&amp;#64;localhost identified by 'mypassword';
update mysql.users set Super_Priv='Y' where user like pydio;
&lt;/pre&gt;
&lt;p&gt;La dernière commande sert à donner les super privilège à l'utilisateur
pydio afin qu'il puisse créer des triggers.&lt;/p&gt;
&lt;p&gt;Vient ensuite l'installation des plugins pydio:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
yum install pydio-plugin*
&lt;/pre&gt;
&lt;p&gt;On termine par l'import de la base de données&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
mysql -u pydio -p pydio &amp;lt; mondumppydio.sql
&lt;/pre&gt;
&lt;p&gt;Enfin, on lance l'interface de pydio et on passe via le wizard pour la
première configuration.&amp;nbsp;Une fois terminé, on doit pouvoir se connecter
avec son compte habituel et retrouver tous ses fichiers.&lt;/p&gt;
</content><category term="Tech"></category><category term="centos"></category><category term="Linux"></category><category term="pydio"></category></entry><entry><title>Nutanix Template for Zabbix</title><link href="https://blog.devarieux.net/2016/03/nutanix-template-for-zabbix.html" rel="alternate"></link><published>2016-03-31T17:35:00+02:00</published><updated>2016-03-31T17:35:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2016-03-31:/2016/03/nutanix-template-for-zabbix.html</id><summary type="html">&lt;p&gt;Cet article est également disponible &lt;a class="reference external" href="http://blog.devarieux.net/2016/03/template_nutanix_pour_zabbix/"&gt;en
français&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;For the needs of our infrastructure, I built a Nutanix Template for the
monitoring plateforme Zabbix. This template automatically discover
containers, CVMs, hard drives, hypervisors and virtual machines.&lt;/p&gt;
&lt;p&gt;Once the items are discovered, some metrics, graphs and triggers are
deployed&lt;/p&gt;
&lt;p&gt;To be able …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Cet article est également disponible &lt;a class="reference external" href="http://blog.devarieux.net/2016/03/template_nutanix_pour_zabbix/"&gt;en
français&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;For the needs of our infrastructure, I built a Nutanix Template for the
monitoring plateforme Zabbix. This template automatically discover
containers, CVMs, hard drives, hypervisors and virtual machines.&lt;/p&gt;
&lt;p&gt;Once the items are discovered, some metrics, graphs and triggers are
deployed&lt;/p&gt;
&lt;p&gt;To be able to use this template, the prism's SNMP server needs to be
configured, the Nutanix MIB needs to be integrated in the zabbix server
and some macros needs to be set at the host level in Zabbix. We will go
through these few steps in the next part of this post.&lt;/p&gt;
&lt;p&gt;The template is configured to use SNMPv3 in authPriv mode, using SHA
auth and AES privacy.&lt;/p&gt;
&lt;div class="section" id="prism-central"&gt;
&lt;h2&gt;Prism Central&lt;/h2&gt;
&lt;p&gt;The prism configuration is quite simple, using the SNMP configuration
interface&lt;/p&gt;
&lt;p&gt;&lt;img alt="2016-03-18 09_52_19-Nutanix Web Console" src="images/2016-03-18-09_52_19-Nutanix-Web-Console.png" /&gt;&lt;/p&gt;
&lt;p&gt;Make sure at least one Transport is configured in UDP, on the port of
your choice (161 by default)&lt;/p&gt;
&lt;p&gt;&lt;img alt="2016-03-18 09_52_56-Nutanix Web Console" src="images/2016/03/2016-03-18-09_52_56-Nutanix-Web-Console.png" /&gt;&lt;/p&gt;
&lt;p&gt;Then, go in the 'Users' tab and add a new user for Zabbix.&lt;/p&gt;
&lt;p&gt;&lt;img alt="2016-03-18 09_53_41-Nutanix Web Console" src="images/2016-03-18-09_53_41-Nutanix-Web-Console.png" /&gt;&lt;/p&gt;
&lt;p&gt;While you are here, you can download the MIB, we will need it later.&lt;/p&gt;
&lt;p&gt;Clic Save. The prim configuration is done.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="nutanix-mib"&gt;
&lt;h2&gt;Nutanix MIB&lt;/h2&gt;
&lt;p&gt;One you have downloaded the Nutanix MIB, we need to upload it on the
Zabbix server. On CentOS, it is located in /usr/share/snmp/mibs&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# ls /usr/share/snmp/mibs/NUTANIX*
/usr/share/snmp/mibs/NUTANIX-MIB
&lt;/pre&gt;
&lt;p&gt;Restart Zabbix so it can use this new MIB&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# systemctl restart zabbix-server
&lt;/pre&gt;
&lt;p&gt;You can test the MIB and the prism configuration using the snmpwalk
command line tool. In the example, we are listing all the Nutanix
containers.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
snmpwalk -v 3 -a SHA -A YOURSHAPASSWORD -u zabbix -x AES -X YOURAESPASSWORD IP.OF.PRISM.CENTRAL -l AuthPriv citContainerName
NUTANIX-MIB::citContainerName.1 = STRING: container00.
NUTANIX-MIB::citContainerName.2 = STRING: containerA.
NUTANIX-MIB::citContainerName.3 = STRING: containerB.
NUTANIX-MIB::citContainerName.4 = STRING: containerC.
NUTANIX-MIB::citContainerName.5 = STRING: RESERVED_SPACE.
NUTANIX-MIB::citContainerName.6 = STRING: containerD.
&lt;/pre&gt;
&lt;p&gt;The server configuration is done, we can now configure Zabbix itself.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="zabbix"&gt;
&lt;h2&gt;Zabbix&lt;/h2&gt;
&lt;p&gt;If it's not already done, create a new host for prism central in Zabbix.
The host needs 3 macros for the Nutanix Template to work on it.&lt;/p&gt;
&lt;p&gt;Those 3 macros are&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;{$NTX_SNMP_USER} : the SNMP user&lt;/li&gt;
&lt;li&gt;{$NTX_SNMP_AUTH} : the SHA password&lt;/li&gt;
&lt;li&gt;{$NTX_SNMP_PRIV} : the AES password&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then, import this
&lt;a class="reference external" href="http://blog.devarieux.net/wp-content/uploads/2016/03/Template_SNMP_Nutanix_Cluster.xml"&gt;Template&lt;/a&gt;
in Zabbix and apply it on your prism central host.&lt;/p&gt;
&lt;p&gt;By default, the VM discovery is disabled because I couldn't find a good
way to create hosts from the LLD process.&lt;/p&gt;
&lt;p&gt;If you have a big Nutanix cluster and Zabbix shows a timeout error while
parsing the SNMP OIDs, you can increase this timeout in the Zabbix
configuration file&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Timeout=10
&lt;/pre&gt;
&lt;p&gt;Known bugs :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Until NOS 4.6, LLD can't discover all hypervisors. This behavior is
the same when using snmpwalk. I guess this is a Nutanix problem.
Everything works fine in NOS 4.6&lt;/li&gt;
&lt;li&gt;The number of found VMs is limited to 250. I guess this is a
limitation on the Nutanix side.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Supervision"></category><category term="nutanix"></category><category term="supervision"></category><category term="template"></category><category term="zabbix"></category></entry><entry><title>Template Nutanix pour Zabbix</title><link href="https://blog.devarieux.net/2016/03/template_nutanix_pour_zabbix.html" rel="alternate"></link><published>2016-03-31T17:32:00+02:00</published><updated>2016-03-31T17:32:00+02:00</updated><author><name>aldevar</name></author><id>tag:blog.devarieux.net,2016-03-31:/2016/03/template_nutanix_pour_zabbix.html</id><summary type="html">&lt;p&gt;This post is also available in english&lt;/p&gt;
&lt;p&gt;Afin de superviser correctement notre cluster Nutanix sans passer trop
de temps à configurer les objets à surveiller, j'ai construit un
template Nutanix pour l'outil de monitoring Zabbix. Ce template s'occupe
de découvrir automatiquement les containers, les CVM, les disques durs,
les hyperviseurs …&lt;/p&gt;</summary><content type="html">&lt;p&gt;This post is also available in english&lt;/p&gt;
&lt;p&gt;Afin de superviser correctement notre cluster Nutanix sans passer trop
de temps à configurer les objets à surveiller, j'ai construit un
template Nutanix pour l'outil de monitoring Zabbix. Ce template s'occupe
de découvrir automatiquement les containers, les CVM, les disques durs,
les hyperviseurs ainsi que les machines virtuelles.&lt;/p&gt;
&lt;p&gt;Une fois les objets découverts, un certains nombre de relevés de
métriques, de graphs et de triggers sont mis en place.&lt;/p&gt;
&lt;p&gt;Pour utiliser ce template correctement, il est nécessaire de paramétrer
le serveur snmp de prism central, de récupérer la MIB de Nutanix pour
l'intégrer dans le serveur Zabbix et de configurer quelques macro au
niveau de l'hôte prism dans Zabbix. Nous allons tout de suite détailler
ces quelques étapes.&lt;/p&gt;
&lt;p&gt;Le template est paramétré pour utiliser SNMPv3 en mode authPriv avec
Auth SHA et Privacy AES.&lt;/p&gt;
&lt;div class="section" id="prism-central"&gt;
&lt;h2&gt;Prism Central&lt;/h2&gt;
&lt;p&gt;La configuration de prism se fait de façon assez simple via l'interface
de paramétrage SNMP.&lt;/p&gt;
&lt;p&gt;&lt;img alt="2016-03-18 09_52_19-Nutanix Web Console" src="images/2016-03-18-09_52_19-Nutanix-Web-Console.png" /&gt;&lt;/p&gt;
&lt;p&gt;Assurez-vous que le transport soit bien configuré en UDP, sur le port de
votre choix (161 par défaut)&lt;/p&gt;
&lt;p&gt;&lt;img alt="2016-03-18 09_52_56-Nutanix Web Console" src="images/2016-03-18-09_52_56-Nutanix-Web-Console.png" /&gt;&lt;/p&gt;
&lt;p&gt;Se rendre ensuite dans l'onglet Users et ajouter un nouvel utilisateur
pour que zabbix puisse se connecter&lt;/p&gt;
&lt;p&gt;&lt;img alt="2016-03-18 09_53_41-Nutanix Web Console" src="images/2016-03-18-09_53_41-Nutanix-Web-Console.png" /&gt;&lt;/p&gt;
&lt;p&gt;Profitez-en pour télécharger la MIB via le bouton Download MIB, nous
allons en avoir besoin.&lt;/p&gt;
&lt;p&gt;Cliquez sur Save. La configuration de prism est terminée&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="mib-nutanix"&gt;
&lt;h2&gt;MIB Nutanix&lt;/h2&gt;
&lt;p&gt;Une fois la MIB Nutanix récupérée, il faut la placer sur le serveur
Zabbix. Sur un serveur CentOS, il faut placer le fichier dans
/usr/share/snmp/mibs&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# ls /usr/share/snmp/mibs/NUTANIX*
/usr/share/snmp/mibs/NUTANIX-MIB
&lt;/pre&gt;
&lt;p&gt;Afin que Zabbix prenne ce nouveau fichier en considération, il est
nécessaire de redémarrer le service&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# systemctl restart zabbix-server
&lt;/pre&gt;
&lt;p&gt;Pour tester le bon fonctionnement de la MIB et de la configuration de
prism, utilisons la commande snmpwalk qui va, dans cet exemple, lister
les noms des containers Nutanix.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
snmpwalk -v 3 -a SHA -A VOTREMOTDEPASSESHA -u zabbix -x AES -X VOTREMOTDEPASSEAES IP.DE.PRISM.CENTRAL -l AuthPriv citContainerName
NUTANIX-MIB::citContainerName.1 = STRING: container00.
NUTANIX-MIB::citContainerName.2 = STRING: containerA.
NUTANIX-MIB::citContainerName.3 = STRING: containerB.
NUTANIX-MIB::citContainerName.4 = STRING: containerC.
NUTANIX-MIB::citContainerName.5 = STRING: RESERVED_SPACE.
NUTANIX-MIB::citContainerName.6 = STRING: containerD.
&lt;/pre&gt;
&lt;p&gt;La configuration du serveur est terminée. On peut passer à la
configuration de Zabbix.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="zabbix"&gt;
&lt;h2&gt;Zabbix&lt;/h2&gt;
&lt;p&gt;Si ce n'est pas déjà fait, créez un nouvel hôte pour prism central dans
Zabbix. Cet hôte à besoin de 3 macros pour que le template Nutanix
fonctionne. Ces 3 macros sont l'utilisateurs SNMP, le mot de passe SHA
et le mot de passe AES.&lt;/p&gt;
&lt;p&gt;Ces macros sont :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;{$NTX_SNMP_USER}&lt;/li&gt;
&lt;li&gt;{$NTX_SNMP_AUTH}&lt;/li&gt;
&lt;li&gt;{$NTX_SNMP_PRIV}&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="2016-03-18 11_06_42-Zabbix Appliance_ Configuration of hosts" src="images/2016-03-18-11_06_42-Zabbix-Appliance-Configuration-of-hosts.png" /&gt;&lt;/p&gt;
&lt;p&gt;Importez ensuite ce
&lt;a class="reference external" href="http://blog.devarieux.net/wp-content/uploads/2016/03/Template_SNMP_Nutanix_Cluster.xml"&gt;Template&lt;/a&gt;
dans Zabbix et appliquez le sur votre hôte Prism Central.&lt;/p&gt;
&lt;p&gt;Par défaut, la découverte des VM est désactivée car il n'est pas
possible de créer proprement des hôtes depuis ce processus LLD.&lt;/p&gt;
&lt;p&gt;Si vous avez un cluster Nutanix volumineux et que Zabbix ne peux
remonter les informations à cause d'une erreur de timeout, pensez à
augmenter ce timeout dans la configuration de Zabbix&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Timeout=10
&lt;/pre&gt;
&lt;p&gt;Les bugs rencontrés actuellement sont les suivants :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Jusqu'à la version 4.6 de NOS, le Discovery n'arrive pas à remonter
tous les hyperviseurs. Le comportement est le même avec snmpwalk. Il
semble que ce soit un problème du coté de Nutanix. Le problème est
corrigé en 4.6.&lt;/li&gt;
&lt;li&gt;Le nombre de VM remontées est limité à 250. Sans doute une limitation
coté Nutanix également.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Supervision"></category><category term="nutanix"></category><category term="supervision"></category><category term="template"></category><category term="zabbix"></category></entry><entry><title>Migration OpenLDAP 2.2 vers OpenLDAP 2.4</title><link href="https://blog.devarieux.net/2015/10/migration-openldap-2-2-vers-openldap-2-4.html" rel="alternate"></link><published>2015-10-30T23:24:00+01:00</published><updated>2015-10-30T23:24:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-10-30:/2015/10/migration-openldap-2-2-vers-openldap-2-4.html</id><summary type="html">&lt;p&gt;Parfois, certains serveurs sont là depuis tellement longtemps qu'on n'y
prête même plus attention. Et pourtant, il arrive qu'ils fassent tourner
des applications assez sensible, parfois même critique.&lt;/p&gt;
&lt;p&gt;C'est le cas de ce serveur OpenLDAP qui tourne sur une RedHat 5, sans
licence (donc sans yum) et dont la version …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Parfois, certains serveurs sont là depuis tellement longtemps qu'on n'y
prête même plus attention. Et pourtant, il arrive qu'ils fassent tourner
des applications assez sensible, parfois même critique.&lt;/p&gt;
&lt;p&gt;C'est le cas de ce serveur OpenLDAP qui tourne sur une RedHat 5, sans
licence (donc sans yum) et dont la version 2.2 d'OpenLDAP installée a
été compilée dans /usr/local. Typiquement le genre de serveur dont
personne ne veut s'occuper parce qu'il est difficile à maintenir et il
est également difficile de s'en débarrasser car il faut pouvoir sortir
les applications qui y tournent.&lt;/p&gt;
&lt;p&gt;Avec un collègue nous nous sommes donc attelé à cette tâche, non sans
peine. Il n'était à priori pas difficile de sortir un annuaire OpenLDAP
2.2 vers un nouvel annuaire OpenLDAP 2.2 mais l’intérêt de cette
manipulation était assez limité. Nous avons donc décidé de migrer vers
la version 2.4 d'OpenLDAP proposée dans les dépôts de CentOS 7. Nous
souhaitions également profiter de cette migration pour passer d'une
configuration fichier (slapd.conf) à une configuration en base (olc, en
gros OpenLDAP stock sa configuration dans une base LDAP). Voici la
méthode employée pour réussir cette opération :&lt;/p&gt;
&lt;p&gt;La première étape est de récupérer les informations dont nous avons
besoin sur l'ancien serveur. Nous avons besoin de son fichier de
configuration (slapd.conf, que nous allons renommer vieuxslapd.conf) et
du contenu de la base. Pour cela nous allons utiliser l'outil
&lt;tt class="docutils literal"&gt;slapcat&lt;/tt&gt; qui va générer un fichier &lt;tt class="docutils literal"&gt;ldif&lt;/tt&gt;. Ces 2 fichiers seront à
transférer sur le nouveau serveur. Si vous utilisez des schémas
spécifique, il faudra également les récupérer.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
[aldevar&amp;#64;vieuxserveur]# slapcat -f /chemin/vers/vieuwslapd.conf -l /tmp/vieuxslap.ldif
&lt;/pre&gt;
&lt;p&gt;Sur notre nouvelle machine CentOS 7, à jour, on installe
openldap-servers et openldap-clients&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# yum -y install openldap-servers openldap-clients
&lt;/pre&gt;
&lt;p&gt;Configuration des logs d'OpenLDAP&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# echo &amp;quot;local4.*&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; /var/log/slapd.log&amp;quot; &amp;gt; /etc/rsyslog.d/slapd.conf
[aldevar&amp;#64;serveur]# systemctl restart rsyslog.service
&lt;/pre&gt;
&lt;p&gt;Dans notre cas, il était nécessaire de nettoyer l'ancien fichier de
configuration.
|  Pour vérifier si que le fichier de conf est valide, on utilise
&lt;tt class="docutils literal"&gt;slaptest&lt;/tt&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# slaptest -f vieuxslapd.conf
&lt;/pre&gt;
&lt;p&gt;Celui ci nous retourne des erreurs que nous corrigeons.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# sed -i -e &amp;quot;s/attr=/attrs=/g&amp;quot; vieuxslapd.conf
[aldevar&amp;#64;serveur]# sed -i -e &amp;quot;/pidfile/d&amp;quot; /root/vieuxslapd.conf
[aldevar&amp;#64;serveur]# sed -i -e &amp;quot;/argsfile/d&amp;quot; /root/vieuxslapd.conf
[aldevar&amp;#64;serveur]# sed -i -e &amp;quot;s;directory /var/ldap/annuaireldap;directory /var/lib/ldap;&amp;quot; /root/vieuxslapd.conf
&lt;/pre&gt;
&lt;p&gt;Nous utilisons le schéma de samba, pour le récupérer nous installons
samba&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# yum -y install samba
&lt;/pre&gt;
&lt;p&gt;On copie les fichiers schéma récupérés sur l'ancien serveur dans le bon
répertoire :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# cp *.schema /etc/openldap/schema/
[aldevar&amp;#64;serveur]# chown ldap. /etc/openldap/schema/*
&lt;/pre&gt;
&lt;p&gt;Maintenant, nous allons corriger une incompatibilité sur laquelle nous
avons bloqué un bon moment. OpenLDAP ajoute pour chaque entrée un
attribut &lt;tt class="docutils literal"&gt;entryUUID&lt;/tt&gt; qu'il provisionne automatiquement. Entre la
version 2.2 et notre version 2.4, la format de la valeur
d'&lt;tt class="docutils literal"&gt;entryUUID&lt;/tt&gt; a changé. Il est passé d'une suite de caractères
aléatoire à 4 série de caractères hexadécimaux séparés par des &lt;tt class="docutils literal"&gt;-&lt;/tt&gt;.
Tant que nous n'avions pas trouver de solution à cette incompatibilité,
aucune entrée de ne pouvait être ajoutée dans notre nouvelle base. C'est
d’ailleurs la raison pour laquelle nous ne pouvions pas mettre en place
de synchronisation entre les 2 instances.&lt;/p&gt;
&lt;p&gt;La solution, radicale et rapide est de supprimer les entrées
&lt;tt class="docutils literal"&gt;entryUUID&lt;/tt&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# sed -i -e &amp;quot;/entryUUID/d&amp;quot; vieuxslap.ldif
&lt;/pre&gt;
&lt;p&gt;Une fois ces étapes effectuée, nous devrions être prêt pour tester
l'import des données. Pour cela, nous utilisons l'outil &lt;tt class="docutils literal"&gt;slapadd&lt;/tt&gt; qui
à l'avantage de pouvoir travailler sans daemon ldap actif. En lui
fournissant le fichier de configuration il est capable d'écrire
directement dans les fichiers de la base. Dans un premier temps, nous le
lançons avec l'option &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-u&lt;/span&gt;&lt;/tt&gt; afin de le lancer en mode &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;dry-run&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# slapadd -f vieuxslapd.conf&amp;nbsp; -c -u -o schema-check=yes -l vieuxslap.ldif
&lt;/pre&gt;
&lt;p&gt;Si cette commande ne sort pas d'erreurs, on peut la faire en réelle.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# slapadd -f vieuxslapd.conf&amp;nbsp; -c -o schema-check=yes -l vieuxslap.ldif
&lt;/pre&gt;
&lt;p&gt;A partir de là, on dispose d'une base ldap fonctionnelle et si on lance
la daemon slapd en lui fournissant le fichier de configuration, tout
devrait fonctionner.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# slapd -u ldap -f vieuxslapd.conf
&lt;/pre&gt;
&lt;p&gt;Mais, comme je l'ai dit plus haut, la bonne pratique est plutôt de
stocker la configuration en base olc. Cette base se trouve dans
&lt;tt class="docutils literal"&gt;/etc/openldap/slapd.d&lt;/tt&gt; et contient déjà de quoi faire fonctionner un
slapd basique mais vide. L'utilitaire &lt;tt class="docutils literal"&gt;slaptest&lt;/tt&gt; que nous avons
utilisé pour vérifier le fichier de configuration est également utilisé
pour faire cette migration. En lui fournissant d'un coté le fichier de
configuration et de l'autre le dossier de destination, il va transformer
le contenu du fichier en instructions ldif.&lt;/p&gt;
&lt;p&gt;Avant tout, on supprime le contenu actuel du répertoire.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# rm -Rf /etc/openldap/slapd.d/*
&lt;/pre&gt;
&lt;p&gt;On lance la migration de la configuration&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# slaptest -f vieuxslapd.conf -F /etc/openldap/slapd.d/
&lt;/pre&gt;
&lt;p&gt;0n corrige les droits pour que le daemon puisse travailler&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# chown -R ldap. /etc/openldap/slapd.d/
&lt;/pre&gt;
&lt;p&gt;Enfin, on importe le fichier &lt;tt class="docutils literal"&gt;DB_CONFIG&lt;/tt&gt; afin d'avoir des performances
normales sur la base&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
[aldevar&amp;#64;serveur]# chown ldap. /var/lib/ldap/DB_CONFIG
&lt;/pre&gt;
&lt;p&gt;Pour finir, on peut démarrer le daemon&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[aldevar&amp;#64;serveur]# systemctl start slapd
[aldevar&amp;#64;serveur]# systemctl enable slapd
&lt;/pre&gt;
</content><category term="Tech"></category><category term="centos"></category><category term="migration"></category><category term="openldap"></category><category term="slap"></category></entry><entry><title>Debian abandonne la Linux Standard Base</title><link href="https://blog.devarieux.net/2015/10/debian-abandonne-la-linux-standard-base.html" rel="alternate"></link><published>2015-10-20T21:56:00+02:00</published><updated>2015-10-20T21:56:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-10-20:/2015/10/debian-abandonne-la-linux-standard-base.html</id><summary type="html">&lt;p&gt;&lt;a class="reference external" href="https://lwn.net/Articles/658809/"&gt;LWN a annoncé&lt;/a&gt; il y a déjà
quelques jours que la communauté Debian abandonnait le support de la
&lt;a class="reference external" href="http://refspecs.linuxfoundation.org/lsb.shtml"&gt;Linux Standard Base&lt;/a&gt;
(LSB). La LSB tente de se définir comme un standard de compatibilité des
différentes distributions. En suivant ces règles, chaque binaire devrait
simplement fonctionner sur chaque distribution, que ce …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a class="reference external" href="https://lwn.net/Articles/658809/"&gt;LWN a annoncé&lt;/a&gt; il y a déjà
quelques jours que la communauté Debian abandonnait le support de la
&lt;a class="reference external" href="http://refspecs.linuxfoundation.org/lsb.shtml"&gt;Linux Standard Base&lt;/a&gt;
(LSB). La LSB tente de se définir comme un standard de compatibilité des
différentes distributions. En suivant ces règles, chaque binaire devrait
simplement fonctionner sur chaque distribution, que ce soit Debian, RHEL
ou SLES.&lt;/p&gt;
&lt;p&gt;Difficile d'en vouloir aux mainteneurs Debian. La LSB est très vaste et
&lt;a class="reference external" href="https://www.linuxbase.org/lsb-cert/productdir.php?by_lsb"&gt;très peu
d'applications&lt;/a&gt;ont
reçu la certification LSB. Ajoutez à cela que le gestionnaire de paquet
RPM est celui qui a été choisi et vous avez un standard dont les specs
vont à l'encontre de ce que propose Debian.&lt;/p&gt;
&lt;p&gt;Le fait que Debian stoppe les efforts pour rester compatible avec LSB ne
signifie pas forcement qu'elle va devenir incompatible avec les autres
distributions. Debian prévoie de rester compatible avec le standard de
hiérarchie des systèmes de fichiers (&lt;a class="reference external" href="http://www.linuxfoundation.org/collaborate/workgroups/lsb/fhs"&gt;Filesystem Hierarchy
Standard&lt;/a&gt;),
un des éléments de LSB qui défini où doivent se trouver certains
fichiers et répertoires. C'est en effet un des standard majeur pour
conserver un semblant de compatibilité entre distributions.&lt;/p&gt;
&lt;p&gt;Sur le court terme, cela ressemble à un non événement. A plus long
terme, on peut se demander ce qu'il va advenir de l'écosystème Linux.
Créer une distribution et la maintenir est déjà une tâche
particulièrement difficile.Imaginez alors ce que cela doit être de
coordonner des standards a travers plusieurs distributions ...&lt;/p&gt;
&lt;p&gt;Parmi les distributions majeures, nous avons typiquement 2 camps:
Debian/Ubuntu et Fedora/RHEL. Ces 2 camps ont réussi à ne pas trop
s'éloigner l'un de l'autre et on peut penser que systemd avait commencé
ce processus de coordination. Les normes sont importantes, mais
seulement dans la mesure où elles sont respectées. Jusqu'ici GNU/Linux a
évité le problème &lt;a class="reference external" href="https://xkcd.com/927/"&gt;des normes concurrentes&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Cela va-t-il rester le cas?&lt;/p&gt;
</content><category term="News"></category></entry><entry><title>Scripter, programmer</title><link href="https://blog.devarieux.net/2015/09/scripter-programmer.html" rel="alternate"></link><published>2015-09-25T07:14:00+02:00</published><updated>2015-09-25T07:14:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-09-25:/2015/09/scripter-programmer.html</id><summary type="html">&lt;p&gt;Il y a quelques mois, &lt;a class="reference external" href="https://twitter.com/_Desmoden"&gt;Jon Hudson&lt;/a&gt;,
ingénieur réseau chez Brocade, a présenté un discours très intéressant
au &lt;a class="reference external" href="http://techfieldday.com/event/nfd9"&gt;Network Field Day 9&lt;/a&gt; sur le
sujet de la programmabilité en réseau.&lt;/p&gt;
&lt;p&gt;Durant la conversation (qui vaut vraiment le coup d'être vu), une
question de John Herbert de
&lt;a class="reference external" href="http://movingpackets.net/"&gt;MovingPackets.net&lt;/a&gt; a été …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Il y a quelques mois, &lt;a class="reference external" href="https://twitter.com/_Desmoden"&gt;Jon Hudson&lt;/a&gt;,
ingénieur réseau chez Brocade, a présenté un discours très intéressant
au &lt;a class="reference external" href="http://techfieldday.com/event/nfd9"&gt;Network Field Day 9&lt;/a&gt; sur le
sujet de la programmabilité en réseau.&lt;/p&gt;
&lt;p&gt;Durant la conversation (qui vaut vraiment le coup d'être vu), une
question de John Herbert de
&lt;a class="reference external" href="http://movingpackets.net/"&gt;MovingPackets.net&lt;/a&gt; a été posée : &amp;quot;&lt;em&gt;Les
ingénieurs réseaux deviendront-ils des programmeurs?&lt;/em&gt;&amp;quot;. La réponse de
Jon Hudson a suscité les applaudissements de l'audience :&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;Le problème que j'ai avec cette affirmation est que la majorité des
ingénieurs réseaux que je connais, moi y compris, savent comment
coder. Nous avons fait des études dans ce domaine et nous avons
choisi de ne pas le faire.&amp;quot; – Jon Hudson&lt;/p&gt;
&lt;p&gt;“The trouble I have with that statement is, most network engineers I
know, like myself, we know how to code. We went to school for it,
and we chose not to.” – Jon Hudson&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Il ne faut pas oublier en effet qu'il y a une différence fondamentale
entre scripter, écrire des outils d'administration et programmer.&lt;/p&gt;
&lt;p&gt;Le script, c'est le petit programme qu'on écrit à l'école pour
s’entraîner. &lt;em&gt;&amp;quot;Calculer les années bissextile pour les 300 prochaines
années&amp;quot;&lt;/em&gt;, ou &lt;em&gt;&amp;quot;Parcourir les lignes de ce fichier et effectuer X
traitements sur cette ligne&amp;quot;&lt;/em&gt;. C'est fun, souvent pratique, mentalement
stimulant et facile à réutiliser. Il résout un problème spécifique et
peu facilement être dupliqué ou modifié pour résoudre un autre problème.
Par contre la plupart de ces scripts sont fragiles, peu efficaces et
souvent non sécurisés.&lt;/p&gt;
&lt;p&gt;Je ne suis pas du tout développeur mais du peu que je sache, écrire un
programme, pour moi, ça ressemble à: &lt;em&gt;&amp;quot;La fonction recevra en entrée un
pointeur vers un vecteur contenant une valeur qui doit être validée par
rapport au contenu du dictionnaire. Chaque exception durant l’exécution
de la routine doit être gérée. La fonction doit retourner un pointeur à
la fonction appelante qui va référencer un nouveau vecteur contenant la
valeur calculée de l'espace de nom de la fonction appelée. Documenter le
code en détail et démontrer que le code rédigé s’exécute en utilisant le
moins de demande d'allocation mémoire.&amp;quot;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Ce que je viens d'écrire est sans doute un ramassis de n'importe quoi
mais c'est environ a ce niveau là que je décroche de la programmation et
que mon intérêt pour cette compétence se réduit à peau de chagrin. Il me
semble que le scripting et la programmation sont 2 choses bien
différentes que certaines personnes ont tendance à mélanger.&lt;/p&gt;
&lt;p&gt;Ainsi, quand on nous assène qu'en tant que sysadmin ou ingé / technicien
réseau on DOIT savoir coder, je suis plutôt d'accord, surtout à l'heure
du Software Define Network, Software Define Storage ou plus globalement
du Software Define Datacenter et de l'hyperconvergence des
infrastructures. On pourra toujours tout faire à la main, que ce soit en
ligne de commande ou via une GUI, mais quand on travail dans un système
distribué possédant des APIs, il est bien plus facile d'utiliser un
script (qui a dit Python?) ou des outils comme Puppet/Ansible/Salt.
Attention cependant à la sémantique. Coder (écrire du code) ce n'est pas
la même chose que programmer (écrire un programme).&lt;/p&gt;
&lt;p&gt;Il est important, quand on travail dans l'IT, de savoir scripter. Il y a
plein de tâches répétitives, ennuyeuses qu'on souhaite automatiser au
maximum. Il y aussi plein d'autres tâches plus rapide à faire à la main
et parfois difficile à automatiser. Pour résumer, construisez votre
script quand celui ci vous permet de faire votre tâche plus vite, mieux
et moins cher tout en évitant que le code soit instaurer comme nouvelle
religion de l'IT. Si vous avez besoin d'une scie, utilisez une scie. Si
vous avez besoin d'une scie sauteuse pour mieux scier, construisez votre
scie sauteuse mais faite attention de ne pas devenir un constructeur de
scie sauteuse qui a oublié comment scier.&lt;/p&gt;
</content><category term="Humeur"></category></entry><entry><title>GNS3 - Créer son premier Lab</title><link href="https://blog.devarieux.net/2015/08/gns3-creer-son-premier-lab.html" rel="alternate"></link><published>2015-08-26T10:03:00+02:00</published><updated>2015-08-26T10:03:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-08-26:/2015/08/gns3-creer-son-premier-lab.html</id><summary type="html">&lt;div class="section" id="premier-lancement"&gt;
&lt;h2&gt;Premier Lancement&lt;/h2&gt;
&lt;p&gt;Après avoir installé GNS3 et ses différents modules dans &lt;a class="reference external" href="http://images/2015/08/prise-en-main-de-gns3-pour-la-simulation-reseau/"&gt;un précédent
article&lt;/a&gt;,
nous allons maintenant voir comment créer un Lab et faire un petit
exercice simple de configuration de routes statiques. La première chose
est d'ajouter un nouveau routeur dans la configuration de GNS3. Ici, ce
sera un …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="section" id="premier-lancement"&gt;
&lt;h2&gt;Premier Lancement&lt;/h2&gt;
&lt;p&gt;Après avoir installé GNS3 et ses différents modules dans &lt;a class="reference external" href="http://images/2015/08/prise-en-main-de-gns3-pour-la-simulation-reseau/"&gt;un précédent
article&lt;/a&gt;,
nous allons maintenant voir comment créer un Lab et faire un petit
exercice simple de configuration de routes statiques. La première chose
est d'ajouter un nouveau routeur dans la configuration de GNS3. Ici, ce
sera un c2691, qui est un vieux routeur possédant 4 emplacements. Si
vous me demandez gentiment, je peux peut-être vous fournir l'image IOS
pour ce modèle.&lt;/p&gt;
&lt;p&gt;Au premier lancement de GNS3, il vous est proposé de créer un projet, ce
que nous allons faire tout de suite en enregistrant ce projet sous le
nom FirstLab.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-21_47_47-Prise-en-main-de-GNS3-pour-la-simulation-réseau-À-La-Benne-Nightly.png"&gt;&lt;img alt="2015-08-25-21_47_47-Prise_en_main_de_GNS3_pour_la_simulation_réseau" src="images/2015-08-25-21_47_47-Prise-en-main-de-GNS3-pour-la-simulation-réseau-À-La-Benne-Nightly.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-25-21_48_59-New-project.png"&gt;&lt;img alt="2015-08-25-21_48_59-New-project" src="images/2015-08-25-21_48_59-New-project.png" /&gt;&lt;/a&gt;Une fois le
projet créé, on va ajouter un routeur dans la configuration de GNS3.
Pour cela, on se rend dans Edit &amp;gt; Preferences.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-21_51_11-Preferences.png"&gt;&lt;img alt="2015-08-25-21_51_11-Preferences" src="images/2015-08-25-21_51_11-Preferences.png" /&gt;&lt;/a&gt;Je vous laisse parcourir les
options afin que vous puissiez comprendre un peu mieux le logiciel. Si
vous avez des VM VirtualBox, GNS3 les trouvera et vous les listera dans
le menu VirtualBox&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-22_00_01-Preferences.png"&gt;&lt;img alt="2015-08-25-22_00_01-Preferences" src="images/2015-08-25-22_00_01-Preferences.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ajout-d-un-routeur"&gt;
&lt;h2&gt;Ajout d'un routeur&lt;/h2&gt;
&lt;p&gt;Pour ajouter un routeur Cisco, on se rend dans Dynamips &amp;gt; IOS Router et
on clique sur New. Il suffit ensuite de suivre les indications et de
fournir l'image IOS du routeur qu'on souhaite voir apparaître.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-21_55_51-Preferences.png"&gt;&lt;img alt="2015-08-25-21_55_51-Preferences" src="images/2015-08-25-21_55_51-Preferences.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-25-21_56_47-New-IOS-router-template.png"&gt;&lt;img alt="2015-08-25-21_56_47-New IOS router template" src="images/2015-08-25-21_56_47-New-IOS-router-template.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-25-21_57_08-New-IOS-router-c2691-jk9s-mz.123-17.image_.png"&gt;&lt;img alt="2015-08-25-21_57_08-New IOS router - c2691-jk9s-mz.123-17.image" src="images/2015-08-25-21_57_08-New-IOS-router-c2691-jk9s-mz.123-17.image_.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-25-21_57_22-New-IOS-router-c2691-jk9s-mz.123-17.image_.png"&gt;&lt;img alt="2015-08-25-21_57_22-New IOS router - c2691-jk9s-mz.123-17.image" src="images/2015-08-25-21_57_22-New-IOS-router-c2691-jk9s-mz.123-17.image_.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-25-21_58_01-New-IOS-router-c2691-jk9s-mz.123-17.image_.png"&gt;&lt;img alt="2015-08-25-21_58_01-New IOS router - c2691-jk9s-mz.123-17.image" src="images/2015-08-25-21_58_01-New-IOS-router-c2691-jk9s-mz.123-17.image_.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-25-21_59_26-New-IOS-router-c2691-jk9s-mz.123-17.image_.png"&gt;&lt;img alt="2015-08-25-21_59_26-New IOS router - c2691-jk9s-mz.123-17.image" src="images/2015-08-25-21_59_26-New-IOS-router-c2691-jk9s-mz.123-17.image_.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pour la valeur de Idle-PC, ne recopiez pas bêtement ce qui est écrit dans cette fenêtre. Ce chiffre correspond
seulement à ma machine. Cliquez sur le bouton Idle-Pc finder et GNS3
trouvera la valeur de lui même. Cela peut prendre un peu de temps à
calculer.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-21_59_40-Preferences.png"&gt;&lt;img alt="2015-08-25-21_59_40-Preferences" src="images/2015-08-25-21_59_40-Preferences.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Voilà, nous avons notrevrouteur c2691. On peut maintenant fermer la fenêtre de configuration et
commencer notre projet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="le-lab"&gt;
&lt;h2&gt;Le Lab&lt;/h2&gt;
&lt;p&gt;Nous allons mettre en place un Lab très basique de routage statique
entre 2 routeurs. Un premier routeur situé à Rennes aura une interface
Loopback ayant pour IP 2.2.2.2/24, et un second routeur à Paris aura une
interface Loopback ayant 1.1.1.1/24 pour IP.&lt;/p&gt;
&lt;p&gt;Sur chacun de ces 2 routeurs, nous allons ajouter une carte ayant 4
ports séries. Nous utiliserons 2 de ces ports. Le port Serial1/0 de
Rennes sera branché au port Serial1/0 de Paris et le port Serial1/1 de
Rennes sera branché sur le port Serial1/1 de Paris.&lt;/p&gt;
&lt;p&gt;Les configurations IP seront les suivantes :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Rennes Serial1/0 : 192.168.1.1/24&lt;/li&gt;
&lt;li&gt;Rennes Serial1/1 : 192.168.2.1/24&lt;/li&gt;
&lt;li&gt;Paris Serial1/0 : 192.168.1.2/24&lt;/li&gt;
&lt;li&gt;Paris Serial1/1 : 192.168.2.2/24&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Et pour rappel, les interfaces Loopback&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Rennes Loopback0 : 2.2.2.2/24&lt;/li&gt;
&lt;li&gt;Paris Loopback0 : 1.1.1.1/24&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Une fois tout cela mis en place, le but sera de réussir à pinger l'IP
1.1.1.1 depuis Rennes et pinger l'IP 2.2.2.2 depuis Paris en mettant en
place des routes statiques.&lt;/p&gt;
&lt;p&gt;Pour la mise en place du Lab, suivez le guide...&lt;/p&gt;
&lt;p&gt;Cliquez sur &lt;em&gt;Browse Routers&lt;/em&gt; dans la colonne de gauche puis glissez 2
fois le routeur c2691 dans le projet. Sur le routeur R1, faites un
clique droit : &lt;em&gt;Configure&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-22_02_55-FirstLab.gns3_-—-GNS3.png"&gt;&lt;img alt="2015-08-25-22_02_55-FirstLab.gns3_ — GNS3" src="images/2015-08-25-22_02_55-FirstLab.gns3_-—-GNS3.png" /&gt;&lt;/a&gt;
Renommez le en &lt;strong&gt;Rennes&lt;/strong&gt; et dans l'onglet &lt;em&gt;slot&lt;/em&gt;, ajoutez lui une carte NM-4T dans le
Slot 1. Faites de même pour le routeur R2 en le renommant &lt;strong&gt;Paris&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-22_05_43-Node-configurator.png"&gt;&lt;img alt="2015-08-25-22_05_43-Node configurator" src="images/2015-08-25-22_05_43-Node-configurator.png" /&gt;&lt;/a&gt;
Une fois de retour sur le
projet, cliquez sur '&lt;em&gt;Add a Link'&lt;/em&gt; dans la colonne de gauche et créer 2
liens séries en cliquant dans un premier temps sur &lt;em&gt;Rennes &amp;gt; Serial 1/0&lt;/em&gt;
puis &lt;em&gt;Paris &amp;gt; Serial 1/0&lt;/em&gt; pour le premier lien et &lt;em&gt;Rennes &amp;gt; Serial 1/1&lt;/em&gt;
puis &lt;em&gt;Paris &amp;gt; Serial 1/1&lt;/em&gt; pour le second lien.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-22_07_19-FirstLab.gns3_-—-GNS3.png"&gt;&lt;img alt="2015-08-25-22_07_19-FirstLab.gns3_ — GNS3" src="images/2015-08-25-22_07_19-FirstLab.gns3_-—-GNS3.png" /&gt;&lt;/a&gt;
Vous devriez avoir
quelque chose qui ressemble à ça :&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-25-22_11_04-FirstLab.gns3_-—-GNS3.png"&gt;&lt;img alt="2015-08-25-22_11_04-FirstLab.gns3_ — GNS3" src="images/2015-08-25-22_11_04-FirstLab.gns3_-—-GNS3.png" /&gt;&lt;/a&gt;
J'ai moi même ajouté les
notes sur les réseaux grâce aux notes que l'on peut insérer dans le
projet.&lt;/p&gt;
&lt;p&gt;Une fois que c'est terminé, cliquez sur le Play vert qui se trouve en
haut de l'interface afin de démarrer les routeurs.&lt;/p&gt;
&lt;p&gt;Nous allons enfin pouvoir ouvrir notre première console Cisco. Pour
cela, clique droit sur un routeur &amp;gt; &lt;em&gt;Console&lt;/em&gt;&lt;a class="reference external" href="images/2015-08-25-22_19_50-FirstLab.gns3-—-GNS3.png"&gt;&lt;img alt="2015-08-25-22_19_50-FirstLab.gns3 — GNS3" src="images/2015-08-25-22_19_50-FirstLab.gns3-—-GNS3.png" /&gt;&lt;/a&gt;Pour préparer le lab, voici les
commandes à taper dans la console de Rennes :&lt;/p&gt;
&lt;p&gt;IOS supporte la tabulation et les raccourcis. Par exemple, pour taper
&lt;tt class="docutils literal"&gt;configure terminal&lt;/tt&gt;, je peux taper &lt;tt class="docutils literal"&gt;conf&amp;lt;tab&amp;gt; t&amp;lt;tab&amp;gt;&lt;/tt&gt; ou tout
simplement &lt;tt class="docutils literal"&gt;conf t&lt;/tt&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Rennes#enable                    //active le mode privilège
Rennes#conf t                    //configure terminal
Rennes(config)#int loopback0     //configurer l'interface Loopback0
Rennes(config-ig)#ip add 2.2.2.2 255.255.255.0
Rennes(config-if)#no shut        //monter l'interface (état up)
Rennes(config-if)#exit
Rennes(config)#int Serial1/0
Rennes(config-if)#ip add 192.168.1.1 255.255.255.0
Rennes(config-if)#no shut
Rennes(config-if)#exit
Rennes(config)#int Serial1/1
Rennes(config-if)#ip add 192.168.2.1 255.255.255.0
Rennes(config-if)#no shut
Rennes(config-if)#exit
Rennes(config)#
&lt;/pre&gt;
&lt;p&gt;Même manipulation sur le routeur de Paris :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Paris#enable
Paris#conf t
Paris(config)#int loopback0
Paris(config-ig)#ip add 1.1.1.1 255.255.255.0
Paris(config-if)#no shut
Paris(config-if)#exit
Paris(config)#int Serial1/0
Paris(config-if)#ip add 192.168.1.2 255.255.255.0
Paris(config-if)#no shut
Paris(config-if)#exit
Paris(config)#int Serial1/1
Paris(config-if)#ip add 192.168.2.2 255.255.255.0
Paris(config-if)#no shut
Paris(config-if)#exit
Paris(config)#
&lt;/pre&gt;
&lt;p&gt;Afin de voir l'état de vos interfaces, vous pouvez taper la commande
suivantes : &lt;tt class="docutils literal"&gt;do show ip int brief&lt;/tt&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Rennes(config)#do show ip int brief
Interface                  IP-Address      OK? Method Status                Protocol
FastEthernet0/0            unassigned      YES unset  administratively down down
FastEthernet0/1            unassigned      YES unset  administratively down down
Serial1/0                  192.168.1.1     YES manual up                    up
Serial1/1                  192.168.2.1     YES manual up                    up
Serial1/2                  unassigned      YES unset  administratively down down
Serial1/3                  unassigned      YES unset  administratively down down
Loopback0                  2.2.2.2         YES manual up                    up
&lt;/pre&gt;
&lt;p&gt;Arriver ici, le but est de pinger l'interface Loopback de Rennes depuis
Paris en passant par le réseau 192.168.1.0 et l'interface Loopback de
Paris depuis Rennes en passant par le réseau 192.168.2.0.&lt;/p&gt;
&lt;p&gt;Pour arriver à cet objectif, nous allons dire au routeur de Paris que
pour rejoindre le réseau 2.2.2.0/24 il doit passer par l'interface de
Rennes 192.168.1.1 qu'il connait car il est directement branché dessus.&lt;/p&gt;
&lt;p&gt;De la même manière, nous allons dire au routeur de Rennes qu'il soit
passer par l'interface 192.168.2.2 de Paris pour joindre le réseau
1.1.1.0/24.&lt;/p&gt;
&lt;p&gt;Voici donc les commandes à taper en console&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Paris(config)#ip route 2.2.2.0 255.255.255.0 192.168.1.1
Paris(config)#do ping 2.2.2.2

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 2.2.2.2, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 112/243/288 ms
Paris(config)#
&lt;/pre&gt;
&lt;p&gt;Le ping fonctionne!!&lt;/p&gt;
&lt;p&gt;Depuis Rennes&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Rennes(config)#ip route 1.1.1.0 255.255.255.0 192.168.2.2
Rennes(config)#do ping 1.1.1.1

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 1.1.1.1, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 128/136/148 ms
Rennes(config)#do show ip route        //pour voir les routes statiques
Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; E1 - OSPF external type 1, E2 - OSPF external type 2
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ia - IS-IS inter area, * - candidate default, U - per-user static route
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; o - ODR, P - periodic downloaded static route

Gateway of last resort is not set

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 1.0.0.0/24 is subnetted, 1 subnets
S&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 1.1.1.0 [1/0] via 192.168.2.2
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2.0.0.0/24 is subnetted, 1 subnets
C&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2.2.2.0 is directly connected, Loopback0
C&amp;nbsp;&amp;nbsp;&amp;nbsp; 192.168.1.0/24 is directly connected, Serial1/0
C&amp;nbsp;&amp;nbsp;&amp;nbsp; 192.168.2.0/24 is directly connected, Serial1/1
&lt;/pre&gt;
&lt;p&gt;Voilà pour la prise en main de GNS3 et la configuration basique de 2
routeurs. Vous n'avez plus qu'à créer vos propres labs, ajouter des VM
et tenter de les faire communiquer par exemple.&lt;/p&gt;
&lt;p&gt;Je vous proposerais peut être moi même de nouveaux labs d'ici quelques
temps&lt;/p&gt;
&lt;/div&gt;
</content><category term="Réseaux, Virtualisation"></category></entry><entry><title>Firefox comme navigateur par défaut de SailfishOS</title><link href="https://blog.devarieux.net/2015/08/firefox-comme-navigateur-par-defaut-de-sailfishos.html" rel="alternate"></link><published>2015-08-24T09:17:00+02:00</published><updated>2015-08-24T09:17:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-08-24:/2015/08/firefox-comme-navigateur-par-defaut-de-sailfishos.html</id><summary type="html">&lt;p&gt;Jolla et son SailfishOS sont vraiment de beaux outils mais il faut
avouer qu'ils ont quand même un problème majeur, c'est la piètre qualité
des navigateurs intégrés et surtout du navigateur par défaut.&lt;/p&gt;
&lt;p&gt;Malheureusement, l'interface ne propose actuellement aucune option pour
modifier ce comportement. Ainsi, lorsqu'on clique sur un lien …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Jolla et son SailfishOS sont vraiment de beaux outils mais il faut
avouer qu'ils ont quand même un problème majeur, c'est la piètre qualité
des navigateurs intégrés et surtout du navigateur par défaut.&lt;/p&gt;
&lt;p&gt;Malheureusement, l'interface ne propose actuellement aucune option pour
modifier ce comportement. Ainsi, lorsqu'on clique sur un lien dans une
autre application c'est forcement ce navigateur tout moisi qui s'ouvre
et qui met 3 heures à charger la page. Heureusement, avec quelques
bidouille, il est possible de paramétrer Firefox comme navigateur par
défaut, c'est d'ailleurs ce que je viens de faire :)&lt;/p&gt;
&lt;p&gt;Si vous avez déjà Firefox d'installé, vous pouvez directement vous
rendre au paragraphe 'Paramétrage d'ADB'.&lt;/p&gt;
&lt;div class="section" id="installation-d-aptoide"&gt;
&lt;h2&gt;Installation d'Aptoide&lt;/h2&gt;
&lt;p&gt;La première étape est d'installer le market Aptoide si ce n'est pas déjà
fait. Pour cela, il faut se rendre dans la Boutique Jolla, puis dans
'Place de marché' tout en bas et installer le market Aptoide Appstore&lt;/p&gt;
&lt;p&gt;[gallery size=&amp;quot;medium&amp;quot; columns=&amp;quot;2&amp;quot; link=&amp;quot;file&amp;quot; ids=&amp;quot;571,572&amp;quot;]&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="installation-de-firefox"&gt;
&lt;h2&gt;Installation de Firefox&lt;/h2&gt;
&lt;p&gt;L'installation de Firefox se fait via Aptoide, il faut donc ouvrir
l'application nouvellement installée et dans la zone de recherche, taper
Firefox. Il faut ensuite trouver l'application &lt;strong&gt;Firefox Browser for
Android&lt;/strong&gt; et l'installer.&lt;/p&gt;
&lt;p&gt;[gallery link=&amp;quot;file&amp;quot; columns=&amp;quot;2&amp;quot; size=&amp;quot;medium&amp;quot; ids=&amp;quot;575,576,577,578&amp;quot;]&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="parametrage-d-adb"&gt;
&lt;h2&gt;Paramétrage d'ADB&lt;/h2&gt;
&lt;p&gt;C'est partie pour le bricolage. Il faut d'abord &lt;a class="reference external" href="http://blog.devarieux.net/2015/03/se-connecter-en-ssh-a-son-jolla/"&gt;se connecter en
SSH&lt;/a&gt;
à l'appareil afin d'y modifier le comportement d'Alien. Pour cela, il
faut éditer le fichier /opt/alien/system/build.prop et ajouter à la fin
:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
persist.service.adb.enable=1
service.adb.tcp.port=5555
&lt;/pre&gt;
&lt;p&gt;Une fois cette modification faite, on relance Alien Dalvik&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla ~]# systemctl restart aliendalvik.service
&lt;/pre&gt;
&lt;p&gt;Maintenant, un process adb doit apparaitre&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla ~]# ps aux | grep adb
 shell&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 5162&amp;nbsp; 0.0&amp;nbsp; 0.0&amp;nbsp;&amp;nbsp; 6532&amp;nbsp;&amp;nbsp;&amp;nbsp; 92 ?&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Ssl&amp;nbsp; 23:04&amp;nbsp;&amp;nbsp; 0:00 /system/root/sbin/adbd
 root&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 5592&amp;nbsp; 0.0&amp;nbsp; 0.0&amp;nbsp;&amp;nbsp; 3984&amp;nbsp;&amp;nbsp; 288 pts/0&amp;nbsp;&amp;nbsp;&amp;nbsp; Sl&amp;nbsp;&amp;nbsp; 23:06&amp;nbsp;&amp;nbsp; 0:00 adb fork-server server
 root&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 7330&amp;nbsp; 0.0&amp;nbsp; 0.0&amp;nbsp;&amp;nbsp; 2256&amp;nbsp;&amp;nbsp; 544 pts/0&amp;nbsp;&amp;nbsp;&amp;nbsp; S+&amp;nbsp;&amp;nbsp; 23:57&amp;nbsp;&amp;nbsp; 0:00 grep adb
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla ~]# lsof -p 5162 | grep android_adb
 adbd&amp;nbsp;&amp;nbsp;&amp;nbsp; 5162 shell&amp;nbsp;&amp;nbsp; 10u&amp;nbsp;&amp;nbsp; CHR&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 10,25&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 0t0&amp;nbsp; 1437 /opt/alien/dev/android_adb
&lt;/pre&gt;
&lt;p&gt;Une fois que tout ça est ok, on lance en root :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;localhost bin]# /opt/alien/system/bin/adb kill-server
[root&amp;#64;localhost bin]# /opt/alien/system/bin/adb devices
* daemon not running. starting it now on port 5038 *
* daemon started successfully *
List of devices attached
emulator-5554   device

[root&amp;#64;localhost bin]#
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="parametrage-de-sailfishos"&gt;
&lt;h2&gt;Paramétrage de SailfishOS&lt;/h2&gt;
&lt;p&gt;La système est maintenant prêt à accueillir nos modifications. Toujours
dans la connexion SSH, se rendre dans /usr/share/applications, faire une
copie de sauvegarde du fichier open-url.desktop et le modifier pour
qu'il ne prenne plus en charge les types MIME http et https&lt;/p&gt;
&lt;pre class="literal-block"&gt;
cd /usr/share/applications
cp -a open-url.desktop open-url.desktop.ori
vi open-url.desktop
&lt;/pre&gt;
&lt;p&gt;Une fois dans le fichier, on supprime la ligne&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
MimeType=text/html;x-maemo-urischeme/http;x-maemo-urischeme/https;
&lt;/pre&gt;
&lt;p&gt;Le fichier doit maintenant ressembler à cela&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla applications]# cat open-url.desktop
[Desktop Entry]
Type=Application
Name=Browser
NotShowIn=X-MeeGo;
X-MeeGo-Logical-Id=sailfish-browser-ap-name
X-MeeGo-Translation-Catalog=sailfish-browser
X-Maemo-Service=org.sailfishos.browser
X-Maemo-Method=org.sailfishos.browser.openUrl
&lt;/pre&gt;
&lt;p&gt;Créer ensuite le fichier firefox-as-default.desktop et y mettre ce
contenu&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[Desktop Entry]
Type=Application
Name=Browser
NotShowIn=X-MeeGo;
X-MeeGo-Logical-Id=sailfish-browser-ap-name
X-MeeGo-Translation-Catalog=sailfish-browser
X-Maemo-Service=org.sailfishos.browser
X-Maemo-Method=org.sailfishos.browser.openUrl
[root&amp;#64;Jolla applications]# cat firefox-as-default.desktop
[Desktop Entry]
Exec=/opt/alien/system/bin/adb -e shell am start -a android.intent.action.VIEW -n org.mozilla.firefox/.App -d ' %U'
Name=Firefox HTTP handler (opener)
Type=Application
MimeType=text/html;x-maemo-urischeme/http;x-maemo-urischeme/https;
X-Nemo-Application-Type=no-invoker
X-Nemo-Single-Instance=no
X-apkd-apkfile=/data/app/org.mozilla.firefox.apk
NoDisplay=true
&lt;/pre&gt;
&lt;p&gt;Afin de prendre ces modifications en compte, on met à jour le cache des
types MIME&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla applications]# update-desktop-database
&lt;/pre&gt;
&lt;p&gt;Le fichier mimeinfo.cache devrait maintenant contenir 2 lignes de ce
type&lt;/p&gt;
&lt;pre class="literal-block"&gt;
x-maemo-urischeme/http=firefox-as-default.desktop;
x-maemo-urischeme/https=firefox-as-default.desktop;
&lt;/pre&gt;
&lt;p&gt;Dorénavant, lorsqu'un lien sera cliqué dans une application (message,
twitter...) celui s'ouvrir avec Firefox.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category></entry><entry><title>Vmware Client Integration Plugin HS dans Firefox</title><link href="https://blog.devarieux.net/2015/08/vmware-client-integration-plugin-hs-dans-firefox.html" rel="alternate"></link><published>2015-08-23T14:00:00+02:00</published><updated>2015-08-23T14:00:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-08-23:/2015/08/vmware-client-integration-plugin-hs-dans-firefox.html</id><summary type="html">&lt;p&gt;Depuis quelques semaines, le plugin d'intégration client VMware ne
fonctionne plus dans Firefox. La case &amp;quot;Utiliser les identifiants
Windows&amp;quot; est grisée et d'après l'interface de vCenter, le plugin n'est
pas installé sur votre machine.&lt;/p&gt;
&lt;p&gt;Ce problème est apparu avec Firefox 39 et concerne toutes les nouvelles
versions de Firefox depuis …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Depuis quelques semaines, le plugin d'intégration client VMware ne
fonctionne plus dans Firefox. La case &amp;quot;Utiliser les identifiants
Windows&amp;quot; est grisée et d'après l'interface de vCenter, le plugin n'est
pas installé sur votre machine.&lt;/p&gt;
&lt;p&gt;Ce problème est apparu avec Firefox 39 et concerne toutes les nouvelles
versions de Firefox depuis. Cela a plusieurs conséquences.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Impossible d'ouvrir les consoles des VM (la console HTML5, VMRC
fonctionne quant à lui)&lt;/li&gt;
&lt;li&gt;Impossible de déposer un fichier depuis son PC vers un Datastore via
le navigateur HTML5&lt;/li&gt;
&lt;li&gt;Impossible de déployer un template OVF depuis son PC via l'option de
déploiement de fichier OVF local.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour corriger ce problème, il faut désactiver les options
security.ssl3.dhe de Firefox.&lt;/p&gt;
&lt;p&gt;Pour cela, se rendre dans &lt;a class="reference external" href="about:config"&gt;about:config&lt;/a&gt;, rechercher security.ssl3.dhe.
Vous devriez vous retrouver avec 2 entrées :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;security.ssl3.dhe_rsa_aes_128_sha&lt;/li&gt;
&lt;li&gt;security.ssl3.dhe_rsa_aes_256_sha&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Faire un clique droit sur chacune de ses entrées et cliquer sur
&lt;strong&gt;Inverser&lt;/strong&gt; (Toggle).&lt;/p&gt;
&lt;p&gt;Il ne reste plus qu'à rafraîchir la page vcenter.&lt;/p&gt;
&lt;p&gt;Source &lt;a class="reference external" href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;amp;cmd=displayKC&amp;amp;externalId=2125623"&gt;Vmware KB
2125623&lt;/a&gt;&lt;/p&gt;
</content><category term="Tech"></category></entry><entry><title>Comprendre la prédiction de noms des interfaces réseau de systemd</title><link href="https://blog.devarieux.net/2015/08/comprendre-la-prediction-de-noms-des-interfaces-reseau-de-systemd.html" rel="alternate"></link><published>2015-08-22T23:58:00+02:00</published><updated>2015-08-22T23:58:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-08-22:/2015/08/comprendre-la-prediction-de-noms-des-interfaces-reseau-de-systemd.html</id><summary type="html">&lt;p&gt;&lt;em&gt;Cet article est une traduction d'`un article
original &amp;lt;https://major.io/2015/08/21/understanding-systemds-predictable-network-device-names/&amp;gt;`__
de Major Hayden, publié `sur son blog &amp;lt;https://major.io/&amp;gt;`__ le 21 Aout
2015. Article traduit avec son aimable autorisation.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;J'ai un peu parlé des nom des interfaces réseau de systemd dans …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;em&gt;Cet article est une traduction d'`un article
original &amp;lt;https://major.io/2015/08/21/understanding-systemds-predictable-network-device-names/&amp;gt;`__
de Major Hayden, publié `sur son blog &amp;lt;https://major.io/&amp;gt;`__ le 21 Aout
2015. Article traduit avec son aimable autorisation.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;J'ai un peu parlé des nom des interfaces réseau de systemd dans un de
mes premiers post sur &lt;a class="reference external" href="https://major.io/2015/08/21/using-systemd-networkd-with-bonding-on-rackspaces-onmetal-servers/"&gt;systemd-networkd et le
bonding&lt;/a&gt;.
J'avais alors eu quelques questions sur la manière dont systemd
détermine le nom final des interfaces réseau. La prédictibilité de ces
noms m'a &lt;a class="reference external" href="https://major.io/2014/08/06/unexpected-predictable-network-naming-systemd/"&gt;pris de court l'été
dernier&lt;/a&gt;
quand je n'ai pas pu comprendre comment ces noms étaient construits.
|  Observons donc ce processus&lt;/p&gt;
&lt;div class="section" id="que-contient-le-nom"&gt;
&lt;h2&gt;Que contient le nom?&lt;/h2&gt;
&lt;p&gt;Dans l'article sur le bonding avec systemd-networkd, j'avais utilisé une
carte réseau Intel dual port montée sur un port hotplug&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# udevadm info -e | grep -A 9 ^P.*eth0
P: /devices/pci0000:00/0000:00:03.2/0000:08:00.0/net/eth0
E: DEVPATH=/devices/pci0000:00/0000:00:03.2/0000:08:00.0/net/eth0
E: ID_BUS=pci
E: ID_MODEL_FROM_DATABASE=82599ES 10-Gigabit SFI/SFP+ Network Connection (Ethernet OCP Server Adapter X520-2)
E: ID_MODEL_ID=0x10fb
E: ID_NET_DRIVER=ixgbe
E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link
E: ID_NET_NAME_MAC=enxa0369f2cec90
E: ID_NET_NAME_PATH=enp8s0f0
E: ID_NET_NAME_SLOT=ens9f0
&lt;/pre&gt;
&lt;p&gt;Dans ce dump de la base de donnée udev, on voit que l'interface réseau
possède plusieurs noms&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;ID_NET_NAME_MAC=enxa0369f2cec90&lt;/li&gt;
&lt;li&gt;ID_NET_NAME_PATH=enp8s0f0&lt;/li&gt;
&lt;li&gt;ID_NET_NAME_SLOT=ens9f0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;D'où viennent ces noms? Nous pouvons nous plonger dans la code source de
systemd pour comprendre l'origine de ces noms et lequel est sélectionné
au final.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="descendre-dans-le-terrier-de-udev"&gt;
&lt;h2&gt;Descendre dans le terrier de udev&lt;/h2&gt;
&lt;p&gt;Voici un extrait du fichier
&lt;a class="reference external" href="https://github.com/systemd/systemd/blob/master/src/udev/udev-builtin-net_id.c"&gt;src/udev/udev-builtin-net_id.c&lt;/a&gt;:&lt;/p&gt;
&lt;pre class="code c literal-block"&gt;
&lt;span class="cm"&gt;/*
 * Predictable network interface device names based on:
 *  - firmware/bios-provided index numbers for on-board devices
 *  - firmware-provided pci-express hotplug slot index number
 *  - physical/geographical location of the hardware
 *  - the interface's MAC address
 *
 * http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames
 *
 * Two character prefixes based on the type of interface:
 *   en -- ethernet
 *   sl -- serial line IP (slip)
 *   wl -- wlan
 *   ww -- wwan
 *
 * Type of names:
 *   b&amp;lt;number&amp;gt;                             -- BCMA bus core number
 *   ccw&amp;lt;name&amp;gt;                             -- CCW bus group name
 *   o&amp;lt;index&amp;gt;[d&amp;lt;dev_port&amp;gt;]                 -- on-board device index number
 *   s&amp;lt;slot&amp;gt;[f&amp;lt;function&amp;gt;][d&amp;lt;dev_port&amp;gt;]     -- hotplug slot index number
 *   x&amp;lt;MAC&amp;gt;                                -- MAC address
 *   [P&amp;lt;domain&amp;gt;]p&amp;lt;bus&amp;gt;s&amp;lt;slot&amp;gt;[f&amp;lt;function&amp;gt;][d&amp;lt;dev_port&amp;gt;]
 *                                         -- PCI geographical location
 *   [P&amp;lt;domain&amp;gt;]p&amp;lt;bus&amp;gt;s&amp;lt;slot&amp;gt;[f&amp;lt;function&amp;gt;][u&amp;lt;port&amp;gt;][..][c&amp;lt;config&amp;gt;][i&amp;lt;interface&amp;gt;]
 *                                         -- USB port number chain&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Voici donc la manière dont sont nommées nos interfaces. Les cartes
Ethernet commenceront toujours par &lt;em&gt;en&lt;/em&gt;, elles peuvent ensuite être
suivie d'un &lt;em&gt;p&lt;/em&gt; (pour port PCI), un &lt;em&gt;s&lt;/em&gt; (pour port PCI-E), un &lt;em&gt;o&lt;/em&gt; (pour
carte interne (onboard)). En descendant un peu dans le fichier, on
trouve des exemples à partir de la ligne 56.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="de-vrais-exemples"&gt;
&lt;h2&gt;De vrais exemples&lt;/h2&gt;
&lt;p&gt;Nous avons vu plus haut le nommage des interfaces PCI-E sur un serveur
OnMetal de chez Rackspace. Elles étaient nommées &lt;em&gt;ens9f0&lt;/em&gt; et &lt;em&gt;ens9f1&lt;/em&gt;.
Cela signifie qu'elles sont sur un port PCI-E qui se trouve être le port
numéro 9. Les indexes sont à 0 et 1 (pour les 2 ports Ethernet sur
l'Intel 82599ES).&lt;/p&gt;
&lt;div class="section" id="firewall-linux-avec-une-carte-pci-dual-port"&gt;
&lt;h3&gt;Firewall Linux avec une carte PCI dual-port.&lt;/h3&gt;
&lt;p&gt;Voici un exemple avec mon firewall Linux personnel. C'est un Dell
Optiplex 3020 avec une carte Intel I350-T2(dual-port):&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# udevadm info -e | grep -A 10 ^P.*enp1s0f1
 P: /devices/pci0000:00/0000:00:01.0/0000:01:00.1/net/enp1s0f1
 E: DEVPATH=/devices/pci0000:00/0000:00:01.0/0000:01:00.1/net/enp1s0f1
 E: ID_BUS=pci
 E: ID_MODEL_FROM_DATABASE=I350 Gigabit Network Connection (Ethernet Server Adapter I350-T2)
 E: ID_MODEL_ID=0x1521
 E: ID_NET_DRIVER=igb
 E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link
 E: ID_NET_NAME=enp1s0f1
 E: ID_NET_NAME_MAC=enxa0369f6e5227
 E: ID_NET_NAME_PATH=enp1s0f1
 E: ID_OUI_FROM_DATABASE=Intel Corporate
&lt;/pre&gt;
&lt;p&gt;L'affichage de lspci:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# lspci -s 01:00
 01:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01)
 01:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01)
&lt;/pre&gt;
&lt;p&gt;Cette carte est branchée sur le premier bus PCI (enp1), slot 0 (s0).
Comme c'est une carte dual-port, elle possède 2 indexes (f0 et f1). Cela
fait donc apparaître 2 noms prédictibles : &lt;em&gt;enp1s0f1&lt;/em&gt; et &lt;em&gt;enp1s0f0&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="serveur-1u-avec-4-ports-ethernet"&gt;
&lt;h3&gt;Serveur 1U avec 4 ports Ethernet.&lt;/h3&gt;
&lt;p&gt;Prenons un autre exemple. Voici un serveur SuperMicro X9SCA 1U avec 4
cartes Ethernet PCI internes.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# udevadm info -e | grep -A 10 ^P.*enp2s0
 P: /devices/pci0000:00/0000:00:1c.4/0000:02:00.0/net/enp2s0
 E: DEVPATH=/devices/pci0000:00/0000:00:1c.4/0000:02:00.0/net/enp2s0
 E: ID_BUS=pci
 E: ID_MODEL_FROM_DATABASE=82574L Gigabit Network Connection
 E: ID_MODEL_ID=0x10d3
 E: ID_NET_DRIVER=e1000e
 E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link
 E: ID_NET_NAME=enp2s0
 E: ID_NET_NAME_MAC=enx00259025963a
 E: ID_NET_NAME_PATH=enp2s0
 E: ID_OUI_FROM_DATABASE=Super Micro Computer, Inc.
&lt;/pre&gt;
&lt;p&gt;Voici les 4 cartes dans lspci&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# for i in `seq 2 5`; do lspci -s 0${i}:; done
 02:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection
 03:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection
 04:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection
 05:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection
&lt;/pre&gt;
&lt;p&gt;C'est assez intéressant car elles ne sont pas toutes sur le même bus
PCI. Elles se situent sur les bus 2 à 5 du slot 0. Il n'y a donc pas de
numéro d'index dans ce cas. Elles sont donc nommées de &lt;em&gt;enp2s0&lt;/em&gt; à
&lt;em&gt;enp5s0&lt;/em&gt;. Ce ne sont pas de vraies cartes internes, elles sont donc
nommées en fonction de leur localisation.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="serveur-de-stockage-avec-carte-ethernet-interne"&gt;
&lt;h3&gt;Serveur de stockage avec carte ethernet interne&lt;/h3&gt;
&lt;p&gt;Voici un exemple de serveur avec une vrai carte ethernet interne
(onboard):&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ udevadm info -e | grep -A 11 ^P.*eno1
 P: /devices/pci0000:00/0000:00:19.0/net/eno1
 E: DEVPATH=/devices/pci0000:00/0000:00:19.0/net/eno1
 E: ID_BUS=pci
 E: ID_MODEL_FROM_DATABASE=Ethernet Connection I217-V
 E: ID_MODEL_ID=0x153b
 E: ID_NET_DRIVER=e1000e
 E: ID_NET_LABEL_ONBOARD=en Onboard LAN
 E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link
 E: ID_NET_NAME_MAC=enxe03f49b159c0
 E: ID_NET_NAME_ONBOARD=eno1
 E: ID_NET_NAME_PATH=enp0s25
 E: ID_OUI_FROM_DATABASE=ASUSTek COMPUTER INC.
&lt;/pre&gt;
&lt;p&gt;L'affichage de lspci&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ lspci -s 00:19.0
 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-V (rev 05)
&lt;/pre&gt;
&lt;p&gt;Cette carte a un nouveau type de nom dans udev :
ID_NET_NAME_ONBOARD. Le code de udev pour systemd a une prise en
charge spécifique des cartes internes car elles se situent en général
sur le bus principal. Le nommage peut devenir assez laid car le 19
devrait être converti en hexadécimal dans le nom.
|  Si systemd ne prenait pas en charge cette carte différemment, elle
aurait du être nommée &lt;em&gt;enp0s13&lt;/em&gt; (car 19 devient 13 en hexa). Cela peut
mener à des confusions.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="choix-du-nom-finale"&gt;
&lt;h2&gt;Choix du nom finale&lt;/h2&gt;
&lt;p&gt;Comme nous l'avons vu plus haut, udev contient une grande liste de nom
dans sa base. Cependant, il ne peut y avoir qu'un seul nom dans l'OS.
|  Retournons dans le code. Cette fois, jetons un oeil a
&lt;a class="reference external" href="https://github.com/systemd/systemd/blob/master/src/udev/net/link-config.c#L403"&gt;src/udev/net/link-config.c&lt;/a&gt;
à partir de la ligne 403:&lt;/p&gt;
&lt;pre class="code c literal-block"&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;enable_name_policy&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;name_policy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;NamePolicy&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;name_policy&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
             &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;new_name&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;_NAMEPOLICY_INVALID&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;policy&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;switch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;policy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nl"&gt;NAMEPOLICY_KERNEL&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="n"&gt;respect_predictable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nl"&gt;NAMEPOLICY_DATABASE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="n"&gt;new_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;udev_device_get_property_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ID_NET_NAME_FROM_DATABASE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nl"&gt;NAMEPOLICY_ONBOARD&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="n"&gt;new_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;udev_device_get_property_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ID_NET_NAME_ONBOARD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nl"&gt;NAMEPOLICY_SLOT&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="n"&gt;new_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;udev_device_get_property_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ID_NET_NAME_SLOT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nl"&gt;NAMEPOLICY_PATH&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="n"&gt;new_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;udev_device_get_property_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ID_NET_NAME_PATH&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nl"&gt;NAMEPOLICY_MAC&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="n"&gt;new_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;udev_device_get_property_value&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;ID_NET_NAME_MAC&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                        &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
                                &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Si on regarde le case dans son ensemble, on voit que la première
correspondance est conservée et donne le nom à l'interface. En partant
du haut vers le bas, udev prend le premier de cette liste:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;ID_NET_NAME_FROM_DATABASE&lt;/li&gt;
&lt;li&gt;ID_NET_NAME_ONBOARD&lt;/li&gt;
&lt;li&gt;ID_NET_NAME_SLOT&lt;/li&gt;
&lt;li&gt;ID_NET_NAME_PATH&lt;/li&gt;
&lt;li&gt;ID_NET_NAME_MAC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Si on retourne sur le serveur OnMetal en haut de l'article, on peut
suivre cette logique. La base udev contient:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
E: ID_NET_NAME_MAC=enxa0369f2cec90
E: ID_NET_NAME_PATH=enp8s0f0
E: ID_NET_NAME_SLOT=ens9f0
&lt;/pre&gt;
&lt;p&gt;Le daemon udev commencerait par ID_NET_NAME_FROM_DATABASE, mais
cela n'existe pas pour cette carte. Il passe ensuite à
ID_NET_NAME_ONBOARD, qui n'est pas présent. Vient ensuite
ID_NET_NAME_SLOT, voilà la correspondance! L'entrée
ID_NET_NAME_SLOT contient &lt;em&gt;ens9f0&lt;/em&gt;, qui est donc le nom final de
l'interface réseau.
|  Cette boucle gère aussi quelques cas spéciaux. La première est de
vérifier si udev n'est pas configuré pour ne pas utiliser les noms
prédictible. Nous l'avions vu dans le post sur le&lt;a class="reference external" href="https://major.io/2015/08/21/using-systemd-networkd-with-bonding-on-rackspaces-onmetal-servers/"&gt;bonding avec
systemd-networkd&lt;/a&gt;
quand la configuration du bootloader contenait net.ifnames=0. Si cette
commande noyau est présente, les noms prédictibles ne sont pas utilisés.
|  Un autre cas spécial est ID_NET_NAME_FROM_DATABASE. Ces ports
viennent de la &lt;a class="reference external" href="https://github.com/systemd/systemd/blob/master/hwdb/20-net-ifname.hwdb"&gt;base de donnée matériel interne de
udev&lt;/a&gt;.
Ce fichier ne contient pour le moment qu'une seule entrée et c'est pour
une carte réseau particulière iDRAC de DELL.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="confondu-par-l-hexa"&gt;
&lt;h2&gt;Confondu par l'hexa&lt;/h2&gt;
&lt;p&gt;Si les numéros des ports PCI ne semblent pas se suivre, lisez mon
&lt;a class="reference external" href="https://major.io/2014/08/06/unexpected-predictable-network-naming-systemd/"&gt;post de l'été
dernier&lt;/a&gt;.
J'avais eu affaire à un serveur Dell particulier avec une carte Intel
dual-port sur le bus PCI 42. Le nom de l'interface était &lt;em&gt;enp66s0f0&lt;/em&gt; et
j'en étais resté perplexe.
|  Le nom &lt;em&gt;enp66s0f0&lt;/em&gt; semble signifier que nous avons une carte sur le
bus PCI 66, slot 0, avec de multiple fonction d'index. Cependant,
systemd fait une conversion des numéros de slot PCI en hexa. La décimal
42 devient donc 66 en hexa.
|  La plupart des serveurs n'auront pas cette complexité mais il est
important de se souvenir de la conversion en hexa.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="feedback"&gt;
&lt;h2&gt;Feedback&lt;/h2&gt;
&lt;p&gt;Ces articles sur systemd sont ils intéressant? Je suis un grand fan de
systemd et j'adore écrire à son sujet.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category></entry><entry><title>Ajouter Duckduckgo comme moteur de recherche dans SailfishOS</title><link href="https://blog.devarieux.net/2015/08/ajouter-duckduckgo-comme-moteur-de-recherche-dans-sailfishos.html" rel="alternate"></link><published>2015-08-20T22:10:00+02:00</published><updated>2015-08-20T22:10:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-08-20:/2015/08/ajouter-duckduckgo-comme-moteur-de-recherche-dans-sailfishos.html</id><summary type="html">&lt;p&gt;Par défaut, le navigateur de SailfishOS propose Bing, Yahoo ou Google
comme moteur de recherche et il n'y a pas d'interface pour ajouter de
nouveaux moteurs de recherche.&lt;/p&gt;
&lt;p&gt;Je vous propose ici une méthode pour ajouter un nouveau moteur de
recherche dans cette liste. Ici ce sera
&lt;a class="reference external" href="https://duckduckgo.com/"&gt;Duckduckgo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;La manipulation …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Par défaut, le navigateur de SailfishOS propose Bing, Yahoo ou Google
comme moteur de recherche et il n'y a pas d'interface pour ajouter de
nouveaux moteurs de recherche.&lt;/p&gt;
&lt;p&gt;Je vous propose ici une méthode pour ajouter un nouveau moteur de
recherche dans cette liste. Ici ce sera
&lt;a class="reference external" href="https://duckduckgo.com/"&gt;Duckduckgo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;La manipulation consiste à ajouter un fichier de description du moteur
de recherche dans le répertoire adéquat.&lt;/p&gt;
&lt;p&gt;La première étape est d'activer le mode développeur et de se connecter
en SSH à son Jolla. Si vous ne savez pas comment vous y prendre, vous
pouvez &lt;a class="reference external" href="http://blog.devarieux.net/2015/03/se-connecter-en-ssh-a-son-jolla/"&gt;suivre ce
tuto&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Une fois connecté en SSH, se connecter en root :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[nemo&amp;#64;Jolla ~]$ devel-su
&lt;/pre&gt;
&lt;p&gt;Se rendre dans /usr/lib/mozembedlite/chrome/embedlite/content/&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla nemo]# cd /usr/lib/mozembedlite/chrome/embedlite/content/
&lt;/pre&gt;
&lt;p&gt;Créer un fichier duckduckgo.xml&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla nemo]# vi duckduckgo.xml
&lt;/pre&gt;
&lt;p&gt;Coller le contenu de ce fichier :
&lt;a class="reference external" href="http://blog.devarieux.net/wp-content/uploads/2015/08/duckduckgo.xml"&gt;duckduckgo.xml&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ou plus simplement&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;Jolla content]# curl &amp;nbsp;http://blog.devarieux.net/wp-content/uploads/2015/08/duckduckgo.xml -o duckduckgo.xml
&lt;/pre&gt;
&lt;p&gt;Il ne reste plus qu'à fermer se rendre sur le téléphone, fermer
l'application 'Réglages', la relancer, se rendre dans 'Application' &amp;gt;
'Navigateur' et choisir le moteur de recherche Duckduckgo.&lt;/p&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/20150820220621.jpg"&gt;&lt;img alt="20150820220621" src="/images/20150820220621-169x300.jpg" /&gt;&lt;/a&gt;&lt;/p&gt;
</content><category term="Tech"></category></entry><entry><title>Prise en main de GNS3 pour la simulation réseau</title><link href="https://blog.devarieux.net/2015/08/prise-en-main-de-gns3-pour-la-simulation-reseau.html" rel="alternate"></link><published>2015-08-19T21:57:00+02:00</published><updated>2015-08-19T21:57:00+02:00</updated><author><name>aldevar</name></author><id>tag:blog.devarieux.net,2015-08-19:/2015/08/prise-en-main-de-gns3-pour-la-simulation-reseau.html</id><summary type="html">&lt;p&gt;Comme moi, vous connaissez peut être l'utilitaire &lt;a class="reference external" href="https://www.netacad.com/about-networking-academy/packet-tracer"&gt;Packet Tracer de
Cisco&lt;/a&gt;
qui permet de simuler un réseau Cisco et d'y faire quelques exercices.
C'est un très bon outil pour les étudiants mais relativement peu
exploitable en entreprise car il ne simule que du Cisco et ne sais pas
simuler autre …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Comme moi, vous connaissez peut être l'utilitaire &lt;a class="reference external" href="https://www.netacad.com/about-networking-academy/packet-tracer"&gt;Packet Tracer de
Cisco&lt;/a&gt;
qui permet de simuler un réseau Cisco et d'y faire quelques exercices.
C'est un très bon outil pour les étudiants mais relativement peu
exploitable en entreprise car il ne simule que du Cisco et ne sais pas
simuler autre chose que des hôtes très basiques. Impossible d'y simuler
un serveur pfsense par exemple.&lt;/p&gt;
&lt;p&gt;J'ai récemment fait la découverte de GNS3 qui est un logiciel assez
similaire mais vous vous en doutez bien plus complet et qui possède la
capacité de simuler un réseau de production. Vous pouvez créer des
projets avec switchs et routeurs mais également ajouter des VMs que vous
aurez pris le soin de créer avec VirtualBox ou Qemu. Wireshark est
intégré afin de capturer des paquets réseau comme on le souhaite.&lt;/p&gt;
&lt;p&gt;GNS3 a vu le jour suite à l'apparition de Dynamips, un émulateur de l'OS
de Cisco : IOS (à ne pas confondre avec l'iOS d'Apple). Dynamips est un
outil qui se manipule en ligne de commande et qui demande un solide
bagage technique. GNS3 a alors été développé pour faciliter cette
configuration et apporter beaucoup d'autres fonctionnalités qui ne sont
pas présentes dans Dynamips comme par exemple le support de Cisco PIX et
ASA, ainsi que de Juniper avec JunOS.&lt;/p&gt;
&lt;p&gt;Avant de commencer, il faut noter que la seule façon de simuler un vrai
environnement IOS est de posséder une image d'IOS. Dynamips et GNS3 ne
contiennent pas ces images pour d'évidents problèmes de droits, tout
comme VirtualBox ne vous propose pas d'image Windows. Il y a plusieurs
façon légales de se procurer ces images (par exemple si vous possédez un
switch ou un routeur Cisco) et d'autres moins légales (trouvable
facilement).&lt;/p&gt;
&lt;p&gt;Pour récupérer la dernière version de GNS3 (v1.3.9 aujourd'hui), vous
devez vous inscrire &lt;a class="reference external" href="http://www.gns3.com/"&gt;sur leur site&lt;/a&gt; et
télécharger le paquet qu'il vous faut. L'appli est multiplateforme,
compatible Windows, Linux et Mac. L'installeur va installer pour vous
tous les outils nécessaire pour la virtualisation et la capture de
paquets.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_30_55-GNS3-1.3.9-Setup.png"&gt;&lt;img alt="2015-08-17 23_30_55-GNS3 1.3.9 Setup" src="images/2015-08-17-23_30_55-GNS3-1.3.9-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Sous Windows, l'installation
est assez classique. Après avoir lancé l'installeur, la fenêtre de setup
apparaît, il suffit alors de suivre les indications jusqu'à arriver à
cette fenêtre :&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_33_08-GNS3-1.3.9-Setup.png"&gt;&lt;img alt="2015-08-17 23_33_08-GNS3 1.3.9 Setup" src="images/2015-08-17-23_33_08-GNS3-1.3.9-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Il est préférable de laisser
tout cocher, ainsi si des logiciels ont besoin de mise à jour, elles
seront faites. En cliquant sur Next, l'installeur va lancer
l'installation de winPcap&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_33_29-WinPcap-4.1.3-Setup.png"&gt;&lt;img alt="2015-08-17 23_33_29-WinPcap 4.1.3 Setup" src="images/2015-08-17-23_33_29-WinPcap-4.1.3-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_33_42-WinPcap-4.1.3-Setup.png"&gt;&lt;img alt="2015-08-17 23_33_42-WinPcap 4.1.3 Setup" src="images/2015-08-17-23_33_42-WinPcap-4.1.3-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;On laisse cocher le lancement automatique du driver au démarrage.&lt;/p&gt;
&lt;p&gt;Ensuite, l'installeur télécharge et installe Wireshark&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_33_59-GNS3-1.3.9-Setup.png"&gt;&lt;img alt="2015-08-17 23_33_59-GNS3 1.3.9 Setup" src="images/2015-08-17-23_33_59-GNS3-1.3.9-Setup-300x233.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-17-23_34_14-Wireshark-1.12.4-64-bit-Setup.png"&gt;&lt;img alt="2015-08-17 23_34_14-Wireshark 1.12.4 (64-bit) Setup" src="images/2015-08-17-23_34_14-Wireshark-1.12.4-64-bit-Setup-300x233.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-17-23_34_39-Wireshark-1.12.4-64-bit-Setup.png"&gt;&lt;img alt="2015-08-17 23_34_39-Wireshark 1.12.4 (64-bit) Setup" src="images/2015-08-17-23_34_39-Wireshark-1.12.4-64-bit-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;WinPcap est déjà installé donc on décoche l'option
&lt;a class="reference external" href="images/2015-08-17-23_34_56-Wireshark-1.12.4-64-bit-Setup.png"&gt;&lt;img alt="2015-08-1723_34_56-Wireshark 1.12.4 (64-bit) Setup" src="images/2015-08-17-23_34_56-Wireshark-1.12.4-64-bit-Setup-300x233.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-17-23_35_47-Wireshark-1.12.4-64-bit-Setup.png"&gt;&lt;img alt="2015-08-17 23_35_47-Wireshark 1.12.4 (64-bit) Setup" src="images/2015-08-17-23_35_47-Wireshark-1.12.4-64-bit-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;On décoche 'Run Wireshark',
on ne va pas en avoir besoin tout de suite.&lt;/p&gt;
&lt;p&gt;L'installation se poursuit avec cette fois SolarWinds Response Time
Viewer qui est une application d'analyse de capture Wireshark&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_37_13-SolarWinds-Registration.png"&gt;&lt;img alt="2015-08-17 23_37_13-SolarWinds Registration" src="images/2015-08-17-23_37_13-SolarWinds-Registration-300x168.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ici, vous pouvez mettre ce que vous voulez, l'adresse n'est pas vérifiée&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_38_54-SolarWinds-Response-Time-Viewer-for-Windows.png"&gt;&lt;img alt="2015-08-17 23_38_54-SolarWinds Response Time Viewer for Windows" src="images/2015-08-17-23_38_54-SolarWinds-Response-Time-Viewer-for-Windows-300x213.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;L'application se lance automatiquement. Je vous invite à en
faire un tour rapide avant de la fermer&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="images/2015-08-17-23_40_09-GNS3-1.3.9-Setup.png"&gt;&lt;img alt="2015-08-17 23_40_09-GNS3 1.3.9 Setup" src="images/2015-08-17-23_40_09-GNS3-1.3.9-Setup-300x233.png" /&gt;&lt;/a&gt; &lt;a class="reference external" href="images/2015-08-17-23_40_30-GNS3-1.3.9-Setup.png"&gt;&lt;img alt="2015-08-17 23_40_30-GNS3 1.3.9 Setup" src="images/2015-08-17-23_40_30-GNS3-1.3.9-Setup-300x233.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SolarWinds vous propose une licence gratuite pour son
software. Je n'ai pas testé comment acquérir cette licence et je ne sais
pas sous quelle condition elle s'acquière.&lt;/p&gt;
&lt;p&gt;Voilà pour la description et l'installation de GNS3. La prochaine fois,
on verra comment le configurer et y créer de nouveau routeur, switchs et
VM.&lt;/p&gt;
</content><category term="Réseaux"></category></entry><entry><title>Vmware tools, Centos 7 et customisation</title><link href="https://blog.devarieux.net/2015/08/vmware-tools-centos-7-et-customisation.html" rel="alternate"></link><published>2015-08-14T22:39:00+02:00</published><updated>2015-08-14T22:39:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-08-14:/2015/08/vmware-tools-centos-7-et-customisation.html</id><summary type="html">&lt;p&gt;Depuis quelques temps, lorsqu'on souhaite déployer les VMware tools dans
une VM Centos 7 / RedHat 7, le script d'installation hurle de ne pas
utiliser le script perl fournit mais de passer plutôt par les
open-vm-tools qu'on peut directement trouvé dans le gestionnaire de
paquet.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
yum install open-vm-tools
&lt;/pre&gt;
&lt;p&gt;C'est simple, rapide …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Depuis quelques temps, lorsqu'on souhaite déployer les VMware tools dans
une VM Centos 7 / RedHat 7, le script d'installation hurle de ne pas
utiliser le script perl fournit mais de passer plutôt par les
open-vm-tools qu'on peut directement trouvé dans le gestionnaire de
paquet.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
yum install open-vm-tools
&lt;/pre&gt;
&lt;p&gt;C'est simple, rapide, ça facilite les mise à jour des tools et c'est
conseillé par VMware directement, il y a même &lt;a class="reference external" href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;amp;cmd=displayKC&amp;amp;externalId=2073803"&gt;un
KB&lt;/a&gt;
pour ça et &lt;a class="reference external" href="https://github.com/vmware/open-vm-tools"&gt;un projet
GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Pour rappel, l'insallation des vm-tools permet d'accéder à ces
fonctionnalité vSphere :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Synchronisation de l'horloge de l'OS invité avec celle de la
plateforme de virtualisation&lt;/li&gt;
&lt;li&gt;Permet à l'hyperviseur de procéder à des appels système afin par
exemple de demander à l'OS de s'arréter.&lt;/li&gt;
&lt;li&gt;Support de vSphere High Availability (HA) grace à un système de
heartbeat.&lt;/li&gt;
&lt;li&gt;Permet à l'hyperviseur de récolter des informations sur la
consommation des ressources CPU, RAM, réseau.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dans cette liste, il manque tout de même un outil important. Si vous
clonez ou si vous créez un template à partir d'une VM ayant les
open-vm-tools, vous serez dans l'incapacité de customiser la nouvelle VM
à sa création. Exit donc le changement du mot de passe root et surtout
la configuration réseau. Cette fonctionnalité est apportée par un plugin
pour open-vm-tools nommé DeployPkg.&lt;/p&gt;
&lt;p&gt;La page &lt;a class="reference external" href="http://partnerweb.vmware.com/GOSIG/RHEL_7.html"&gt;Red Hat Enterprise Linux 7 Guest Operating System Installation
Guide&lt;/a&gt; mentionne bien
ce plugin mais il y manque certaines informations. La procédure complète
est mieux décrite dans la &lt;a class="reference external" href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;amp;cmd=displayKC&amp;amp;externalId=2075048"&gt;Knowledge Base de
VMware.&lt;/a&gt;Celle
ci consiste a récupérer les clés public du dépots VMware, importer les
clés, créer le fichier de repo pour yum et procéder enfin à
l'installation.&lt;/p&gt;
&lt;p&gt;Dans un premier temps, on récupère les clés ici
&lt;a class="reference external" href="http://packages.vmware.com/tools/keys"&gt;http://packages.vmware.com/tools/keys&lt;/a&gt; et on les place dans le répertoire
/tmp du serveur&lt;/p&gt;
&lt;p&gt;On importe les clés avec rpm&lt;/p&gt;
&lt;pre class="literal-block"&gt;
rpm --import /tmp/key1
rpm --import /tmp/key2
&lt;/pre&gt;
&lt;p&gt;Création du fichier &lt;em&gt;/etc/yum.repos.d/vmware-tools.repo&lt;/em&gt; avec ce contenu
:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[vmware-tools]
name = VMware Tools
baseurl = http://packages.vmware.com/packages/rhel7/x86_64/
enabled = 1
gpgcheck = 1
&lt;/pre&gt;
&lt;p&gt;Installation du paquet&lt;/p&gt;
&lt;pre class="literal-block"&gt;
yum install open-vm-tools-deploypkg
&lt;/pre&gt;
&lt;p&gt;Installation de perl, nécessaire pour les scripts de customisation&lt;/p&gt;
&lt;pre class="literal-block"&gt;
yum install perl
&lt;/pre&gt;
&lt;p&gt;On termine par le rechargement du service pour prendre en compte
l'installation du plugin&lt;/p&gt;
&lt;pre class="literal-block"&gt;
systemctl restart vmtoolsd
&lt;/pre&gt;
&lt;p&gt;Vous pouvez maintenant transformer votre VM en template en toute
sérénité.&lt;/p&gt;
</content><category term="Tech"></category></entry><entry><title>Se connecter en SSH à son Jolla</title><link href="https://blog.devarieux.net/2015/03/se-connecter-en-ssh-a-son-jolla.html" rel="alternate"></link><published>2015-03-03T23:19:00+01:00</published><updated>2015-03-03T23:19:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-03-03:/2015/03/se-connecter-en-ssh-a-son-jolla.html</id><summary type="html">&lt;p&gt;Même s'il est possible d'utiliser directement une console sur l'appareil
grâce à FingerPrint quand on est en mode developpeur, il est quand même
plus simple d'utiliser son PC pour entrer quelques commandes où même
pour écrire des scripts. Voici donc comment activer la connexion SSH sur
son Jolla.&lt;/p&gt;
&lt;p&gt;1- Activer …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Même s'il est possible d'utiliser directement une console sur l'appareil
grâce à FingerPrint quand on est en mode developpeur, il est quand même
plus simple d'utiliser son PC pour entrer quelques commandes où même
pour écrire des scripts. Voici donc comment activer la connexion SSH sur
son Jolla.&lt;/p&gt;
&lt;p&gt;1- Activer le mode developpeur&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/20150303211811.jpg"&gt;&lt;img alt="20150303211811" src="/images/20150303211811-169x300.jpg" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2- Activer la connexion distante et définir un mot de passe&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/20150303211957.jpg"&gt;&lt;img alt="20150303211957" src="/images/20150303211957-169x300.jpg" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;3- Se connecter depuis son PC avec l'utilisateur nemo. Pour passer en
root, taper simplement 'su' avec le même mot de passe.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/sshJolla.png"&gt;&lt;img alt="sshJolla" src="/images/sshJolla.png" /&gt;&lt;/a&gt;&lt;/p&gt;
</content><category term="Tech"></category></entry><entry><title>Jolla victime de son succès</title><link href="https://blog.devarieux.net/2015/02/jolla-victime-de-son-succes.html" rel="alternate"></link><published>2015-02-24T10:47:00+01:00</published><updated>2015-02-24T10:47:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-02-24:/2015/02/jolla-victime-de-son-succes.html</id><summary type="html">&lt;p&gt;Comme je le disais dans le dernier &lt;a class="reference external" href="http://blog.devarieux.net/2015/02/prise-en-main-du-smartphone-de-jolla/"&gt;article sur le
Jolla&lt;/a&gt;,
je devais recevoir avec mon colis 2 coques supplémentaires mais celles
ci étaient absentes.&lt;/p&gt;
&lt;p&gt;J'ai donc envoyé un mail au support Jolla pour savoir ce qu'il en était.
Ils m'ont informé qu'ils ne pourraient pas honorer leur commande. Voici …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Comme je le disais dans le dernier &lt;a class="reference external" href="http://blog.devarieux.net/2015/02/prise-en-main-du-smartphone-de-jolla/"&gt;article sur le
Jolla&lt;/a&gt;,
je devais recevoir avec mon colis 2 coques supplémentaires mais celles
ci étaient absentes.&lt;/p&gt;
&lt;p&gt;J'ai donc envoyé un mail au support Jolla pour savoir ce qu'il en était.
Ils m'ont informé qu'ils ne pourraient pas honorer leur commande. Voici
leur réponse :&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;thank you for your message and for your recent order at the Jolla
Online Shop.&lt;/p&gt;
&lt;p&gt;However, the bad news is that we were not able to dispatch the Lime
and Nadeshiko Pink The Other Half that your order contained. We were
unprepared for the level of interest that the Jolla Bundle received
and unfortunately we were not able to meet the demand in full.
Currently we can't estimate when the Lime and Nadeshiko Pink The
Other Half will be available again, and we don't want to keep you
waiting for your order any longer.&lt;/p&gt;
&lt;p&gt;We are really sorry for letting you down. To make up for the absence
of Lime and Nadeshiko Pink The Other Half, we’re putting together an
exclusive Jolla branded merchandise pack for you. It will be shipped
to you in the coming days.&lt;/p&gt;
&lt;p&gt;Even without the extra accessories, we sincerely hope that you will
love your new Jolla smartphone!&lt;/p&gt;
&lt;p&gt;Have a great day!&lt;/p&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;Sincerely,&lt;/div&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;Jolla Customer Care&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pour moi, la phrase clé est &amp;quot;&lt;em&gt;We were unprepared for the level of
interest that the Jolla Bundle received and unfortunately we were not
able to meet the demand in full&amp;quot;.&lt;/em&gt;C'est en fait une bonne nouvelle.
L'augmentation du parc de smartphone Jolla est une condition&lt;em&gt;sine qua
non&lt;/em&gt; pour que le nombre d'application du store augmente ,ce qui décidera
plus de personne à l'acheter, ce qui augmentera le nombre d'application
etc.&lt;/p&gt;
&lt;p&gt;Pour s'excuser de cette impossibilité d'honorer la commande, ils
m'annoncent également qu'ils sont en train de me préparer un &lt;em&gt;Jolla
branded merchandise pack&lt;/em&gt;. En gros, des goodies. Pourquoi pas, y'a peut
être des trucs sympa et ça m'aidera à faire leur promo. Ceci me laisse
un tout petit peu sur ma faim tout de même. Je leur ai donc demandé s'il
leur était possible de me donner un code promo pour l'achat d'une &lt;a class="reference external" href="/http://shop.jolla.com/eu_en/cat-the-other-half/the-other-half-aloe.html"&gt;coque
Aloe&lt;/a&gt;.
Et voici leur réponse :&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;thank you for your message.&lt;/p&gt;
&lt;p&gt;We will make sure to send you an Aloe Other Half.&lt;/p&gt;
&lt;p&gt;Have a great day!&lt;/p&gt;
&lt;p&gt;Sincerely,
Jolla Customer Care&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Je devrais donc recevoir une coque Aloe à la place.&lt;/p&gt;
&lt;p&gt;La dessus, on peut dire que service consommateur de Jolla fait bien son
taf. C'est pas pour rien que l'adresse email du support est
&lt;a class="reference external" href="mailto:'care&amp;#64;jolla"&gt;'care&amp;#64;jolla&lt;/a&gt;....'&lt;/p&gt;
</content><category term="MyLife"></category></entry><entry><title>Prise en main du smartphone de Jolla</title><link href="https://blog.devarieux.net/2015/02/prise-en-main-du-smartphone-de-jolla.html" rel="alternate"></link><published>2015-02-21T00:29:00+01:00</published><updated>2015-02-21T00:29:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-02-21:/2015/02/prise-en-main-du-smartphone-de-jolla.html</id><summary type="html">&lt;p&gt;Il est enfin arrivé, après plus de 2 semaines d'attente pour cause de
rupture de stock. Malheureusement le colis est incomplet puisqu'il
manque 2 des 3 'Other Half' (les coques arrières). J'ai envoyé un mail à
Jolla pour savoir où était ses 2 pièces manquantes.&lt;/p&gt;
&lt;p&gt;Une fois cette légère déception …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Il est enfin arrivé, après plus de 2 semaines d'attente pour cause de
rupture de stock. Malheureusement le colis est incomplet puisqu'il
manque 2 des 3 'Other Half' (les coques arrières). J'ai envoyé un mail à
Jolla pour savoir où était ses 2 pièces manquantes.&lt;/p&gt;
&lt;p&gt;Une fois cette légère déception passée, j'ai observé l'emballage d'un
peu plus prêt. La boite est sympa, sobre. Le logo Jolla est écrit en
argenté et entouré de lignes de code&lt;/p&gt;
&lt;p&gt;[gallery columns=&amp;quot;2&amp;quot; ids=&amp;quot;417,418,422,424&amp;quot;]&lt;/p&gt;
&lt;p&gt;Le contenu est très basique : le smartphone, la batterie, un câble
USB/micro USB et un bloc alim secteur sur lequel on peut branche le
câble USB. Pas de pair d'écouteur, on a juste le strict minimum. Notons
tout de même la présence de 2 stickers au nom de la firme.&lt;/p&gt;
&lt;p&gt;Au premier démarrage, un tuto vous explique comment utiliser cet OS basé
sur la gestuelle. En effet, que ce soit pour fermer une appli, valider
ou annuler une action, retourner sur l'écran principal ou lire un SMS,
toutes ces actions se feront par un mouvement de haut en bas, ou de
gauche à droite ou inversement, sans oublier que si le geste commence en
dehors de la surface de l'écran, cela n'aura pas le même effet que s'il
prend son départ sur la surface d'affichage. C'est donc une nouvelle
façon d’appréhender son smartphone et je doit avouer que j'étais assez
enthousiaste en testant ces nouvelles fonctions. Cette façon de faire,
très différente d'Androïd, iOS ou Windows Phone est vraiment
rafraichissante, surtout après 5 années chez Androïd.&lt;/p&gt;
&lt;p&gt;Lorsqu'un menu est disponible, une lumière vous indique que vous pouvez
tirer l'écran pour faire apparaitre ce menu. La sélection d'une entrée
du menu se fait en tirant plus ou moins.&lt;/p&gt;
&lt;p&gt;[gallery ids=&amp;quot;431,427,426&amp;quot;]&lt;/p&gt;
&lt;p&gt;Lorsqu'on ferme une application en swipant de droite à gauche (pour la
fermer réellement, c'est de haut en bas), celle ci se 'range' sur la
page principale et reste tourner en tache de fond. SailfishOS est
multitâche. Les applications qui ne sont pas fermées continues de se
mettre à jour et ne sont pas gelées comme cela peut être le cas sur les
autres plateforme. Vous pouvez avoir jusqu'à 9 applications en parallèle&lt;/p&gt;
&lt;p&gt;[gallery ids=&amp;quot;428,429,430&amp;quot;]&lt;/p&gt;
&lt;p&gt;Au premier démarrage, SailfishOS vous propose de connecter vos comptes
Google, Facebook et Twitter. Il regroupera ensuite toutes les
notifications au même endroit, que vous pourrez retrouver en swipant du
bas vers le haut. On peut ensuite facilement ajouter un compte email, un
compte xmpp (intégré sans appli à installer) et sont même présent les
connecteurs CalDAV et CardDAV que j'ai pu brancher sur mon instance
zimbra.&lt;/p&gt;
&lt;p&gt;Mais que manque-t-il à ce smartphone en fait? Premièrement, le store
n'est pas très fourni. Il est cependant possible d'installer des
applications Android en installant quelques market. Je n'ai pas encore
testé cette fonctionnalité.&lt;/p&gt;
&lt;p&gt;L'écran n'offre pas une très bonne définition, ainsi que la camera 8Mp.
Les photos sont de piètre qualité par rapport à ce dont on est habitué.
L'appareil photo à même tendance à prendre les photos après vous avoir
annoncé que la photo à été prise, ce qui peut avoir tendance à faire des
photos floues.&lt;/p&gt;
&lt;p&gt;Ce n'est pas un foudre de guerre, si vous voulez jouer, passez votre
chemin. Par contre, l'OS est très fluide dans son utilisation.&lt;/p&gt;
&lt;p&gt;Je suis sûr qu'il a plein d'autres défauts que je trouverai lors de son
utilisation quotidienne. Ceci dit, l'OS me semble simple à appréhender.
Le système lumineux indiquant les actions possibles est très bien pensé
et fait bien son boulot de guide.&lt;/p&gt;
</content><category term="Tech"></category><category term="jolla"></category><category term="sailfishos"></category></entry><entry><title>Jolla - Le Smartphone Linux</title><link href="https://blog.devarieux.net/2015/02/jolla-le-smartphone-linux.html" rel="alternate"></link><published>2015-02-07T18:01:00+01:00</published><updated>2015-02-07T18:01:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-02-07:/2015/02/jolla-le-smartphone-linux.html</id><summary type="html">&lt;div class="section" id="flash-back"&gt;
&lt;h2&gt;Flash Back&lt;/h2&gt;
&lt;p&gt;En Juin 2013, je me demandais comment j'allais &lt;a class="reference external" href="http://blog.devarieux.net/2013/06/comment-vais-je-me-passer-des-services-de-google/"&gt;me passer des services
de
Google&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Depuis, pas mal de choses ont évolué. J'ai un serveur sur lequel je
stock mon agenda, mes contacts, mes emails avec Zimbra. J'utilise
&lt;a class="reference external" href="http://pyd.io"&gt;Pydio&lt;/a&gt; pour le cloud. Mon compte gmail est conservé
pour des …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="section" id="flash-back"&gt;
&lt;h2&gt;Flash Back&lt;/h2&gt;
&lt;p&gt;En Juin 2013, je me demandais comment j'allais &lt;a class="reference external" href="http://blog.devarieux.net/2013/06/comment-vais-je-me-passer-des-services-de-google/"&gt;me passer des services
de
Google&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Depuis, pas mal de choses ont évolué. J'ai un serveur sur lequel je
stock mon agenda, mes contacts, mes emails avec Zimbra. J'utilise
&lt;a class="reference external" href="http://pyd.io"&gt;Pydio&lt;/a&gt; pour le cloud. Mon compte gmail est conservé
pour des raisons historique, même si de moins en moins de personnes de
mon entourage l'utilise. Ce compte Google est également celui que
j'utilise sur mon smartphone Android.&lt;/p&gt;
&lt;p&gt;En gros, Android est le dernier lien solide qui m'attache à Google. Ce
lien va bientôt sauter. Je viens en effet de commander le smartphone de
Jolla sous Sailfish OS. En gros, du full Linux, sans la sous couche Java
incluse dans Android.&lt;/p&gt;
&lt;p&gt;L'entreprise Jolla qui fabrique les smartphones du même nom a été créée
par des anciens cadres et ingénieurs de chez Nokia et Sailfish OS
reprend les bases de MeeGo, l'OS du Nokia N9, basé sur Qt. Une couche de
compatibilité est ajoutée pour pouvoir faire fonctionner plus ou moins
bien les applis Android.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-est-ce-que-je-me-suis-decide-a-faire-cet-achat"&gt;
&lt;h2&gt;Comment est ce que je me suis décidé à faire cet achat?&lt;/h2&gt;
&lt;p&gt;Cela faisait un moment que je souhaitais changer mon Nexus 4. Il
fonctionne encore très bien, Madame en héritera. J'attendais avec
impatience la sortie du Nexus 6 mais la politique tarifaire sur ce
modèle m'a fait renoncer à cet achat. Il est hors de question que je
mette plus de 300/350€ dans un smartphone.&lt;/p&gt;
&lt;p&gt;Et puis il y a 10 jours un amis m'a montré son Jolla, m'a expliqué le
fonctionnement, la gestion du multi tâches, comment on passe d'une appli
à l'autre etc.. Et enfin le prix : 250€. Alléchant... Le lendemain, je
me baladais sur le site de Jolla et étais à 2 doigts de faire chauffer
la CB quand je me suis dit que ce n'était peut être pas le moment de
faire ce genre de dépense. Le jeudi suivant, je tombe sur une nouvelle
offre : &lt;a class="reference external" href="http://jollafr.org/code-promo-le-jolla-pour-200e-fosdem2015/"&gt;Code promo, le Jolla pour 200€ !
#FOSDEM2015&lt;/a&gt;.
Et voilà comment je me suis retrouvé à commander la bête sur le &lt;a class="reference external" href="http://shop.jolla.com/eu_en/"&gt;shop de
Jolla.&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="et-maintenant"&gt;
&lt;h2&gt;Et Maintenant&lt;/h2&gt;
&lt;p&gt;Alors évidemment, ne rêvons pas trop, tout ne sera pas rose. Je suppose
qu'il va y avoir des bugs, que je vais perdre en confort mais comme le
dit si bien l'ami qui m'a montré son Jolla la première fois, c'est aussi
un achat engagé.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/jolla-launch-2.jpg"&gt;&lt;img alt="jolla-launch-2" src="/images/jolla-launch-2-300x226.jpg" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;J'attends maintenant impatiemment de recevoir mon colis.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="google"></category><category term="jolla"></category><category term="Linux"></category></entry><entry><title>Trop de requêtes ARP - Régler le timeout de la table ARP</title><link href="https://blog.devarieux.net/2015/01/trop-de-requetes-arp-regler-le-timeout-de-la-table-arp.html" rel="alternate"></link><published>2015-01-21T20:18:00+01:00</published><updated>2015-01-21T20:18:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2015-01-21:/2015/01/trop-de-requetes-arp-regler-le-timeout-de-la-table-arp.html</id><summary type="html">&lt;p&gt;Pour des besoins spécifiques, nous avons fait l'acquisition d'un serveur
chez SoYouStart.&lt;/p&gt;
&lt;p&gt;Le serveur étant assez puissant, nous avons décidé d'y installer un
hyperviseur Proxmox qui hébergera des VM CentOS&lt;/p&gt;
&lt;p&gt;Avant de mettre en place les applications dont j'ai besoin sur ce
serveur, je l'ai installé et laissé tourner quelques …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Pour des besoins spécifiques, nous avons fait l'acquisition d'un serveur
chez SoYouStart.&lt;/p&gt;
&lt;p&gt;Le serveur étant assez puissant, nous avons décidé d'y installer un
hyperviseur Proxmox qui hébergera des VM CentOS&lt;/p&gt;
&lt;p&gt;Avant de mettre en place les applications dont j'ai besoin sur ce
serveur, je l'ai installé et laissé tourner quelques temps pour
m'assurer de sa stabilité. Et le premier dimanche suivant l'installe,
voici le mail que je reçois, venant d'un bot de chez OVH et concernant
une des VM :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Bonjour,

Nous avons constaté que votre serveur diffuse inutilement un nombre important de requêtes sur le
réseau via son IP failover XX.XX.XX.XX, ceci est dû à une mauvaise configuration de celle-ci.
Nous vous avons demandé dans un mail précédant de bien vouloir reconfigurer votre IP failover,
constatant que le problème persiste, nous nous permettons de réitérer cette demande.
Si le problème n'est pas résolu dans un délais de 24 heures, nous nous verrons dans l'obligation de
bloquer votre IP.

Dans ce cas, il vous sera possible de la débloquer dans votre manager une fois la reconfiguration
faite.

Ceci est le dernier avertissement avant le blocage de votre IP !
-------  EXTRAIT DES REQUETES  -------

Thu Jan 8 06:47:25 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX
Thu Jan 8 06:47:55 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX
Thu Jan 8 06:48:25 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX
Thu Jan 8 06:48:55 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX
Thu Jan 8 06:49:25 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX
Thu Jan 8 06:49:55 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX
Thu Jan 8 06:50:25 2015 : arp who-has IP.DE.LA.GW tell XX.XX.XX.XX

-------   FIN DE L'EXTRAIT   -------
&lt;/pre&gt;
&lt;p&gt;Une requête toutes les 30 secondes, c'est en effet beaucoup.&lt;/p&gt;
&lt;p&gt;J'ai longtemps cherché d'où pouvait venir le problème. J'ai commencer
par changer de modèle de carte réseau dans Proxmox (E1000, VirtIO,
Vmxnet3) sans succès. J'ai reconfiguré et rereconfiguré le réseau en
ajoutant ou retirant des options dans le fichier ifcfg-eth0, rien à
faire, toujours autant de requêtes ARP.&lt;/p&gt;
&lt;p&gt;En faisant tout ça, je me rendais bien compte d'une aberration dans&amp;nbsp;les
opérations que je mettais en œuvre : je travaillais sur du niveau 3 (IP)
alors que j'avais un problème qui se situait entre la couche 2 et la
couche 3 (ARP).&lt;/p&gt;
&lt;p&gt;Après moult recherches, j'ai fini par trouver où étaient les fichiers
qui pourraient m'aider.&lt;/p&gt;
&lt;p&gt;Voici les fichiers concernés, avec leurs valeurs par défaut.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
/proc/sys/net/ipv4/neigh/default/anycast_delay:100
/proc/sys/net/ipv4/neigh/default/app_solicit:0
/proc/sys/net/ipv4/neigh/default/base_reachable_time:30
/proc/sys/net/ipv4/neigh/default/base_reachable_time_ms:1200
/proc/sys/net/ipv4/neigh/default/delay_first_probe_time:5
/proc/sys/net/ipv4/neigh/default/gc_interval:30
/proc/sys/net/ipv4/neigh/default/gc_stale_time:60
/proc/sys/net/ipv4/neigh/default/gc_thresh1:128
/proc/sys/net/ipv4/neigh/default/gc_thresh2:512
/proc/sys/net/ipv4/neigh/default/gc_thresh3:1024
/proc/sys/net/ipv4/neigh/default/locktime:100
/proc/sys/net/ipv4/neigh/default/mcast_solicit:3
/proc/sys/net/ipv4/neigh/default/proxy_delay:80
/proc/sys/net/ipv4/neigh/default/proxy_qlen:64
/proc/sys/net/ipv4/neigh/default/retrans_time:100
/proc/sys/net/ipv4/neigh/default/ucast_solicit:3
/proc/sys/net/ipv4/neigh/default/unres_qlen:3
&lt;/pre&gt;
&lt;p&gt;Ici, les fichiers qui nous intéressent sont base_reachable_time (ou
base_reachable_time_ms) et gc_stale_time.&lt;/p&gt;
&lt;p&gt;Le fichier gc_stale_time définit la&amp;nbsp;fréquence à laquelle l'état
'stale' (obsolète) des entrées de la table ARP sera vérifié. Le défaut
est à 60 secondes. Le fichier base_reachable_time quant à lui définit
la durée durant laquelle une entrée de la table ARP est considérée
valide. La durée de validité de cette entrée sera un chiffre choisi au
hasard entre (base_reachable_time/2) et (3*base_reachable_time/2).
La valeur par défaut est de 30 secondes.&lt;/p&gt;
&lt;p&gt;Un simple echo du chiffre souhaité dans le fichier suffit. CentOS permet
d'avoir ces valeurs en dure et persistante après un redémarrage (les
autres distributions aussi sans doute, mais je ne sais par quel moyen).&lt;/p&gt;
&lt;p&gt;Pour CentOS donc, dans le fichier /etc/sysctl.conf, ajouter ces lignes :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
##### Pour limiter le nombre de requête ARP ##########
##### Equivalent a 30 minutes ###########
net.ipv4.neigh.default.base_reachable_time_ms = 1200000
net.ipv4.neigh.default.gc_stale_time = 3600
&lt;/pre&gt;
&lt;p&gt;Ces valeurs vont donner une durée de validité des entrées de la table
ARP entre 15 et 45 minutes.&lt;/p&gt;
</content><category term="Tech"></category><category term="arp"></category><category term="kernel"></category><category term="Linux"></category><category term="osi"></category><category term="requête"></category><category term="table"></category></entry><entry><title>Playskool présente: Numéricable concurrence Netflix</title><link href="https://blog.devarieux.net/2014/09/numericable-concurrence-netflix.html" rel="alternate"></link><published>2014-09-16T11:02:00+02:00</published><updated>2014-09-16T11:02:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2014-09-16:/2014/09/numericable-concurrence-netflix.html</id><summary type="html">&lt;p&gt;Sous ce titre un peu taquin se cache une grande frustration. Nous avons
tous plus ou moins l'habitude que nos différents fournisseurs tentent de
nous la mettre bien profond avec différents services inutiles et mal
conçus.&lt;/p&gt;
&lt;p&gt;Hier, Lundi 15 Septembre, nous avons atteint, je crois, le zenith du
foutage de …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Sous ce titre un peu taquin se cache une grande frustration. Nous avons
tous plus ou moins l'habitude que nos différents fournisseurs tentent de
nous la mettre bien profond avec différents services inutiles et mal
conçus.&lt;/p&gt;
&lt;p&gt;Hier, Lundi 15 Septembre, nous avons atteint, je crois, le zenith du
foutage de gueule, le paroxysme de la sodomie, les&lt;a class="reference external" href="http://lesabyssales.fr/"&gt;profondeurs
abyssales&lt;/a&gt; de mon trou du cul. Et j'ai beau
ajouté du beurre, ça passe toujours pas. Vous l'avez compris, je suis
colère, &lt;a class="reference external" href="https://www.youtube.com/watch?v=n4IEaJo43tc"&gt;je suis violence parce que je suis
trahison&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Bien... Maintenant que vous avez compris comment je me sens je vais vous
dire ce qui me met dans cet état. Hier donc, Numéricable a lancé son
service pour concurrencer Netflix : LaBox Series. &lt;a class="reference external" href="http://blog.devarieux.net/wp-content/uploads/2014/09/CP_Numericable_LaBox-Series.pdf"&gt;Le communiqué de
presse&lt;/a&gt;&amp;nbsp;est
limpide : &amp;quot;Un accès SIMPLE et GRATUIT à 3000 épisodes de séries par mois
pour les abonnés LaBox Fibre&amp;quot;. Parfait me dis-je, je suis abonné à LaBox
Fibre avec une offre Power, même si le catalogue n'est sans doute pas
encore énorme, ça semble être un bon début, surtout si &lt;a class="reference external" href="http://www.zdnet.fr/actualites/netflix-en-france-ce-sera-sans-numericable-qui-riposte-avec-labox-series-39806307.htm"&gt;Numéricable
refuse de
développer&lt;/a&gt;
une interface Netflix pour LaBox. Tout guilleret, je rentre donc chez
moi hier soir et je me lance dans l'exploration du service en question.&lt;/p&gt;
&lt;p&gt;Je commence par regarder le catalogue. Mouais, beaucoup de manga assez
ancien, des séries moyennement intéressantes et surtout peu d'épisodes
par série. Vous ne trouverez pas de saison 1, sauf s'il n'y qu'une seule
saison et certaines saisons sont incomplètes. Je commence à ronger mon
frein mais je suis bonne pâte et je leur trouve quelques excuses : c'est
le premier jour de lancement, ça a été fait dans la précipitation pour
contrer Netflix, ça va s'étoffer.&lt;/p&gt;
&lt;p&gt;Une fois que j'ai fait le tour du pauvre catalogue (Ha si, y'a chapi
chapo quand même), je lance l'épisode 1 de la saison 1 de&amp;nbsp;&lt;em&gt;Äkta
människor&lt;/em&gt;(la série suédoise sur la banalisation des androïdes (les
robots, pas les smartphones)) et là... STUPEUR ET TREMBLEMENT :&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ON ME DEMANDE DE PAYER!!!!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Ho, pas grand chose, 1,40€ je crois de mémoire, pour pouvoir voir
l'épisode pendant 48h, en passant par ArteVOD. WHAT THE FUCK? C'est
marqué que c'est &lt;strong&gt;GRATUIT&lt;/strong&gt; putain! Depuis quand payer à l'acte c'est
gratuit? Vous la sentez bien la sodomie là? Parce que moi j'ai encore
mal ce matin.&lt;/p&gt;
&lt;p&gt;Si j'étais un peu mesquin, je dirais que ce service est une incitation
pour que les abonnés fibre migrent vers Bouygues qui s'appuie sur le
réseau numéricable et proposera Netflix sur sa box au mois de novembre.&lt;/p&gt;
</content><category term="MyLife"></category><category term="fibre"></category><category term="nc"></category><category term="netflix"></category><category term="numericable"></category><category term="SVOD"></category><category term="VOD"></category></entry><entry><title>Accéder en webdav à son fichier Keepass</title><link href="https://blog.devarieux.net/2014/09/acceder-en-webdav-a-son-fichier-keepass.html" rel="alternate"></link><published>2014-09-05T22:54:00+02:00</published><updated>2014-09-05T22:54:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2014-09-05:/2014/09/acceder-en-webdav-a-son-fichier-keepass.html</id><summary type="html">&lt;p&gt;Keepass est un gestionnaire de mot de passe que j'utilise
personnellement et professionnellement. Il permet notamment de partager
un coffre fort entre plusieurs personne en offrant un support pour ftp
et http/webdav. Certains plugins ajoutent le support sftp et ftps.&lt;/p&gt;
&lt;p&gt;Sur CentOS, apache est livré avec le module webdav …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Keepass est un gestionnaire de mot de passe que j'utilise
personnellement et professionnellement. Il permet notamment de partager
un coffre fort entre plusieurs personne en offrant un support pour ftp
et http/webdav. Certains plugins ajoutent le support sftp et ftps.&lt;/p&gt;
&lt;p&gt;Sur CentOS, apache est livré avec le module webdav. Ce n'est pas
forcement le cas de toutes les distributions.&lt;/p&gt;
&lt;p&gt;La configuration utilisée est la suivante :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Un sous domaine créé pour contenir le fichier kdbx&lt;/li&gt;
&lt;li&gt;une protection par mot de passe pour l'accès au fichier en lui même
(anciennement .htaccess)&lt;/li&gt;
&lt;li&gt;L'autorisation d'accéder au sous domaine en webdav&lt;/li&gt;
&lt;li&gt;Et enfin, un mot de passe &lt;strong&gt;ultra solide&lt;/strong&gt; pour le fichier kdbx qui
peut contenir des données sensibles.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dans mon cas, j'ai utilisé un sous domaine du type keepass.domain.tld et
le fichier est stocké en local sur le serveur sous /var/www/keepass/&lt;/p&gt;
&lt;pre class="literal-block"&gt;
root# mkdir /var/www/keepass
root# chown apache. /var/www/keepass
root# chmod 770 /var/www/keepass
root# vim /etc/httpd/conf.d/keepass.conf
&lt;/pre&gt;
&lt;p&gt;Pour ne pas que le mot de passe passe en clair sur le net, nous allons
forcer l'utilisation de https&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;lt;VirtualHost *:80&amp;gt;
 ServerName keepass.domain.tld
 ServerAdmin admin&amp;#64;domain.tld
 Redirect permanent / https://keepass.domain.tld/
 ErrorLog /var/log/httpd/keepass.err
 CustomLog /var/log/httpd/keepass.log combined
 DocumentRoot /var/www/keepass
&amp;lt;/VirtualHost&amp;gt;
&amp;lt;VirtualHost *:443&amp;gt;
 SSLEngine on
 SSLCertificateFile /etc/pki/tls/certs/ca.crt
 SSLCertificateKeyFile /etc/pki/tls/private/ca.key
 ServerName keepass.domain.tld
 ServerAdmin admin&amp;#64;domain.tld
 ErrorLog /var/log/httpd/keepass.err
 CustomLog /var/log/httpd/keepass.log combined
 DocumentRoot /var/www/keepass
&amp;lt;Directory &amp;quot;/var/www/keepass&amp;quot;&amp;gt;
 DAV On
 SSLRequireSSL
 Options None
 AuthType Basic
 AuthName WebDAV
 AuthUserFile /etc/httpd/conf/.htpasswd
 &amp;lt;LimitExcept GET OPTIONS&amp;gt;
 Order allow,deny
 Allow from X.X.X.X #IP que vous autorisez, 'all' pour tout le monde
 Require valid-user
 &amp;lt;/LimitExcept&amp;gt;
&amp;lt;/Directory&amp;gt;
&amp;lt;/VirtualHost&amp;gt;
&lt;/pre&gt;
&lt;p&gt;Voici les étapes pour la création du fichier .htpasswd&lt;/p&gt;
&lt;pre class="literal-block"&gt;
root# htpasswd -c /etc/httpd/conf/.htpasswd NomUtilisateur
root# /etc/init.d/httpd restart
&lt;/pre&gt;
&lt;p&gt;Il ne reste plus qu'à placer le fichier kdbx dans /var/www/keepass et
donner à apache les droits en écriture sur ce fichier.&lt;/p&gt;
&lt;p&gt;Enfin, dans Keepass en ouvrant une url, le logiciel demande de fournir
l'URL et si besoin un couple login/mdp.&lt;/p&gt;
&lt;p&gt;L'URL sera de type &lt;a class="reference external" href="https://keepass.domain.tld/fichier.kdbx"&gt;https://keepass.domain.tld/fichier.kdbx&lt;/a&gt; et le couple
login/mdp est celui créé lors de l’exécution de la commande htpasswd&lt;/p&gt;
</content><category term="Tech"></category><category term="apache"></category><category term="centos"></category><category term="keepass"></category><category term="ssl"></category><category term="webdav"></category></entry><entry><title>Bash : Script de sauvegarde</title><link href="https://blog.devarieux.net/2014/07/bash-script-de-sauvegarde.html" rel="alternate"></link><published>2014-07-24T11:14:00+02:00</published><updated>2014-07-24T11:14:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2014-07-24:/2014/07/bash-script-de-sauvegarde.html</id><summary type="html">&lt;p&gt;On ne le dira jamais assez : &lt;strong&gt;FAITES DES SAUVEGARDES!!!!!&lt;/strong&gt;
Ayant un petit serveur dédié sous CentOS, j'ai évidemment appliqué
cet adage à moi même. Je vous présente donc un script duquel vous pouvez
librement vous inspirer afin de l'adapter à votre environnement.
Ce script place quelques répertoires et quelques exports …&lt;/p&gt;</summary><content type="html">&lt;p&gt;On ne le dira jamais assez : &lt;strong&gt;FAITES DES SAUVEGARDES!!!!!&lt;/strong&gt;
Ayant un petit serveur dédié sous CentOS, j'ai évidemment appliqué
cet adage à moi même. Je vous présente donc un script duquel vous pouvez
librement vous inspirer afin de l'adapter à votre environnement.
Ce script place quelques répertoires et quelques exports de base de
données dans un fichier tar.gz puis envoie ce fichier sur 2 serveurs FTP
(ceinture + bretelles) et enfin déplace l'archive dans un répertoire de
&lt;a class="reference external" href="http://pyd.io"&gt;pydio&lt;/a&gt; afin de pouvoir facilement récupérer le
fichier sur ma machine personnelle.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
#!/bin/bash
#Fichier de Backup créé par Alain Devarieux
# - créer un fichier tar.gz contenant plusieurs élements de l'arborescence
# - Envoie ce fichier tar.gz sur un serveur FTP dédié au backup
# - Dépose une copie du fichier tar.gz dans un repertoire local
# - Ceinture ET Bretelles : Envoie le fichier tar.gz sur un 2nd serveur FTP
logger -t backup &amp;quot;########## Debut de la sauvegarde ##########&amp;quot;
# Nom du fichier de Backup
backup_file=&amp;quot;/sauv/backup-$(hostname)-$(date +%Y-%m-%d).tar.gz&amp;quot;
#Variable : Premier Serveur FTP de Backup
bckftp01=&amp;quot;server01&amp;quot;
bckftp01_user=&amp;quot;user01&amp;quot;
bckftp01_mdp=&amp;quot;Enter password here&amp;quot;
#Variable : Second Serveur de Backup
bckftp02=&amp;quot;server02&amp;quot;
bckftp02_user=&amp;quot;user02&amp;quot;
bckftp02_mdp=&amp;quot;Enter password here&amp;quot;
#Varibales : Dossier de destination du tar.gz en local
destdir=&amp;quot;/var/www/html/pydio/data/files/&amp;quot;
#Liste des dossiers à sauvegarder
backup_list=&amp;quot;/etc /var/www/html /sauv/sql /sauv/packagelist.txt&amp;quot;
#Le dossier a exclure
backup_exclude=&amp;quot;/var/www/html/pydio/data&amp;quot;

#Liste des paquets installés
rpm -qa &amp;gt; /sauv/packagelist.txt

#Dump des bases SQL
#Base01
if ! mysqldump -u userbase01 -pPassword base01 &amp;gt; /sauv/sql/base01.sql; then
statusbase01=&amp;quot;Warning : Erreur lors de l'export de la base Base01&amp;quot;
else
statusbase01=&amp;quot;Succes de l'export de la base Base01&amp;quot;
fi
logger -t backup &amp;quot;$statusbase01&amp;quot;
#Base02
if ! mysqldump -u userbase02 -pPassword Base02 &amp;gt; /sauv/sql/base02.sql; then
statusbase02=&amp;quot;Warning : Erreur lors de l'export de la base Base02&amp;quot;
else
statusbase02=&amp;quot;Succes de l'export de la base Base02&amp;quot;
fi
logger -t backup &amp;quot;$statusbase02&amp;quot;

#Creation du tar
#On commence par enregistrer la seconde de debut
start=$(date '+%s')
if ! tar czf $backup_file --exclude=$backup_exclude $backup_list; then
statustar=&amp;quot;echec de la commande tar&amp;quot; || exit 1
else
statustar=&amp;quot;Succes creation fichier tar taille=$(stat -c%s $backup_file) duree=$((`date '+%s'` - $start))&amp;quot;
fi
#On log le resultat
logger -t backup &amp;quot;$statustar&amp;quot;

#Envoie vers le ftp01
if ! lftp $bckftp01_user:$bckftp01_mdp&amp;#64;$bckftp01 -e &amp;quot;put $backup_file; exit&amp;quot;; then
statusftp01=&amp;quot;Echec de l'envoie FTP vers $bckftp01&amp;quot;
else
statusftp01=&amp;quot;Succes de l'envoie FTP vers $bckftp01&amp;quot;
fi
#On log le resultat
logger -t backup &amp;quot;$statusftp01&amp;quot;

#Envoie vers le ftp02
if ! lftp $bckftp02_user:$bckftp02_mdp&amp;#64;$bckftp02 -e &amp;quot;put $backup_file; exit&amp;quot;; then
statusftp02=&amp;quot;Echec de l'envoie FTP vers $bckftp02&amp;quot;
else
statusftp02=&amp;quot;Succes de l'envoie FTP vers $bckftp02&amp;quot;
fi
#On log le resultat
logger -t backup &amp;quot;$statusftp02&amp;quot;

#Deplacer le fichier dans pydio
if ! mv $backup_file $destdir; then
statusmv=&amp;quot;Warning : Echec du déplacement de $backup_file dans Pydio&amp;quot;
else
statusmv=&amp;quot;Fichier $backup_file déplacé dans Pydio&amp;quot;
fi
logger -t backup &amp;quot;$statusmv&amp;quot;
logger -t backup &amp;quot;########## Fin de la sauvegarde ##########&amp;quot;
exit 0
&lt;/pre&gt;
&lt;p&gt;Le script est planifié pour être lancé tous les dimanche à 5h00.
J'ai écris un 2nd script qui m'envoie un email avec les logs de la
sauvegarde afin que je puisse surveillé que tout c'est bien passé&lt;/p&gt;
&lt;pre class="literal-block"&gt;
#!/bin/bash
#Envoie d'un mail suite à l'execution du script de sauvegarde
datejour=$(LC_ALL=&amp;quot;en_EN.UTF-8&amp;quot; date &amp;quot;+%b %d&amp;quot;)
grep backup /var/log/messages |grep &amp;quot;$datejour&amp;quot; | mail -s &amp;quot;Backup du mois de $(date &amp;quot;+%B&amp;quot;)&amp;quot; adresse&amp;#64;email.com adresse2&amp;#64;email.com
&lt;/pre&gt;
&lt;p&gt;Petite explication sur le LC_ALL=&amp;quot;en_EN.UTF-8&amp;quot;
Lorsque je tape&lt;/p&gt;
&lt;pre class="literal-block"&gt;
date &amp;quot;+%b&amp;quot;
&lt;/pre&gt;
&lt;p&gt;J'obtiens la version courte et francisée du mois. Par exemple, pour le
mois de juillet, je vais avoir comme retour &lt;em&gt;juil&lt;/em&gt;. Hors syslog lui
écris dans le fichier &lt;em&gt;/var/log/messages&lt;/em&gt; en anglais. Ce qui donne pour
le mois de juillet : &lt;em&gt;jul&lt;/em&gt; pour &lt;em&gt;july.&lt;/em&gt; Pour pouvoir réussir mon grep
dans mon fichier de log, j'ai besoin de que la commande &lt;em&gt;date&lt;/em&gt; me
retourne les informations en anglais également. C'est ce qui explique le
positionnement de cette variable en amont.&lt;/p&gt;
&lt;p&gt;Ce second script est également placé dans un cron et est lancé a 5h15
tous les dimanches.&lt;/p&gt;
</content><category term="Tech"></category><category term="bash"></category><category term="centos"></category><category term="cron"></category><category term="ftp"></category><category term="gz"></category><category term="Linux"></category><category term="pydio"></category><category term="sauvegarde"></category><category term="script"></category><category term="tar"></category></entry><entry><title>Résolutions de début d'année</title><link href="https://blog.devarieux.net/2013/12/resolution-de-debut-dannee.html" rel="alternate"></link><published>2013-12-28T18:22:00+01:00</published><updated>2013-12-28T18:22:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-12-28:/2013/12/resolution-de-debut-dannee.html</id><summary type="html">&lt;p&gt;En ce début d'année 2014, voici mes projets informatiques personnels
dont j'aimerai terminer la mise en œuvre rapidement.
Le problème n'est pas de réunir les compétences mais tout simplement
de prendre le temps de m'y mettre sérieusement pour enfin les terminer
proprement.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1 - Terminer ma migration des services Google&lt;/strong&gt;
J'ai …&lt;/p&gt;</summary><content type="html">&lt;p&gt;En ce début d'année 2014, voici mes projets informatiques personnels
dont j'aimerai terminer la mise en œuvre rapidement.
Le problème n'est pas de réunir les compétences mais tout simplement
de prendre le temps de m'y mettre sérieusement pour enfin les terminer
proprement.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1 - Terminer ma migration des services Google&lt;/strong&gt;
J'ai déjà avec succès migré mes contacts, mon agenda et le stockage
cloud avec une instance OwnCloud. Le problème majeur reste la migration
des emails.
En effet, malgré les efforts fournis par les différents hébergeurs de
solutions mutualisées, je n'arrive toujours pas à avoir des emails qui
ne partent pas dans les boites spams de mes contacts qui utilisent des
webmails gmail, outlook ou yahoo.
Sans solutions pérennes rapidement, je me verrai peu être dans
l'obligation d'investir dans un serveur dédié. Bien plus cher, mais au
moins je maîtriserai le serveur SMTP.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2 - Mettre en place un serveur de musique à la maison&lt;/strong&gt;
L'ampli, les enceintes, la platine vinyle sont en place. Il me reste
à ajouter une solution simple pour lire de la musique numérique.
Pour l'instant, lorsque je veux écouter des fichiers FLAC ou
découvrir de nouveaux morceaux sur soundcloud, je débranche les RCA sur
la box et les branche sur un câble Jack/RCA. Ça fonctionne bien, mais ça
fait trainer un câble dans le salon. J'aimerai donc, avec les 3 ou 4 PC
portables qui ne fonctionnent plus et qui sont stockés à l'arrache dans
le bureau, monter un vrai PC portable, le plus silencieux possible, avec
un petit serveur MPD.
Avec ça et un client Android MPD, je pourrais gérer mes playlists
directement depuis mon canapé.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3 - Changer de distribution&lt;/strong&gt;
Cela devrait être fait rapidement. Pour l'instant, c'est Ubuntu qui
tourne sur le laptop. Cela fait environ 4 mois et pour être honnête, je
n'aime pas du tout (remarquez l'effort surhumain que je fais pour ne pas
dire &amp;quot;&lt;strong&gt;*C'est vraiment de la merde cette grosse bouse!!!!!*&lt;/strong&gt;&amp;quot;). Je
pense revenir rapidement sous Mageia qui est ma distribution &lt;em&gt;out of the
box&lt;/em&gt; favorite. Surtout depuis qu'elle supporte la technologie Optimus.&lt;/p&gt;
</content><category term="MyLife"></category><category term="laptop"></category><category term="mylife"></category><category term="owncloud"></category><category term="pc"></category></entry><entry><title>Veille Open Source pour les pros</title><link href="https://blog.devarieux.net/2013/12/veille-open-source-pour-les-pros.html" rel="alternate"></link><published>2013-12-18T18:48:00+01:00</published><updated>2013-12-18T18:48:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-12-18:/2013/12/veille-open-source-pour-les-pros.html</id><summary type="html">&lt;p&gt;Cela fait quelques temps que je suis ce site, édité par
&lt;a class="reference external" href="http://www.smile.fr/"&gt;smile&lt;/a&gt;&amp;nbsp;(dont je vous conseil les livres
blancs), et je n'en ai pas beaucoup parlé autour de moi. Ajouté
récemment dans les flux RSS, il me permet de suivre l'actualité des
solutions open source professionnelles facilement.&lt;/p&gt;
&lt;p&gt;Ce site,
c'est …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Cela fait quelques temps que je suis ce site, édité par
&lt;a class="reference external" href="http://www.smile.fr/"&gt;smile&lt;/a&gt;&amp;nbsp;(dont je vous conseil les livres
blancs), et je n'en ai pas beaucoup parlé autour de moi. Ajouté
récemment dans les flux RSS, il me permet de suivre l'actualité des
solutions open source professionnelles facilement.&lt;/p&gt;
&lt;p&gt;Ce site,
c'est&amp;nbsp;&lt;a class="reference external" href="http://www.open-source-guide.com/"&gt;open-source-guide.com&lt;/a&gt;,
disponible également en &lt;a class="reference external" href="http://www.open-source-guide.com/en"&gt;version
anglaise&lt;/a&gt;. Il m'a permis de
découvrir plusieurs solutions open source dont je ne connaissais pas
l'existence. Un système de double notation permet de se rendre
rapidement compte de la fiabilité des produits (note smile et note des
utilisateurs).&lt;/p&gt;
</content><category term="Tech"></category><category term="annuaire"></category><category term="libre"></category><category term="open source"></category><category term="smile"></category></entry><entry><title>Owncloud et fail2ban derrière un reverse proxy</title><link href="https://blog.devarieux.net/2013/12/owncloud-et-fail2ban-derriere-un-reverse-proxy.html" rel="alternate"></link><published>2013-12-05T18:32:00+01:00</published><updated>2013-12-05T18:32:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-12-05:/2013/12/owncloud-et-fail2ban-derriere-un-reverse-proxy.html</id><summary type="html">&lt;p&gt;Dans le &lt;a class="reference external" href="/mise-en-oeuvre-de-fail2ban-pour-owncloudldap.html"&gt;dernier
article&lt;/a&gt;,
j'expliquais comment mettre en place fail2ban sur son serveur pour
protéger son instance Owncloud lorsqu'elle est connectée sur un serveur
Ldap.&lt;/p&gt;
&lt;p&gt;En général, lorsqu'on utilise un serveur Ldap pour l'authentification,
c'est qu'on se trouve en entreprise et les choses ne sont pas alors pas
si simple …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Dans le &lt;a class="reference external" href="/mise-en-oeuvre-de-fail2ban-pour-owncloudldap.html"&gt;dernier
article&lt;/a&gt;,
j'expliquais comment mettre en place fail2ban sur son serveur pour
protéger son instance Owncloud lorsqu'elle est connectée sur un serveur
Ldap.&lt;/p&gt;
&lt;p&gt;En général, lorsqu'on utilise un serveur Ldap pour l'authentification,
c'est qu'on se trouve en entreprise et les choses ne sont pas alors pas
si simple. Par exemple, dans mon cas, le serveur owncloud ne se trouve
pas directement en frontale sur le net mais est caché derrière un
reverse proxy.&lt;/p&gt;
&lt;p&gt;Du coup, le serveur owncloud ne voit qu'une seule IP : celle du reverse
proxy. La mise en place de fail2ban sur ce serveur poserait alors un
gros problème car cela reviendrait à faire bannir l'IP du reverse proxy
et interdire tout accès à owncloud depuis l’extérieur. Dans cet article,
nous allons donc voir comment corriger ce problème à l'aide de syslog.&lt;/p&gt;
&lt;div class="section" id="sur-le-serveur-owncloud"&gt;
&lt;h2&gt;Sur le serveur Owncloud&lt;/h2&gt;
&lt;div class="section" id="modification-d-owncloud"&gt;
&lt;h3&gt;Modification d'owncloud&lt;/h3&gt;
&lt;div class="section" id="configuration-du-serveur-owncloud"&gt;
&lt;h4&gt;Configuration du serveur owncloud&lt;/h4&gt;
&lt;p&gt;Afin d’assurer une cohérence dans l’écriture des logs, il faut que la
timezone soit correctement configurée sur le serveur.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;owncloud]# tzselect
&lt;/pre&gt;
&lt;p&gt;Création du fichier qui recevra les écritures des logs des échecs de
connexions :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;owncloud]# touch /var/log/owncloud-fail.log
[root&amp;#64;owncloud]# chmod 660 /var/log/owncloud-fail.log
[root&amp;#64;owncloud]# chown root.apache /var/log/owncloud-fail.log
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="modification-du-backend-d-owncloud"&gt;
&lt;h4&gt;Modification du backend d'owncloud&lt;/h4&gt;
&lt;p&gt;Dans le fichier &lt;em&gt;/var/www/html/owncloud/lib/user/database.php&lt;/em&gt;, ligne
202. Dans la fonction &lt;strong&gt;checkPassword&lt;/strong&gt;, entre le else et le return
false, insérez le code suivant :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$headers = apache_request_headers();
$real_client_ip = $headers[&amp;quot;X-Forwarded-for&amp;quot;];
$IPClient=$_SERVER['REMOTE_ADDR'];
openlog(&amp;quot;owncloud&amp;quot;, LOG_PID, LOG_LOCAL0);
syslog(LOG_WARNING, &amp;quot;Password check failed for: &amp;quot; . &amp;quot;$IPClient&amp;quot; . &amp;quot; &amp;quot; . &amp;quot;$real_client_ip&amp;quot;);
closelog();
&lt;/pre&gt;
&lt;p&gt;Dans le fichier &lt;em&gt;/var/www/html/owncloud/apps/user_ldap/user_ldap.php&lt;/em&gt;,
ligne 75. Dans la fonction &lt;strong&gt;checkPassword&lt;/strong&gt;, entre le
if(count($ldap_users) &amp;lt; 1) { et le return false; insérez le code
suivant :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
if($uid!=&amp;quot;admin&amp;quot;) {
$headers = apache_request_headers();
$real_client_ip = $headers[&amp;quot;X-Forwarded-For&amp;quot;];
$IPClient=$_SERVER['REMOTE_ADDR'];
openlog(&amp;quot;owncloud&amp;quot;, LOG_PID, LOG_LOCAL0);
syslog(LOG_WARNING, &amp;quot;Password check failed for: &amp;quot; . &amp;quot;$IPClient&amp;quot; . &amp;quot; &amp;quot; . &amp;quot;$real_client_ip&amp;quot;);
closelog();
&lt;/pre&gt;
&lt;p&gt;Puis, en dessous du return false, fermez l’instruction if en ajoutant un&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;}&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Toujours dans le même fichier, ligne 97, juste après
&lt;strong&gt;if(!$this→areCredentialsValid($dn, $password)) {&lt;/strong&gt; Et au-dessus du
&lt;strong&gt;return false;&lt;/strong&gt; correspondant ajouter le code suivant :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$headers = apache_request_headers();
$real_client_ip = $headers[&amp;quot;X-Forwarded-For&amp;quot;];
$IPClient=$_SERVER['REMOTE_ADDR'];
openlog(&amp;quot;owncloud&amp;quot;, LOG_PID, LOG_LOCAL0);
syslog(LOG_WARNING, &amp;quot;Password check failed for: &amp;quot; . &amp;quot;$IPClient&amp;quot; . &amp;quot; &amp;quot; . &amp;quot;$real_client_ip&amp;quot;);
closelog();
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="explication-du-code"&gt;
&lt;h4&gt;Explication du code&lt;/h4&gt;
&lt;pre class="literal-block"&gt;
$headers = apache_request_headers()
&lt;/pre&gt;
&lt;p&gt;Récupère l’entête des requêtes http venant du reverse proxy sous forme
de tableau&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$real_client_ip = $headers[ &amp;quot;X-forwarded-For &amp;quot;] ;
&lt;/pre&gt;
&lt;p&gt;Récupère l’adresse IP réelle du client dans le tableau $headers&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$IPClient = $_SERVER[‘REMOTE_ADDR’] ;
&lt;/pre&gt;
&lt;p&gt;Récupère l’adresse IP du client. Si le client vient de l’extérieur du
SIB, cette IP sera celle du reverse proxy.&lt;/p&gt;
&lt;p&gt;Openlog, Syslog et closelog sont les fonctions PHP pour écrire les
échecs de connexions en passant par syslog.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-de-rsyslog"&gt;
&lt;h3&gt;Configuration de rsyslog&lt;/h3&gt;
&lt;div class="section" id="log-locaux"&gt;
&lt;h4&gt;Log locaux&lt;/h4&gt;
&lt;p&gt;Pour loguer les échecs de connexion venant d’owncloud, il faut dire à
rsyslog ce qu’il doit faire avec ces entrées. On crée pour cela un
fichier supplémentaire &lt;em&gt;/etc/rsyslog.d/owncloud.conf&lt;/em&gt; contenant une
seule ligne :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
local0.*   /var/log/owncloud-fail.log
&lt;/pre&gt;
&lt;p&gt;Ainsi, tous les messages reçus sur l’interface LOCAL0 de rsyslog seront
redirigé vers le fichier &lt;em&gt;/var/log/owncloud-fail.log&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="log-distant"&gt;
&lt;h4&gt;Log distant&lt;/h4&gt;
&lt;p&gt;Le serveur owncloud ne peut pas bannir lui-même les IP car il ne voit
que l’IP du reverse proxy pour toutes les connexions venant de
l’extérieur. Il faut donc remonter les logs des échecs de connexions
vers le reverse proxy qui bannira lui-même les IP. On crée pour cela un
nouveau fichier de configuration de rsyslog :
&lt;em&gt;/etc/rsyslog.d/fail2ban.conf&lt;/em&gt;.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
local0.*        &amp;#64;nomdevotrereverse.proxy:514
&lt;/pre&gt;
&lt;p&gt;Ceci a pour effet d’envoyer tous les messages reçu sur l’interface
LOCAL0 de rsyslog vers le service syslog du reverse proxy.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="prise-en-compte-des-modifications"&gt;
&lt;h3&gt;Prise en compte des modifications&lt;/h3&gt;
&lt;p&gt;On redémarre le service rsyslog&lt;/p&gt;
&lt;pre class="literal-block"&gt;
/etc/init.d/rsyslog restart
&lt;/pre&gt;
&lt;p&gt;Afin de voir si les modifications effectuées n’ont pas générée d’erreur
:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
grep rsyslog /var/log/messages
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="sur-le-reverse-proxy"&gt;
&lt;h2&gt;Sur le reverse proxy&lt;/h2&gt;
&lt;div class="section" id="configuration-de-syslog"&gt;
&lt;h3&gt;Configuration de syslog&lt;/h3&gt;
&lt;p&gt;Par défaut, le service syslog n’écoute pas le réseau et ne peut donc pas
recevoir de logs distants. Pour corriger cela, on édite le fichier
&lt;em&gt;/etc/sysconfig/syslog&lt;/em&gt;. Modification de la ligne SYSLOGD_OPTIONS en
ajoutant l’option –r&lt;/p&gt;
&lt;pre class="literal-block"&gt;
SYSLOGD_OPTIONS=&amp;quot;-r -m 0&amp;quot;
&lt;/pre&gt;
&lt;p&gt;Puis, on relance le service afin d’activer l’écoute réseau :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
/etc/init.d/syslog restart
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-de-fail2ban"&gt;
&lt;h3&gt;Configuration de fail2ban&lt;/h3&gt;
&lt;div class="section" id="installation"&gt;
&lt;h4&gt;Installation&lt;/h4&gt;
&lt;p&gt;L’installation se fait simplement par le gestionnaire de paquet :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
yum install fail2ban
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-de-la-prison"&gt;
&lt;h4&gt;Configuration de la prison&lt;/h4&gt;
&lt;p&gt;On édite pour cela le fichier &lt;em&gt;/etc/fail2ban/jail.conf&lt;/em&gt; et on y ajoute
les lignes suivantes :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[owncloud]
enabled = true
port = https
filter = owncloud
action = iptables[name=httpd,port=https,protocal=all]
logpath = /var/log/messages
maxretry = 5
&lt;/pre&gt;
&lt;p&gt;Toutes les autres prisons peuvent être positionnées sur enabled = false
puisque nous n’en avons pas besoin ici.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="creation-du-filtre"&gt;
&lt;h4&gt;Création du filtre&lt;/h4&gt;
&lt;p&gt;Dans la configuration du jail, nous avons dit à fail2ban d’utiliser le
filtre owncloud, nous allons maintenant créer le filtre :&lt;/p&gt;
&lt;p&gt;Création du fichier &lt;em&gt;/etc/fail2ban/filter.d/owncloud.conf&lt;/em&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[Definition]
failregex = Password check failed for: ip.du.reverse.proxy &amp;lt;HOST&amp;gt;
ignoreregex =
&lt;/pre&gt;
&lt;p&gt;Puisque nous ne souhaitons que bannir les IP externes, nous ne
récupérons que les lignes qui contiennent l’IP du reverse proxy ET l’IP
réelle du client. Le ligne ignoreregex n’est pas nécessaire mais il faut
tout de même qu’elle soit présente afin que fail2ban valide la
configuration.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="demarrage-du-service"&gt;
&lt;h4&gt;Démarrage du service&lt;/h4&gt;
&lt;p&gt;On lance le service fail2ban :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
/etc/init.d/fail2ban start
&lt;/pre&gt;
&lt;p&gt;Si le lancement tombe en échec, c’est qu’il y a un problème de
configuration. Pour repérer ce problème, il faut lancer le daemon à la
main :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fail2ban-server
&lt;/pre&gt;
&lt;p&gt;Puis on lance un reload du client qui va tester pour nous la
configuration&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fail2ban-client reload
&lt;/pre&gt;
&lt;p&gt;S’il y a une erreur, cette commande nous le dira.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="test-de-la-configuration"&gt;
&lt;h4&gt;Test de la configuration&lt;/h4&gt;
&lt;p&gt;Afin de tester la valididité de la regex, fail2ban propose l’outil
fail2ban-regex. Créer pour cela quelques échecs de connexion et tester
avec la commande :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fail2ban-regex /var/log/messages /etc/fail2ban/filter.d/owncloud.conf
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
Running tests
=============
Use regex file : /etc/fail2ban/filter.d/owncloud.conf
Use log file   : /var/log/messages

Results
=======
Failregex
|- Regular expressions:
|  [1] Password check failed for: ip.du.reverse.proxy &amp;lt;HOST&amp;gt;
|
`- Number of matches:
   [1] 6 match(es)

Ignoreregex
|- Regular expressions:
|
`- Number of matches:

Summary
=======

Addresses found:
[1]
    X.X.X.X (Thu Dec 05 10:02:11 2013)
    X.X.X.X (Thu Dec 05 10:05:24 2013)
    X.X.X.X (Thu Dec 05 10:05:34 2013)
    X.X.X.X (Thu Dec 05 10:05:42 2013)
    X.X.X.X (Thu Dec 05 10:05:47 2013)
    X.X.X.X (Thu Dec 05 10:05:53 2013)

Date template hits:
18154 hit(s): MONTH Day Hour:Minute:Second

Success, the total number of match is 6
However, look at the above section 'Running tests' which could contain important info
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="fail2ban"></category><category term="owncloud"></category><category term="proxy"></category><category term="remote log"></category><category term="reverse"></category><category term="reverse proxy"></category><category term="rsyslog"></category><category term="syslog"></category></entry><entry><title>Mise en oeuvre de Fail2Ban pour Owncloud/Ldap</title><link href="https://blog.devarieux.net/2013/11/mise-en-oeuvre-de-fail2ban-pour-owncloudldap.html" rel="alternate"></link><published>2013-11-27T20:30:00+01:00</published><updated>2013-11-27T20:30:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-11-27:/2013/11/mise-en-oeuvre-de-fail2ban-pour-owncloudldap.html</id><summary type="html">&lt;p&gt;Si vous stockez des données personnelles ou à caractères sensibles sur
votre serveur owncloud, vous souhaitez sans doute que les malandrins
s'aventurant à tester vos couples &lt;em&gt;Login / Mot de passe&lt;/em&gt; par brutforce
soient éjectés de votre serveur après un certains nombre de tentatives
infructueuses.&lt;/p&gt;
&lt;p&gt;Fail2Ban fera le travail pour vous …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Si vous stockez des données personnelles ou à caractères sensibles sur
votre serveur owncloud, vous souhaitez sans doute que les malandrins
s'aventurant à tester vos couples &lt;em&gt;Login / Mot de passe&lt;/em&gt; par brutforce
soient éjectés de votre serveur après un certains nombre de tentatives
infructueuses.&lt;/p&gt;
&lt;p&gt;Fail2Ban fera le travail pour vous, mais pour cela, il a besoin que les
échecs de connexions soient logués, ce qu'Owncloud ne fait
malheureusement pas. Il faut donc, avant de mettre en oeuvre Fail2Ban,
procéder à quelques modifications dans le code d'Owncloud.&lt;/p&gt;
&lt;p&gt;Vous trouverez beaucoup d'article vous expliquant comment faire cela
avec une connexion classique via la base de donnée d'Owncloud, par
exemple
&lt;a class="reference external" href="http://www.dataparadis.net/osp/gnu-linux-server/cloud-server/owncloud-and-fail2ban-update/"&gt;ici&lt;/a&gt;.
Dans cet article, nous verrons plutôt comment régler le problème
lorsqu'on utilise une authentification via un serveur Ldap.&lt;/p&gt;
&lt;div class="section" id="preparer-le-terrain"&gt;
&lt;h2&gt;Préparer le terrain&lt;/h2&gt;
&lt;p&gt;Afin d'assurer une cohérence dans l'écriture des logs, il faut que la
timezone soit correctement configurée sur le serveur. Vous pouvez faire
cela à l'aide de la commande :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;server1]# tzselect
&lt;/pre&gt;
&lt;p&gt;On va ensuite, créer le fichier qui servira à loguer les échecs de
connexions&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[root&amp;#64;server1]# touch /var/log/owncloud-fail.log
[root&amp;#64;server1]# chmod 660 /var/log/owncloud-fail.log
[root&amp;#64;server1]# chown root.apache&amp;nbsp;/var/log/owncloud-fail.log
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="modification-du-backend-d-owncloud"&gt;
&lt;h2&gt;Modification du backend d'Owncloud&lt;/h2&gt;
&lt;p&gt;Dans le fichier lib/user/database.php, ligne 202. Dans la fonction
checkPassword, entre le &lt;strong&gt;else&lt;/strong&gt; et le &lt;strong&gt;return false&lt;/strong&gt;, insérez le code
suivant :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$today = new DateTime();
date_timezone_set($today, timezone_open('Europe/Paris'));
$IPClient=$_SERVER['REMOTE_ADDR'];
$logAuth=fopen('/var/log/owncloud-fail.log', 'a+');
fputs($logAuth, date_format($today, 'Y/m/d H:i:s') . &amp;quot; Password check failed for: \t&amp;quot; . $IPClient . &amp;quot;\n&amp;quot;);
fclose($logAuth);
&lt;/pre&gt;
&lt;p&gt;Dans le fichier apps/user_ldap/user_ldap.php, ligne 75. Dans la
fonction checkPassword, entre le&amp;nbsp; &lt;strong&gt;if(count($ldap_users) &amp;lt; 1)
{&lt;/strong&gt; et le&amp;nbsp; &lt;strong&gt;return false;&lt;/strong&gt; insérez le code suivant :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
if($uid!=&amp;quot;admin&amp;quot;) {
date_default_timezone_set('Europe/Paris');
$today = date(&amp;quot;Y/m/d H:i:s&amp;quot;);
$IPClient=$_SERVER['REMOTE_ADDR'];
$logAuth=fopen('/var/log/owncloud-fail.log', 'a+');
fputs($logAuth, $today . &amp;quot; Password check failed for: \t&amp;quot; . $IPClient . &amp;quot;\n&amp;quot;);
fclose($logAuth);
&lt;/pre&gt;
&lt;p&gt;Puis, en dessous du return false, fermez l'instruction if en ajoutant un&lt;/p&gt;
&lt;pre class="literal-block"&gt;
}
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Explication du code :&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Il y a un utilisateur qui est inscrit en base de donnée et qui n'est pas
dans le ldap, c'est l'admin d'owncloud. Afin ne ne pas loguer une
connexion de l'utilisateur 'admin' en tant qu'erreur de connexion, il
est nécessaire de vérifier que que c'est pas cet utilisateur qui se
connecte. D'où le &lt;strong&gt;if($uid!=&amp;quot;admin&amp;quot;){}&lt;/strong&gt;. Veillez à modifier cette
valeur suivant la votre.&lt;/p&gt;
&lt;p&gt;La variable &lt;strong&gt;$ldap_users&lt;/strong&gt; est un tableau contenant la liste des
utilisateurs qui correspondent à la valeur saisie dans le login. Si
cette table est vide, alors il y aura un échec de connexion logué.&lt;/p&gt;
&lt;p&gt;Le dernier ajout à faire se trouve un petit peu plus bas dans ce
fichier, ligne 97, juste en dessous
de&amp;nbsp;&lt;strong&gt;if(!$this-&amp;gt;areCredentialsValid($dn, $password)) {&lt;/strong&gt; et au dessus
de &lt;strong&gt;return false;&lt;/strong&gt;ajoutez le code suivant :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
date_default_timezone_set('Europe/Paris');
$today = date(&amp;quot;Y/m/d H:i:s&amp;quot;);
$IPClient=$_SERVER['REMOTE_ADDR'];
$logAuth=fopen('/var/log/owncloud-fail.log', 'a+');
fputs($logAuth, $today . &amp;quot; Password check failed for: \t&amp;quot; . $IPClient . &amp;quot;\n&amp;quot;);
fclose($logAuth);
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-de-fail2ban"&gt;
&lt;h2&gt;Configuration de Fail2Ban&lt;/h2&gt;
&lt;p&gt;Dans votre fichier /etc/fail2ban/jail.conf (ou équivalent suivant votre
distribution) :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
[Owncloud]
enabled  = true
port     = http,https
filter   = owncloud
logpath  = /var/log/owncloud-fail.log
maxretry = 5
&lt;/pre&gt;
&lt;p&gt;Et enfin, le fichier de filtre /etc/fail2ban/filter.d/owncloud.conf&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# /etc/fail2ban/filter.d/owncloud.conf
#
# Fail2Ban configuration file
# Owncloud
#

[Definition]
# Option: failregex
failregex = &amp;lt;HOST&amp;gt;$
&lt;/pre&gt;
&lt;p&gt;Relancez fail2ban et le tour est joué.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="fail2ban"></category><category term="ldap"></category><category term="Linux"></category><category term="owncloud"></category></entry><entry><title>Remboursement de licence Windows 8 sur portable ASUS - Episode 2</title><link href="https://blog.devarieux.net/2013/10/remboursement-de-licence-windows-8-sur-portable-asus-episode-2.html" rel="alternate"></link><published>2013-10-19T17:51:00+02:00</published><updated>2013-10-19T17:51:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-10-19:/2013/10/remboursement-de-licence-windows-8-sur-portable-asus-episode-2.html</id><summary type="html">&lt;div class="section" id="la-vertu-de-la-patience"&gt;
&lt;h2&gt;La vertu de la patience&lt;/h2&gt;
&lt;p&gt;Suite et fin de ce &lt;a class="reference external" href="http://blog.devarieux.net/2013/07/remboursement-de-licence-windows-8-sur-portable-asus/"&gt;premier
article&lt;/a&gt;
sur la procédure de remboursement de licence Windows de mon nouveau
portable. Il m'a fallu patienter quelques temps avant de devoir les
relancer pour savoir où en était la procédure.&lt;/p&gt;
&lt;p&gt;J'avais en effet envoyé mon dossier complet par …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="section" id="la-vertu-de-la-patience"&gt;
&lt;h2&gt;La vertu de la patience&lt;/h2&gt;
&lt;p&gt;Suite et fin de ce &lt;a class="reference external" href="http://blog.devarieux.net/2013/07/remboursement-de-licence-windows-8-sur-portable-asus/"&gt;premier
article&lt;/a&gt;
sur la procédure de remboursement de licence Windows de mon nouveau
portable. Il m'a fallu patienter quelques temps avant de devoir les
relancer pour savoir où en était la procédure.&lt;/p&gt;
&lt;p&gt;J'avais en effet envoyé mon dossier complet par email le 26 Juillet. Le
28 Août, n'ayant toujours aucune nouvelles, je leur ai envoyé ce mail de
relance :&lt;/p&gt;
&lt;blockquote&gt;
Bonjour,
Je me permets de revenir vers vous concernant cette demande de
remboursement.
Je vous ai envoyé les documents il y a un petit peu plus d'un mois
et je n'ai pas reçu de nouvelle de votre part.
Pouvez-vous me dire quel est le délai généralement constaté dans le
traitement de ces dossiers?
Cordialement,&lt;/blockquote&gt;
&lt;p&gt;Et le jour même, je recevais cette réponse de leur part :&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bonjour monsieur,&lt;/p&gt;
&lt;p&gt;Je vous remercie.&lt;/p&gt;
&lt;p&gt;Je vous joins maintenant en pièce jointe, le formulaire pré rempli
que vous devrez vérifier, dater puis signer et me le retourner en
retour de ce mail s’il vous plaît.&lt;/p&gt;
&lt;p&gt;En vous souhaitant une bonne journée,&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Le jour même, je leur renvoyais le document, toujours par email,
rempli et signé.
Le 17 Septembre, mon dossier montait enfin en compta.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bonjour monsieur,&lt;/p&gt;
&lt;p&gt;Je vous remercie.&lt;/p&gt;
&lt;p&gt;Je remonte votre document au centre de comptabilité.&lt;/p&gt;
&lt;p&gt;En vous souhaitant une bonne journée,&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Et le 10 Octobre, j'ai enfin reçu mon virement de 42€.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="bilan-de-l-operation"&gt;
&lt;h2&gt;Bilan de l'opération&lt;/h2&gt;
&lt;p&gt;D'après cette petite expérience, le remboursement de licence Windows
chez Asus ce fait plutôt facilement. Pas besoin de renvoyer le PC. Il
faut juste leur écrire assez rapidement (au max 3 semaines après
l'achat) et être assez patient.&lt;/p&gt;
&lt;p&gt;J'ai lancé la procédure le 16 Juillet et reçu le virement le 10 Octobre.
Il a donc fallu environ 3 mois pour aller au bout de l'opération.&lt;/p&gt;
&lt;p&gt;&lt;img alt="asus-ACF-COA" src="/images/asus-ACF-COA-300x92.png" /&gt;&lt;/p&gt;
&lt;p&gt;Je me suis tout de même heurté à un petit problème lors du premier
démarrage de la machine. Je souhaitais démarrer sur l'OS Windows afin
pouvoir refuser le CLU. Il est impossible de refuser le CLU. Vous ne
pouvez que l'accepter. La seul solution a été de rebooter le PC (hard
reboot via le bouton Power).&lt;/p&gt;
&lt;p&gt;Il ne faut surtout pas démarrer sur la partition Windows. Ceci risque
d'activer la licence de l'OS, son remboursement devenant alors
impossible.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="acf_coa"></category><category term="asus"></category><category term="remboursement"></category><category term="windows"></category></entry><entry><title>Remboursement de licence Windows 8 sur portable ASUS - Episode 1</title><link href="https://blog.devarieux.net/2013/07/remboursement-de-licence-windows-8-sur-portable-asus.html" rel="alternate"></link><published>2013-07-25T19:14:00+02:00</published><updated>2013-07-25T19:14:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-07-25:/2013/07/remboursement-de-licence-windows-8-sur-portable-asus.html</id><summary type="html">&lt;p&gt;Il y a 10 jours, j'ai fait l'acquisition d'un nouvel ultra-book. Un Asus
Zenbook UX32VD-R4020H pour être précis. Une belle bête, avec un core i5
&amp;#64; 1.70Ghz, 4go de RAM, technologie Optimus (un chipset Intel HD intégré
au processeur et une carte graphique Nvidia 620M quand la machine a
besoin …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Il y a 10 jours, j'ai fait l'acquisition d'un nouvel ultra-book. Un Asus
Zenbook UX32VD-R4020H pour être précis. Une belle bête, avec un core i5
&amp;#64; 1.70Ghz, 4go de RAM, technologie Optimus (un chipset Intel HD intégré
au processeur et une carte graphique Nvidia 620M quand la machine a
besoin d'un peu plus de puissance graphique), un SSD de 24Go pour
installer l'OS et un disque dur de 500GO pour la data. Le tout avec un
écran 13.3&amp;quot; 1080p.&lt;/p&gt;
&lt;p&gt;Évidemment, la machine est livrée avec un Windows 8 préinstallée. J'ai
donc entrepris de me faire rembourser l'OS OEM par Asus.&lt;/p&gt;
&lt;p&gt;Pour cela, il y a une adresse email de contact qui est
&lt;a class="reference external" href="mailto:acf_coa&amp;#64;asus.com"&gt;acf_coa&amp;#64;asus.com&lt;/a&gt;. Voici le mail que je leur ai envoyé le Mardi 16
Juillet :&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bonjour,&lt;/p&gt;
&lt;p&gt;Je viens de faire l'acquisition d'un Ultrabook Asus Zenbook
UX32VD-R4020H.
Je suis très content de cet achat, cependant, je ne souhaite pas
conserver le système d'exploitation Windows 8 qui ne me convient
pas.&lt;/p&gt;
&lt;p&gt;Je n'ai pas encore démarré la machine. Pourriez-vous me donner la
procédure afin d'obtenir le remboursement de la licence Windows 8.&lt;/p&gt;
&lt;p&gt;Vous trouverez la facture d'achat en PJ de cet email.&lt;/p&gt;
&lt;p&gt;Cordialement,&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Le Jeudi 25 Juillet, je recevais une réponse d'Asus avec la procédure à
suivre et les documents à fournir pour me faire rembourser.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bonjour cher client,&lt;/p&gt;
&lt;p&gt;Vous avez sollicité nos services pour demander le remboursement de
la licence OEM Windows 8 liée à votre produit.&lt;/p&gt;
&lt;p&gt;Dans un premier temps je vais vous demander de me fournir tous les
éléments ci-dessous afin de pouvoir constituer votre dossier et
pré-remplir un formulaire qui vous sera ensuite renvoyé pour
signature.&lt;/p&gt;
&lt;p&gt;Merci donc de me fournir par retour de mail :&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Nom et prénom du propriétaire de la machine.&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; N° de téléphone.&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Adresse e-Mail.&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Adresse postale complète.&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; N° de série du produit ASUS (visible sur la carte de
garantie et/ou sous votre machine, sur un autocollant).&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Copie de la facture d’achat.&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Une copie de la page 1 de votre « carte de garantie ASUS
» (fournie avec tous produit ASUS).&lt;/p&gt;
&lt;p&gt;o&amp;nbsp;&amp;nbsp; Cette page contient une étiquette avec un code barre et le n° de
série du produit.&lt;/p&gt;
&lt;p&gt;o&amp;nbsp;&amp;nbsp; Cette page est également à remplir par le propriétaire du
produit.&lt;/p&gt;
&lt;p&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Facultatif : une photo de l’étiquette du produit&amp;nbsp; avec le
numéro de série visible (située sous le produit ou sur le chargeur
du produit) Ces éléments me permettront entre autres d’identifier la
clé de licence Windows 8 liée à votre appareil.&lt;/p&gt;
&lt;p&gt;Une fois ces éléments en ma possession je vous ferais donc parvenir
votre « formulaire de demande de remboursement de la licence
Microsoft » préalablement rempli qu’il vous faudra confirmer, dater
et signer à la main puis me renvoyer par mail ou par courrier postal
(adresse de nos locaux sur les documents joints). Ce premier
document contient : conditions générales, détails de procédures,
formulaire et engagements contractuels.&lt;/p&gt;
&lt;p&gt;Nous tenons cependant à vous signaler que ce document a pour but de
couvrir tous les cas de figure et que de fait, il est possible que
certaines étapes de procédure ou certaines mentions ne soient pas
pertinentes sur votre dossier (exple : le point 2.e des conditions
générales ne concerne pas la plupart de nos dossiers puisque le n°
de RMA est rempli par nos services)&lt;/p&gt;
&lt;p&gt;Je joins a ce courrier le second formulaire, « procédure de paiement
», qui doit impérativement être rempli informatiquement et
signé/daté à la main. En effet ces documents administratifs sont
traités en partie automatiquement et ne peuvent l’être si l’écriture
est manuelle, en revanche pour des raisons légales la signature du
client doit être manuelle.&lt;/p&gt;
&lt;p&gt;Ce formulaire permettra de procéder au remboursement par virement
une fois la procédure dûment remplie et validée par les 2 partis.&lt;/p&gt;
&lt;p&gt;Afin de pouvoir vous assurer un traitement fluide et les meilleurs
délais, nous vous invitons à répondre à nos e-mails au plus vite,
merci également de prendre note que nos services n’effectuerons pas
de relance systématique en cas d’absence de réponse et ne pourront
être tenus responsables en cas d’échec de la procédure pour des
raisons de délais ne pouvant nous être incombés.&lt;/p&gt;
&lt;p&gt;Je reste toutefois à votre disposition pour toute autre information
complémentaire.&lt;/p&gt;
&lt;p&gt;En vous souhaitant une bonne journée.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;La procédure de remboursement semble donc relativement simple. En tout
cas, c'est bien partie.&lt;/p&gt;
&lt;p&gt;En plus de ça, le document à remplir, dans lequel il faut mettre son RIB
(code IBAN et BIC) est fourni au format ODT. Un bon point encore pour
Asus.&lt;/p&gt;
&lt;p&gt;Je vous tiendrai au courant de l'avancement de la procédure via ce blog.&lt;/p&gt;
</content><category term="Tech"></category><category term="asus"></category><category term="Linux"></category><category term="remboursement"></category><category term="windows"></category></entry><entry><title>HP Proliant Support Pack sur RHEL 5</title><link href="https://blog.devarieux.net/2013/07/hp-proliant-support-pack-sur-rhel-5.html" rel="alternate"></link><published>2013-07-23T18:07:00+02:00</published><updated>2013-07-23T18:07:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-07-23:/2013/07/hp-proliant-support-pack-sur-rhel-5.html</id><summary type="html">&lt;p&gt;Dans le cadre de mon travail, je suis en train d'installer et de
configurer un serveur HP System Insight Manager (SIM). Une sorte de
Nagios amélioré pour serveur HP, avec anticipation des pannes matériel.&lt;/p&gt;
&lt;p&gt;Ce serveur SIM nous a permis par exemple de détecter qu'une pile de
cache RAID était …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Dans le cadre de mon travail, je suis en train d'installer et de
configurer un serveur HP System Insight Manager (SIM). Une sorte de
Nagios amélioré pour serveur HP, avec anticipation des pannes matériel.&lt;/p&gt;
&lt;p&gt;Ce serveur SIM nous a permis par exemple de détecter qu'une pile de
cache RAID était en train de lâcher et nous avons donc pu remplacer
cette pile avant que le problème intervienne (pas de cache RAID = temps
d'accès en écriture tout moisi et ça le fait moyen sur un serveur de
sauvegarde).&lt;/p&gt;
&lt;p&gt;Pour que le serveur HPSIM accède aux serveurs qu'il surveille, il faut
installer un agent. Cet agent, c'est HP Proliant Support Pack. Une suite
d'utilitaires et de pilotes pour serveur HP Proliant.&lt;/p&gt;
&lt;p&gt;J'ai donc téléchargé l'iso &lt;a class="reference external" href="http://h18004.www1.hp.com/products/servers/service_packs/en/index.html"&gt;sur le site
d'HP.&amp;nbsp;&lt;/a&gt;Celle
ci contient les utilitaires pour tous les OS supportés (Windows, RedHat,
HP-UX). Une fois l'iso transférée sur le serveur, je la monte :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
mkdir /media/iso
mount -o loop /tmp/fichier.iso /media/iso
&lt;/pre&gt;
&lt;p&gt;Ensuite, c'est l'utilitaire HPSUM qui va s'occuper d'installer les
différents modules et utilitaires.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
cd /media/iso/hp/swpackages/
./hpsum
&lt;/pre&gt;
&lt;p&gt;Cette commande utilise un serveur X.
|  Pour info, la doc complète : &lt;a class="reference external" href="http://bizsupport1.austin.hp.com/bc/docs/support/SupportManual/c03114114/c03114114.pdf"&gt;Guide de l'Utilisateur, HP Smart Update
Manager&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;En suivant les étapes une à une, les packages sont tous compilés et
installés.&lt;/p&gt;
&lt;div class="section" id="aie"&gt;
&lt;h2&gt;Aïe&lt;/h2&gt;
&lt;p&gt;Malheureusement, parfois, tout ne tourne pas rond et dans mon cas,
certains paquets n'ont pas pu être compilés. Les logs montrent un obscur
message de problème de dépendance avec ksym.&lt;/p&gt;
&lt;p&gt;Pour résoudre ce problème et terminer l'installation des paquets, voici
la procédure ;&lt;/p&gt;
&lt;p&gt;Installation des sources :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
cd /media/iso/hp/swpackages/
rpm -ivh &amp;lt;paquet&amp;gt;.src.rpm
rpmbuild -bb /usr/src/redhat/SPECS/&amp;lt;paquet&amp;gt;.spec
rpm -ivh --nodeps /usr/src/redhat/RPMS/&amp;lt;arch&amp;gt;/&amp;lt;paquet&amp;gt;.rpm
&lt;/pre&gt;
&lt;p&gt;On vérifie que le module a bien été installé :&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;::&lt;/dt&gt;
&lt;dd&gt;modinfo &amp;lt;nomdumondule&amp;gt;&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;On charge le module :&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;::&lt;/dt&gt;
&lt;dd&gt;modprobe &amp;lt;nomdumodule&amp;gt;&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Ce qui donne, avec le paquet qla4xxx qui me concernait :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
rpm -ivh hp-qla4xxx-&amp;lt;version&amp;gt;.src.rpm
rpmbuild -bb /usr/src/redhat/SPECS/hp-qla4xxx.spec
rpm -ivh --nodeps /usr/src/redhat/RPMS/x86_64/kmod-hp-qla4xxx-&amp;lt;version&amp;gt;-x86_64.rpm
modprobe qla4xxx
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="explication"&gt;
&lt;h2&gt;Explication&lt;/h2&gt;
&lt;p&gt;Les RPM utilisent les dépendances de KMP (Kernel Module Packaging) pour
s'assurer que les binaires RPM puissent être installés. Red Hat
maintient une liste blanche de&amp;nbsp;&lt;em&gt;kernel symbols&lt;/em&gt; (ksym donc) que les
RPM utilisent. Certains de ses symboles peuvent être dans le kernel mais
pas dans la liste blanche. Le résultat est que certains RPM, qui y font
référence, ne peuvent pas être installés.&lt;/p&gt;
&lt;p&gt;L'utilisateur doit donc utiliser l'option &amp;quot;--nodeps&amp;quot; lors de
l'installation des binaires.&lt;/p&gt;
&lt;p&gt;La paquet qla4xxx utilisent les symboles suivant sur RHEL 5 qui ne sont
pas dans la liste blanche ;&lt;/p&gt;
&lt;p&gt;ksym(kobject_uevent_env) ksym(iscsi2_session_chkready)
ksym(pci_get_domain_bus_and_slot)&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="HPSIM"></category><category term="hpsum"></category><category term="insight manager"></category><category term="ksym"></category><category term="proliant support pack"></category><category term="psp"></category><category term="redhat"></category></entry><entry><title>Comment vais-je me passer des services de Google?</title><link href="https://blog.devarieux.net/2013/06/comment-vais-je-me-passer-des-services-de-google.html" rel="alternate"></link><published>2013-06-26T21:31:00+02:00</published><updated>2013-06-26T21:31:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2013-06-26:/2013/06/comment-vais-je-me-passer-des-services-de-google.html</id><summary type="html">&lt;p&gt;Ça faisait quand même un moment qu'on s'en doutait, Snowden nous l'a
confirmé. Tous les plus grands services en ligne américains mettent
quasi à disposition les données qu'ils possèdent sur leurs utilisateurs
aux services gouvernementaux des USA. Cela pose plusieurs problèmes.
Certains sont d'ordre individuel, d'autres d'ordre politique,
économique, diplomatique …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Ça faisait quand même un moment qu'on s'en doutait, Snowden nous l'a
confirmé. Tous les plus grands services en ligne américains mettent
quasi à disposition les données qu'ils possèdent sur leurs utilisateurs
aux services gouvernementaux des USA. Cela pose plusieurs problèmes.
Certains sont d'ordre individuel, d'autres d'ordre politique,
économique, diplomatique voir même en exagérant un peu, pose un problème
de civilisation.&lt;/p&gt;
&lt;p&gt;Individuellement, je ne suis pas vraiment d'accord à ce que des gens,
auxquels je n'ai pas donné accès à mes données, puissent les consulter
sans mon avis. Je n'ai rien à cacher, mais ce n'est pas non plus une
raison pour que je partage mon agenda avec n'importe qui et qu'il puisse
voir la date, l'heure et le lieu de mon RDV avec mon proctologue.&lt;/p&gt;
&lt;p&gt;Et même si je n'ai rien à cacher, je n'ai pas non plus envie qu'en cas
de problème avec les autorités mes communications et
agissements&amp;nbsp;électroniques&amp;nbsp;puissent être utilisé contre moi. J'utilise
actuellement les services suivant chez Google, très pratique parce
qu'ils sont synchronisé avec mon smartphone Android : Gmail, Google+,
Agenda, Drive, Maps. Autant dire que ma vie est stockée sur les serveurs
de Google, quelque part dans les nuages.&lt;/p&gt;
&lt;p&gt;Le récent&amp;nbsp;scandale&amp;nbsp;PRISM m'a fait mettre le nez dans ma propre merde.
Grand défenseur des LL, je me suis laissé happer par la facilité
d'utilisation des services de Google. D'un autre coté, je ne veux pas
non plus&amp;nbsp;disparaître&amp;nbsp;des radars sur Internet pour la simple et bonne
raison que je veux&amp;nbsp;contrôler&amp;nbsp;mon identité en ligne. Je ne veux pas que
ce soit les autres qui décident des liens qui ressortiront sur Google
lorsqu'on y tape mon nom. Pour cela, il faut que je contrôle ma présence
en ligne. Le blog est donc là pour ça.&lt;/p&gt;
&lt;p&gt;Économiquement, j'imagine que les grandes entreprises françaises ainsi
que certaines plus petites mais&amp;nbsp;innovantes et qui utilisent activement
les services de Google, Yahoo ou même le cloud d'Amazon&amp;nbsp;pour les
entreprises doivent être en train de&amp;nbsp;serrer&amp;nbsp;les fesses. Il devient
facile pour la NSA et la CIA de faire de l'espionnage à
grande&amp;nbsp;échelle&amp;nbsp;et à peu de frais (théorie du complot powered).&lt;/p&gt;
&lt;p&gt;La question qui se pose maintenant, c'est de savoir comment sortir de
tous ces services. Tant qu'on n'entre pas dans les prisons dorées de
Google ou Apple, il est relativement aisé de trouver des solutions
alternatives. Par contre, une fois qu'on y a mis les 2 pieds, ça devient
plus compliqué d'en sortir parce qu'il est nécessaire de migrer toutes
les données correctement et surtout ne rien oublier.&lt;/p&gt;
&lt;p&gt;Pour ma part, j'ai la chance d'avoir un bagage technique qui me permet
de savoir mettre en place et gérer un serveur. La solution passera donc
certainement par Owncloud pour tout ce qui concerne l'agenda, les
contacts, le stockage de photos. Pour les mails, ça se complique, j'en
ai déjà fait&amp;nbsp;l’expérience. J'ai essayé d'envoyer quelques mails avec mon
ancien domaine (aldevar.fr). Ceux ci finissaient souvent dans la boite à
spam de mes destinataires. En plus de ça, même si j'arrive à régler ce
problème, la très grande majorité de mes contacts utilisent Gmail ainsi
que des smartphones Android. Donc, même si je décide de supprimer mes
données perso des serveurs de Google, le géant du web aura toujours mes
données&amp;nbsp;grâce&amp;nbsp;à mes amis qui synchronisent leurs contacts
et&amp;nbsp;reçoivent&amp;nbsp;mes emails.&lt;/p&gt;
&lt;p&gt;Ouais, je sais, c'est&amp;nbsp;ballot...&lt;/p&gt;
</content><category term="Humeur"></category><category term="google"></category><category term="owncloud"></category><category term="prism"></category><category term="snowden"></category></entry><entry><title>Good Bye Bouygues Telecom</title><link href="https://blog.devarieux.net/2012/11/good-bye-bouygues-telecom.html" rel="alternate"></link><published>2012-11-02T16:00:00+01:00</published><updated>2012-11-02T16:00:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2012-11-02:/2012/11/good-bye-bouygues-telecom.html</id><summary type="html">&lt;p&gt;Cela faisait quelques temps que je souhaitais quitter Bouygues Telecom
pour la téléphonie. En fait, c'est surtout depuis l'arrivée de Free et
ses forfaits à 20€. J'étais toujours engagé chez eux jusqu'à Aout 2013,
il m'était donc difficile, financièrement parlant, de partir comme ça.&lt;/p&gt;
&lt;div class="section" id="demenagement-sur-les-dents"&gt;
&lt;h2&gt;Déménagement sur les dents&lt;/h2&gt;
&lt;p&gt;J'avais en …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Cela faisait quelques temps que je souhaitais quitter Bouygues Telecom
pour la téléphonie. En fait, c'est surtout depuis l'arrivée de Free et
ses forfaits à 20€. J'étais toujours engagé chez eux jusqu'à Aout 2013,
il m'était donc difficile, financièrement parlant, de partir comme ça.&lt;/p&gt;
&lt;div class="section" id="demenagement-sur-les-dents"&gt;
&lt;h2&gt;Déménagement sur les dents&lt;/h2&gt;
&lt;p&gt;J'avais en plus groupé mon forfait téléphone et Internet chez eux, avec
une offre BBox Fibre. Donc, lors de mon déménagement en Septembre 2012
et puisque leur offre Fibre fonctionnait plutôt bien dans l'ensemble,
j'ai procédé au déménagement de ma ligne Fibre à ma nouvelle adresse,
non sans les avoir appelés 3 fois avant afin de m'assurer que mon
nouveau logement était bien relié à la fibre. &amp;quot;Oui oui&amp;quot; m'a t'on dit à
plusieurs reprises.&lt;/p&gt;
&lt;p&gt;Ainsi, le 24 Septembre, un technicien devait se présenter pour nous
raccorder. Le technicien n'est pas venu (classique). J'ai pris ma plus
grosse voix pour appeler le service client et demander des explications
: &amp;quot;Ha mais vous n'êtes pas relié à la fibre monsieur, le rendez-vous à
été annulé le 16 Septembre&amp;quot;.&lt;/p&gt;
&lt;p&gt;Ok, donc merci de m'avoir prévenu pour le rendez-vous annulé, ça fait
plaisir...! À la place de l'offre fibre, j'ai donc droit à une offre
imbattable de 4Mb/s à la place des 100Mb/s que j'avais avant. Et
attention, je ne paierais même pas plus cher, ils me le font
gracieusement au même prix... Ahem... Comment vous dire...? Je pense
plutôt que je vais résilier mon offre Internet Fibre et aller chez
Numéricable.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="choisir-un-nouveau-forfait-telephone"&gt;
&lt;h2&gt;Choisir un nouveau forfait téléphone&lt;/h2&gt;
&lt;p&gt;Puisque je quittais l'offre Bbox, il me fallait choisir un forfait de
téléphonie. Je pensais pouvoir simplement revenir vers l'offre que j'ai
toujours eu, soit 2h d'appel + appels illimités le soir + sms illimité +
3G avec 2Go de fair use. Pour environ 35€ par mois avec smartphone
subventionné.&lt;/p&gt;
&lt;p&gt;Malheureusement, ce type de forfait n'existe plus et j'avais le choix
entre une offre 'Tout illimité + 3Go de fair use à 42Mbps' à 60€ ou une
offre avec 'Tout illimité + 500Mo de fair use à 7.2Mbps'. Je consomme un
peu plus de 1.5Go de data par mois sur mon Nexus S, donc il me fallait
une offre avec au moins 3Go de data. Cela signifiait payer 60€ par mois,
juste pour le téléphone alors que c'est ce que je payais avant pour
Téléphone + Internet Fibre.&lt;/p&gt;
&lt;p&gt;Il me restait un peu moins d'un an d'engagement. Je me suis donc dit que
c'était le bon moment pour partir à moindre frais.&lt;/p&gt;
&lt;p&gt;J'ai choisi l'offre Eden 1h. Pas de data, pas de SMS, rien. Juste 1h
d'appel. De suite après avoir souscris à ce mini forfait, je me suis
rendu sur le site de B&amp;amp;You pour faire l'acquisition d'une nouvelle carte
SIM avec un forfait tout illimité à 20€. La somme que je dois à Bouygues
pour pouvoir partir est donc de (14€ x 10 mois)/3 = 35€. Somme remboursé
en 1 mois.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="et-maintenant"&gt;
&lt;h2&gt;Et maintenant?&lt;/h2&gt;
&lt;p&gt;Bon, oui, je vais maintenant devoir acheter moi même mes smartphones.&lt;/p&gt;
&lt;p&gt;Ici aussi, faisons un rapide calcul.&lt;/p&gt;
&lt;p&gt;Avec le forfait à 60€ de chez Bouygues et smartphone subventionné,
j'aurais payé à l'année, smartphone non compris : &lt;strong&gt;60*12 = 720€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Avec le forfait à 20€ de chez B&amp;amp;You et un smartphone à 349€ (par
exemple, le LG Nexus 4 16G), cela me fera à l'année : &lt;strong&gt;20*12 + 349 =
589€&lt;/strong&gt; (En considérant que je change de smartphone une fois par an, ce
qui n'est pas le cas. (bon ok, je change tous les 18 mois...)).&lt;/p&gt;
&lt;p&gt;J'économise donc environ &lt;strong&gt;130€&lt;/strong&gt;, sans compter que chez Bouygues et son
forfait à 60€, il faut au minimum débourser 50 ou 80€ pour un smartphone
dernier cri subventionné.&lt;/p&gt;
&lt;p&gt;Quand je pense qu'on s'est fait pigeonner (pour le dire poliment)
pendant toutes ses années...&lt;/p&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="B&amp;amp"></category><category term="You, Bouygues, fibre, forfait, Free, internet"></category></entry><entry><title>To bulle or not to bulle</title><link href="https://blog.devarieux.net/2012/05/to-bulle-or-not-to-bulle.html" rel="alternate"></link><published>2012-05-22T19:39:00+02:00</published><updated>2012-05-22T19:39:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2012-05-22:/2012/05/to-bulle-or-not-to-bulle.html</id><summary type="html">&lt;p&gt;On s'y attendait plus ou moins, les investisseurs n'ont pas vraiment
confiance, pour l'instant en tout cas, en Facebook et sa capacité à
générer des revenus. Le titre FB a eu du mal à se maintenir pour son
premier jour de cotation Vendredi 18 Mai puis a dévissé complètement le …&lt;/p&gt;</summary><content type="html">&lt;p&gt;On s'y attendait plus ou moins, les investisseurs n'ont pas vraiment
confiance, pour l'instant en tout cas, en Facebook et sa capacité à
générer des revenus. Le titre FB a eu du mal à se maintenir pour son
premier jour de cotation Vendredi 18 Mai puis a dévissé complètement le
Lundi 21 en perdant plus de 11&amp;nbsp;% de sa valeur d'introduction. Cependant,
tout n'est pas aussi simple qu'il n'y paraît.&lt;/p&gt;
&lt;p&gt;Les libristes crient victoire à coup de «&amp;nbsp;Je vous l'avais bien dit&amp;nbsp;»
mais la raison de la déroute du titre au NASDAQ n'est pas uniquement
liée à la confiance que peux générer la société de Paolo Alto. En effet,
la banque d'investissement Morgan Stanley, qui a géré en grande partie
l'introduction en bourse, a joué la gourmande en demandant une
introduction du prix du titre à 38USD, après un prix d'achat la veille à
34USD. Las&amp;nbsp;! Les acheteurs potentiels n'ont pas suivi, estimant ce prix
bien trop élevé par rapport à la valeur supposée de Facebook.&lt;/p&gt;
&lt;p&gt;L'action s'est difficilement maintenue à 38USD Jeudi grâce aux
perfusions de Morgan Stanley, qui a racheté les titres en vente avant la
fin de clôture afin de maintenir artificiellement l'action au prix
d'introduction, pour la modique somme de 2 milliards de $. Bien sûr, la
banque ne pouvait conserver une telle stratégie éternellement et le
lendemain, c'était la déroute avec 11&amp;nbsp;% de perte, alors que les autres
valeurs technologique (Google et Apple notamment) se maintenaient ou
progressaient.&lt;/p&gt;
&lt;p&gt;A l'origine de tout cela, la banque avait décidé d'augmenter le nombre
de titre en vente, fournissant à certains de ses investisseurs jusqu'à
40&amp;nbsp;% de titre en plus que ce qu'ils avaient demandé. La réaction ne
s'est donc pas faite attendre et ceux-ci ont rapidement remis en vente
les titres en trop, ce qui explique en grande partie un tel fiasco pour
l'action FB.&lt;/p&gt;
&lt;p&gt;A l'heure où j'écris ces lignes, peu de temps avant la cloture du marché
US, le titre perd 2&amp;nbsp;% alors qu'il en perdait encore 4,5&amp;nbsp;% il y a moins
d'une heure. Cette remontée (ou cette limitation des pertes) est encore
sans doute due à des rachats d'urgence par les banques ayant gérées
cette introduction en bourse.&lt;/p&gt;
&lt;p&gt;Comment alors essayer de comprendre ce que peut valoir l'entreprise
Facebook&amp;nbsp;? Pour l'instant cela est très compliqué car seulement basé sur
des spéculations pures. Nous avons l'habitude de voir en Facebook une
boite noire ne dévoilant que très peu de chiffre, notamment concernant
ses revenus. Mais tout cela va changer car cette introduction en bourse
oblige Facebook à publier ses résultats détaillés régulièrement. Nous
allons enfin savoir comment Facebook gagne son argent et surtout quelle
proportion de cet argent est gagné par la publicité ciblée. C'est
seulement à partir de ce moment que nous pourrons juger de la pérénité
de son modèle économique.&lt;/p&gt;
&lt;p&gt;Seulement voilà, ceux qui lisent ces lignes savent en majorité de quoi
est fait l'internet. Les enseignes vont et viennent. Myspace, skyblog ne
sont déjà plus que de lointain souvenir. Facebook is so 2007. Valoriser
la société à hauteur de 100 milliards de $ (soit un chiffre astronomique
de 133$ par utilisateur comme le &lt;a class="reference external" href="http://frederic.bezies.free.fr/blog/?p=7511"&gt;relève si bien frédéric
Bezies&lt;/a&gt;)est un pari
risqué. Cela nous rappel les heures sombres de l'internet et la bulle du
début des années 2000. Plus que les 100 Millards de Facebook, le chiffre
qui pour moi représente le plus le risque d'une nouvelle bulle, c'est le
rachat, toujours par Facebook, décidemment dans tous les bons coups,
d'Instagram pour 1 Millards. Rappelons juste qu'Instagram génère 0€ de
chiffre (en dollars, ça fait 0 aussi, ainsi qu'en pesos ou en rouble).&lt;/p&gt;
&lt;p&gt;Les trentenaires et les quarantenaires sont actuellement tous ou presque
sur Facebook. Leurs enfants devraient en toute logique fuir ce réseau à
moins que Zuckerberg trouve une solution miracle pour contourner cette
obsolescence programmée. Google a trouvé la solution en se diversifiant
à outrance et en proposant une multitude de services extrêmement
pratique. Facebook a un autre défi à relever, les plus grands étant de
se détacher de son image de réseau social et surtout de capitaliser sur
ces utilisateurs.&lt;/p&gt;
&lt;p&gt;La pub sur intenet ne fonctionne pas. Ce n'est pas moi qui le dit.
Général Motor a en effet décidé de retirer ses publicités de Facebook à
cause d'un retour sur investissement trop faible. Pas étonnant. Les
utilisateurs ont pris l'habitude de contourner visuellement les
publicités, que ce soit avec ou sans filtre publicitaire. D'autant plus
que les pubs sont toujours affichées aux mêmes endroits. Quand on
fréquente un site 2 ou 3h par jour, on prend vite le reflex de ne pas
'voir' ces emplacements.&lt;/p&gt;
&lt;p&gt;Les services gratuits ont donc du mal à trouver des modèles économiques
viables sur le long terme. Comme lors de la première bulle. Cette fois
ci, les investisseurs sont plus prudent. L'introduction en bourse de
Facebook a permis d'ouvrir les yeux sur le risque de cette nouvelle
bulle. Plutôt que d'investir des quantités astronomiques d'argent dans
des startups, celle-ci sont rachetées par les grands groupes que sont
Facebook, Google, Apple, Microsoft, IBM, Intel et compagnie afin
d'acquérir leurs technologies.&lt;/p&gt;
&lt;p&gt;Le danger actuel se situe peut être plus dans les guerres stériles de
brevets, qui font perdre du temps, de l'argent et empêchent les petites
startups de se développer sur les idées novatrices. Ceci risque de
nécroser le developpement du net et ralentir son developpement. Cette
problématique mériterait un article dédié, nous en reparlerons donc dans
un prochain billet.&lt;/p&gt;
</content><category term="Humeur"></category><category term="bulle"></category><category term="économie"></category><category term="facebook"></category><category term="finance"></category></entry><entry><title>Lettre ouverte à Google</title><link href="https://blog.devarieux.net/2011/08/lettre-ouverte-a-google.html" rel="alternate"></link><published>2011-08-11T10:22:00+02:00</published><updated>2011-08-11T10:22:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2011-08-11:/2011/08/lettre-ouverte-a-google.html</id><summary type="html">&lt;p&gt;Cher Google,&lt;/p&gt;
&lt;p&gt;Je me souviens encore de notre première rencontre il y a une douzaine
d’années.&lt;/p&gt;
&lt;p&gt;Douze ans, dans l’informatique, c’est long. Sur Internet c’est même une
éternité! En douze ans, nous somme passé du 56kb au 100Mb (1700 fois
plus rapide!!), des pages persos avec …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Cher Google,&lt;/p&gt;
&lt;p&gt;Je me souviens encore de notre première rencontre il y a une douzaine
d’années.&lt;/p&gt;
&lt;p&gt;Douze ans, dans l’informatique, c’est long. Sur Internet c’est même une
éternité! En douze ans, nous somme passé du 56kb au 100Mb (1700 fois
plus rapide!!), des pages persos avec fond d’écran Matrix aux sites
‘régie&amp;nbsp;publicitaire’, des frames et tableaux au CSS et HTML5 etc. Quels
sont les sites que j’utilisais en 1999 et que j’utilise encore
maintenant? Caramail? Multimania? Voilà? Ahem… Non en fait, à part toi,
il n’y en a pas.&lt;/p&gt;
&lt;p&gt;A la rentrée scolaire 1999 donc, un professeur m’avait parlé de toi. Je
dois avouer que je suis de suite tombé amoureux de ton interface. Quelle
sobriété! Quelle efficacité! Un logo, une zone de saisie, un bouton.
Avec mon modem RTC c’était un vrai plaisir à utiliser. Et surtout, quand
je faisais une recherche, j’avais les réponses que j’attendais. Je me
demandais même comment d’autres pouvaient encore utiliser Lycos (qu’est
devenu ce beau labrador noir d’ailleurs?), Altavista, Yahoo et
compagnie. Enfin bref, j’étais comblé.&lt;/p&gt;
&lt;p&gt;Aujourd’hui encore, je ne &amp;nbsp;vois pas comment je pourrais me passer de ton
moteur de recherche. Il est devenu un&amp;nbsp;réflexe, il est &lt;a class="reference external" href="https://web.archive.org/web/20120418043655/http://www.slate.fr/story/41367/google-memoire"&gt;ma
mémoire&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;En 2004, tu m’as surpris en te diversifiant. Gmail est arrivé. J’ai
obtenu rapidement une invitation, j’étais content. Voilà donc 8 ans que
Gmail est ma messagerie principale. Pourtant, j’utilisais Hotmail qui me
convenait parfaitement… Enfin… sauf pour les spams, la lenteur de
l’interface et le fait que ce soit du Microsoft. J’avais déjà migré
depuis 2 ans sur GNU/Linux donc je n’étais pas mécontent de me
débarrasser définitivement de cette adresse email. Au niveau du tri du
spam, y’a pas à tortiller, tu étais vraiment le meilleur et de loin.&lt;/p&gt;
&lt;p&gt;J’apprécie aussi le fait que tu n’ais jamais changé brutalement. Tes
interfaces ont évolué, petit à petit, discrètement, sans jamais être
révolutionnées et ainsi perdre les utilisateurs qui ont vite fait de ne
plus savoir où cliquer.&lt;/p&gt;
&lt;p&gt;Dorénavant, mon smartphone est également propulsé&amp;nbsp;grâce&amp;nbsp;à toi. Tu
m’envoies mes mails instantanément, tu me géolocalises, tu me permets
d’accéder à certaines informations dont je n’avais auparavant accès
qu’en étant chez moi. Maintenant, dans le train, le temps passe plus
vite. Je blogue, je commente, je discutes, je lis les dernières news,
tout ça en me déplaçant. La fonction top moumoute étant quand même la
synchronisation des contacts entre mon téléphone et Gmail.&lt;/p&gt;
&lt;p&gt;J’ai mis du temps à me mettre aux flux RSS. Si il y a bien une
technologie où je ne suis pas un&lt;em&gt;early adopter&lt;/em&gt;, c’est celle là. J’ai
commencé par utiliser un client lourd (liferea), puis je me suis rendu
compte que ce n’était pas pratique du tout puisque quand je rentrais
chez moi le soir, je retrouvais dans mon application les mêmes articles
que j’avais déjà lu dans la journée. Je suis donc passé à… Google
Reader. C’est vrai qu’il y a moult solutions équivalentes que je n’ai
pas pris la peine de tester par&amp;nbsp;flemmardise.&lt;/p&gt;
&lt;p&gt;Le 1er Juillet j’obtenais mon invitation pour Google+. Enfin un réseau
social qui me convient! Bon… Diaspora* aurait pu faire l’affaire mais
les méthodes de développement employées et la lenteur de l’interface
m’ont fait abandonner le projet malgré l’engouement initial.
Contrairement à Facebook, j’ai enfin l’impression de&amp;nbsp;maîtriser&amp;nbsp;mon
identité numérique. Peu à peu, mes amis m’y rejoignent, l’activité qui y
règne est&amp;nbsp;enthousiasmante et surtout la masse de boulets n’a pas encore
débarqué (ce qui arrivera bien un jour où l’autre).&lt;/p&gt;
&lt;p&gt;Alors quoi? Je t’aurais écrit cette lettre juste pour lister les
services que tu me proposes et que j’utilise? &amp;nbsp;Non bien sûr!&lt;/p&gt;
&lt;p&gt;Mon cher Google, tu es devenu petit à petit mon interface d’accès au
web. Tu connais tout de moi, ce que je fais, où je vais, ce que j’aime,
ce que je découvre. Tu possèdes les clés de mon identité. Je sais
comment tu utilises ces données et pour l’instant, cela me convient. Je
te fais confiance pour à l’avenir ne pas utiliser ces données à des fins
moins glorieuses. Je te fais confiance pour&amp;nbsp;reconnaître&amp;nbsp;tes erreurs
quand tu en commettras, comme tu l’as déjà fait par le passé. Pour tout
cela, moi et tous les autres utilisateurs seront vigilant afin que le
pire ne se produise pas.&lt;/p&gt;
</content><category term="Humeur"></category></entry><entry><title>Le web 2.0 est-il une idiocratie?</title><link href="https://blog.devarieux.net/2011/07/le-web-2-0-est-il-une-idiocratie.html" rel="alternate"></link><published>2011-07-24T19:37:00+02:00</published><updated>2011-07-24T19:37:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2011-07-24:/2011/07/le-web-2-0-est-il-une-idiocratie.html</id><summary type="html">&lt;p&gt;Comme moi, vous venez peut-être d'une génération qui a grandi en ligne
avant le boom des réseaux sociaux. Internet était alors une chambre
secrète que peu de personnes avaient visité. Nous trollions avant que ce
soit appelé 'troller' et nous le faisions plus pour l'exercice
intellectuel que pour se divertir …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Comme moi, vous venez peut-être d'une génération qui a grandi en ligne
avant le boom des réseaux sociaux. Internet était alors une chambre
secrète que peu de personnes avaient visité. Nous trollions avant que ce
soit appelé 'troller' et nous le faisions plus pour l'exercice
intellectuel que pour se divertir. Une de mes premières expériences
enrichissantes venant d'Internet était un logiciel qui permettait de
voir et d'envoyer des emails sur les newsgroups. L'activité qui y
régnait était très enrichissante et c'est sans doute cette expérience là
qui m'a poussé à me diriger vers l'informatique.&lt;/p&gt;
&lt;p&gt;Je me rappelle les discussions enflammées sur les chatrooms. ASV les
gens? Évidemment, ce n'était qu'une question de temps avant que 'le
peuple' ne débarque en masse sur le réseau. En attendant, je me faisais
mes premiers 'amis internet'. Nous n'avions pas ou très peu d'ami IRL
avec qui discuter sur le net.&lt;/p&gt;
&lt;p&gt;Pas mal de monde considère que Myspace représente la chute d'Internet et
ils n'ont pas tout à fait tort. Il faut avouer que Myspace était plutôt
sympa et permettait de rencontrer pas mal de musiciens. Ceux-ci
pouvaient recevoir des avis/critiques sur leurs musiques. Quand Myspace
a commencé à mourir, il n'y avait plus cette communauté centrale pour
les musiciens. Ce qui s'en approche le mieux aujourd'hui est sans doute
&lt;a class="reference external" href="http://www.soundcloud.com/"&gt;Soundcloud&lt;/a&gt;. Myspace a ouvert les vannes
de l'Internet à pas mal d'idiots. Difficile de nier qu'avec la création
de Myspace le QI général des internautes a subit une forte chute.&lt;/p&gt;
&lt;p&gt;L'internet devenait une sorte de centre commercial fantaisiste, avec
pleins d'icônes dégueulasses et de lumières clignotantes. Avec la
création de Twitter, le web2 entamait sa création. Est arrivé Facebook
qui a définitivement tué Myspace et qui a introduit les apps. Mais
Facebook s'est vite transformé en la peur que nous avons tous de la
'conspiration Orwellienne'. Avec l'avènement de l'Iphone et d'Android,
Facebook est devenu une sorte de passage obligé vers le monde numérique.
Un peu comme AOL a pu l'être pendant un temps.&lt;/p&gt;
&lt;p&gt;Il y a un espoir que Google+ mette fin à ce monopole de Facebook sur les
réseaux sociaux. Je ne pense pas que G+ fasse tant que ça de concurrence
à Twitter. Le réseau de microblogging a beaucoup participé à faire de
l'Internet une affaire populaire et je pense qu'il va encore vivre
longtemps. Peut-être que je me trompe et qu'Internet n'est pas devenu
une idiocratie comme cela semble être le cas avec Facebook. En tant que
personnes ayant utilisé Internet dans ses premiers jours, nous avons
grandi, mûri, et nous devons utiliser nos connaissances numériques pour
accompagner une nouvelle génération.&lt;/p&gt;
</content><category term="Humeur"></category><category term="google"></category><category term="idiot"></category><category term="myspace"></category><category term="soundcloud"></category><category term="web"></category></entry><entry><title>RHEL 5.5 et chipset broadcom BCM5709</title><link href="https://blog.devarieux.net/2010/06/rhel-5-5-et-chipset-broadcom-bcm5709.html" rel="alternate"></link><published>2010-06-28T19:36:00+02:00</published><updated>2010-06-28T19:36:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2010-06-28:/2010/06/rhel-5-5-et-chipset-broadcom-bcm5709.html</id><summary type="html">&lt;p&gt;Nous avons récemment installé une nouvelle machine qui sert de serveur
principal pour notre nouveau système de sauvegarde. Lors des tests des
sauvegardes complètes du week end, le chipset réseau du serveur
s'écroulait lamentablement sous la charge du nombre de paquets qui
arrivaient. Même si le réseau semblait toujours fonctionnel …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Nous avons récemment installé une nouvelle machine qui sert de serveur
principal pour notre nouveau système de sauvegarde. Lors des tests des
sauvegardes complètes du week end, le chipset réseau du serveur
s'écroulait lamentablement sous la charge du nombre de paquets qui
arrivaient. Même si le réseau semblait toujours fonctionnel (service
réseau lancé, ifconfig ne signal rien d'anormal), la machine était
injoignable et ne répondait pas au ping. Dans certains cas, un
redémarrage du service réseau ne suffit pas à retrouver une
connectivité.&lt;/p&gt;
&lt;p&gt;A l'heure où la sauvegarde s'arrêtait, voici ce qu'on pouvait trouver
dans /var/log/messages :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
server1 kernel: NETDEV WATCHDOG: eth0: transmit timed out
server1 kernel: bnx2: eth0 NIC Copper Link is Down
&lt;/pre&gt;
&lt;p&gt;La résolution du problème passe par une mise à jour du pilote. On trouve
le pilote pour ce chipset à cette page :
&lt;a class="reference external" href="http://www.broadcom.com/support/ethernet_nic/netxtremeii.php"&gt;http://www.broadcom.com/support/ethernet_nic/netxtremeii.php&lt;/a&gt; Après avoir
extrait l'archive, on installe les sources :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
rpm -ivh netxtreme2-&amp;lt;version&amp;gt;.src.rpm
&lt;/pre&gt;
&lt;p&gt;Installation de kernel-devel pour pouvoir compiler les sources du
pilotes :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
yum install kernel-devel
&lt;/pre&gt;
&lt;p&gt;Construction du paquet :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
cd /usr/src/redhat
rpm -bb SPECS/netxtreme2.spec
&lt;/pre&gt;
&lt;p&gt;Installation du paquet fraichement installé :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
rpm -ivh RPMS/&amp;lt;arch&amp;gt;/netxtreme2-&amp;lt;version&amp;gt;.&amp;lt;arch&amp;gt;.rpm
&lt;/pre&gt;
&lt;p&gt;déchargement de l'ancien module :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
rmmode bnx2
&lt;/pre&gt;
&lt;p&gt;Chargement du nouveau module :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
modprobe bnx2
&lt;/pre&gt;
&lt;p&gt;Suite à cette petite manipulation, plus de soucis de chipset réseau qui
ne répond plus. Problème résolu :D&lt;/p&gt;
</content><category term="Tech"></category><category term="broadcom"></category><category term="Linux"></category><category term="pilote"></category><category term="Red hat"></category><category term="réseau"></category></entry><entry><title>QRQVB : Protocole TCP</title><link href="https://blog.devarieux.net/2010/02/qrqvb-protocole-tcp.html" rel="alternate"></link><published>2010-02-02T07:00:00+01:00</published><updated>2010-02-02T07:00:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2010-02-02:/2010/02/qrqvb-protocole-tcp.html</id><summary type="html">&lt;p&gt;Nouvelle QRQVB et pas des moindres, le protocole TCP (Transmission
Control Protocol, Protocole de Contrôle de Transmission). &amp;nbsp;Comme son
petit frère UDP, TCP se situe en couche 4 du &lt;a class="reference external" href="https://web.archive.org/web/20110919035256/http://blog.aldevar.fr/?p=232"&gt;modèle
OSI&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="caracteristique-de-tcp"&gt;
&lt;h2&gt;Caractéristique de TCP&lt;/h2&gt;
&lt;p&gt;TCP est bien plus compliqué qu’UDP examiné au &lt;a class="reference external" href="https://web.archive.org/web/20110919035256/http://blog.aldevar.fr/?p=493"&gt;chapitre
précédent&lt;/a&gt;.
Il apporte en contrepartie des …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Nouvelle QRQVB et pas des moindres, le protocole TCP (Transmission
Control Protocol, Protocole de Contrôle de Transmission). &amp;nbsp;Comme son
petit frère UDP, TCP se situe en couche 4 du &lt;a class="reference external" href="https://web.archive.org/web/20110919035256/http://blog.aldevar.fr/?p=232"&gt;modèle
OSI&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="caracteristique-de-tcp"&gt;
&lt;h2&gt;Caractéristique de TCP&lt;/h2&gt;
&lt;p&gt;TCP est bien plus compliqué qu’UDP examiné au &lt;a class="reference external" href="https://web.archive.org/web/20110919035256/http://blog.aldevar.fr/?p=493"&gt;chapitre
précédent&lt;/a&gt;.
Il apporte en contrepartie des services beaucoup plus élaborés.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;TCP contient un mécanisme pour assurer &lt;strong&gt;le bon acheminement des
données&lt;/strong&gt;. Cette possibilité est absolument indispensable dès lors
que les applications doivent transmettre de gros volumes de données
de façon fiable. Cette fonction est assurée par un mécanisme
d’acquittement (ou accusé de réception). Les paquets de données sont
acquittés de bout en bout et non de point à point. C’est à dire que
ce sont les machines sources et machines de destinations qui
s’occupent de cela et non les routeurs qui se situent entre les 2.&lt;/li&gt;
&lt;li&gt;Le protocole TCP permet l’établissement d’un &lt;strong&gt;circuit virtuel&lt;/strong&gt;
entre les 2 machines qui échangent de l’information (Voir a ce propos
le &lt;a class="reference external" href="https://web.archive.org/web/20110919035256/http://blog.aldevar.fr/?p=528#comment-757"&gt;commentaire de
Guizmo.7&lt;/a&gt;).
On dit aussi que TCP &amp;nbsp;fonctionne en &lt;strong&gt;mode connecté&lt;/strong&gt; (par opposition
à UDP qui est en mode non connecté). En pratique, l’une des 2 machine
doit effectuer un appel que l’autre doit accepter. S’en suit une
discutions afin d’établir certains paramètres de communication. Une
fois les préliminaires terminés, les protocoles informent les
applications respectives que la connexion est établie et que le
transfert peut débuter. Durant le transfert, le dialogue entre les
protocoles continue, pour vérifier le bon acheminement des données.&lt;/li&gt;
&lt;li&gt;TCP a la capacité de &lt;strong&gt;mémoriser les données&lt;/strong&gt;. Les paquets pouvant
prendre chacun un chemin différent pour arriver à destination, il
arrive que ceux ci n’arrivent pas dans le bon ordre. Grâce à cette
capacité de mémorisation, TCP garde les paquets un certains temps et
les reconstitue lorsqu’ils sont tous arrivés afin de présenter les
données à l’application.&lt;/li&gt;
&lt;li&gt;TCP simule une connexion en &lt;strong&gt;«&amp;nbsp;full duplex&amp;nbsp;»&lt;/strong&gt;. Pour chacune des 2
machines en connexion, l’opération qui consiste à lire des données
peut s’effectuer indépendamment de celle qui consiste à en écrire.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="entete-tcp"&gt;
&lt;h2&gt;Entête TCP&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/enteteTCP1.png"&gt;&lt;img alt="enteteTCP1" src="/images/enteteTCP1.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;L’entête TCP est codé sur 20 octets hors options.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Port Source (16 bits): Port utilisé par l’application sur la machine
source.&lt;/li&gt;
&lt;li&gt;Port Destination (16 bits): Port de destination.&lt;/li&gt;
&lt;li&gt;Numéro d’ordre (32 bits): Correspond au numéro du paquet. Cette
valeur permet de situer à quel endroit du flux de données le paquet,
qui est arrivé, doit se situer par rapport aux autres paquets.&lt;/li&gt;
&lt;li&gt;Numéro d’accusé de réception (32 bits):&amp;nbsp;Acquittement pour les paquets
reçus. Cette valeur signale le prochain numéro de paquet attendu. Par
exemple, si il vaut 1500, cela signifie que tous les datagrammes
&amp;lt;1500 ont été reçus&lt;/li&gt;
&lt;li&gt;Offset (4 bits): Le champ Offset est codé sur 4 bits et définit le
nombre de mots de 32 bits dans l’entête TCP. Ce champ indique donc où
les données commencent.&lt;/li&gt;
&lt;li&gt;Réservé (6 bits): Champ inutilisé actuellement. Il était à l’origine
prévu pour l’avenir. On peut dire aujourd’hui que ce champ restera
vide.&lt;/li&gt;
&lt;li&gt;Drapeaux (flags) (6×1 bit): Les drapeaux représentent des
informations supplémentaires :
URG: si ce drapeau est à 1 le paquet doit être traité de façon
urgente.
ACK: si ce drapeau est à 1 le paquet est un accusé de réception.
PSH (PUSH): si ce drapeau est à 1, le paquet fonctionne suivant la
méthode PUSH.
RST: si ce drapeau est à 1, la connexion est réinitialisée.
SYN: Le Flag TCP SYN indique une demande d’établissement de
connexion.
FIN: si ce drapeau est à 1 la connexion s’interrompt.&lt;/li&gt;
&lt;li&gt;Fenêtre (16 bits): Champ permettant de connaître le nombre d’octets
que le récepteur souhaite recevoir sans envoyer d’accusé de
réception.&lt;/li&gt;
&lt;li&gt;Somme de contrôle (Checksum ou CRC): La somme de contrôle est
réalisée en faisant la somme des champs de données de l’en-tête, afin
de pouvoir vérifier l’intégrité de l’en-tête&lt;/li&gt;
&lt;li&gt;Pointeur d’urgence (16 bits): Indique le numéro d’ordre à partir
duquel l’information devient urgente.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="etablissement-dune-connexion"&gt;
&lt;h2&gt;Établissement d’une connexion&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/ConnectionTCP.png"&gt;&lt;img alt="ConnectionTCP" src="/images/ConnectionTCP.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Une ouverture de connexion TCP s’effectue en 3 temps.&lt;/p&gt;
&lt;p&gt;L’émetteur du premier paquet doit avoir connaissance du couple
&lt;strong&gt;`IP &amp;lt;https://web.archive.org/web/20110919035256/http://blog.aldevar.fr/?p=293&amp;gt;`__
: Port&lt;/strong&gt; de l’application de la machine réceptrice (par exemple, on
contact un serveur HTTP sur le port 80 qui lui est dédié). L’émetteur de
ce premier paquet est à l’origine de l’établissement du circuit virtuel.
C’est une attitude qualifiée de «&amp;nbsp;&lt;strong&gt;cliente&lt;/strong&gt;«&amp;nbsp;.&lt;/p&gt;
&lt;p&gt;Le récepteur du premier paquet accepte l’établissement de la connexion,
ce qui suppose qu’il était prêt à le faire avant que le client en prenne
l’initiative. C’est une attitude de «&amp;nbsp;&lt;strong&gt;serveur&lt;/strong&gt;«&amp;nbsp;.&lt;/p&gt;
&lt;p&gt;Le client envoie un segment comportant le drapeau SYN à 1. Le serveur
répond avec sa propre séquence (SYN = 1) mais il doit aussi acquitter le
paquet précédent, ce qu’il fait avec ACK. Le client répond alors avec un
acquittement de la séquence du serveur (ACK = 1).&lt;/p&gt;
&lt;p&gt;Une fois achevée cette phase appelée «&amp;nbsp;Three-way handshake&amp;nbsp;», les 2
applications sont en mesure d’échanger des données.&lt;/p&gt;
&lt;/div&gt;
</content><category term="QRQVB"></category></entry><entry><title>Rapport de stage sur la mise en place de Squid et Egroupware</title><link href="https://blog.devarieux.net/2010/01/rapport-de-stage-sur-la-mise-en-place-de-squid-et-egroupware.html" rel="alternate"></link><published>2010-01-06T15:05:00+01:00</published><updated>2010-01-06T15:05:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2010-01-06:/2010/01/rapport-de-stage-sur-la-mise-en-place-de-squid-et-egroupware.html</id><summary type="html">&lt;p&gt;J’ai longuement hésité à mettre ce rapport de stage en ligne pour
plusieurs raisons. Tout d’abord, ce rapport n’est pas vraiment
représentatif du travail fournit. La majorité des solutions expliquées
m’ont demandées beaucoup de temps de recherche et d’arrachage de cheveux
(notamment pour la migration …&lt;/p&gt;</summary><content type="html">&lt;p&gt;J’ai longuement hésité à mettre ce rapport de stage en ligne pour
plusieurs raisons. Tout d’abord, ce rapport n’est pas vraiment
représentatif du travail fournit. La majorité des solutions expliquées
m’ont demandées beaucoup de temps de recherche et d’arrachage de cheveux
(notamment pour la migration des comptes sous Lotus Notes). Ensuite, la
qualité rédactionnel est loin d’être au rendez-vous. On m’a beaucoup
reproché que ce rapport était trop technique et c’est plutôt vrai.
Enfin, ce document ne décrit pas vraiment l’installation de Squid et
d’Egroupware. Ces parties sont survolées et je m’attarde plus sur la
résolution des problèmes rencontrés (résoudre un conflit de schéma LDAP
quand on a jamais vu OpenLDAP de sa vie n’est pas chose aisée).&lt;/p&gt;
&lt;p&gt;Un mois après la fin de la formation, je me décide tout de même à le
mettre en ligne. Je pense que ce rapport décrit plutôt bien ce que peut
être le métier de technicien réseau dans une administration ou une PME.
Le problème lors de la mise en place d’un nouveau service n’est pas
l’installation et la configuration de ce service mais la migration des
anciens services utilisés vers les nouveaux. Surtout lorsque l’ancien
service est un système propriétaire vieillissant (Je veux parler ici de
Lotus Notes 5).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://web.archive.org/web/20110722200015/http://www.squid-cache.org/"&gt;Squid&lt;/a&gt;
est un proxy http très utilisé, dont j’ai pu découvrir une partie des
possibilités.
&lt;a class="reference external" href="https://web.archive.org/web/20110722200015/http://www.egroupware.org/"&gt;Egroupware&lt;/a&gt;
est un groupware fournissant un agenda, un client mail, un carnet
d’adresses, un système de réservations des ressources et plusieurs
autres choses, le tout dans une interface web. Je vous invite à tester
la &lt;a class="reference external" href="https://web.archive.org/web/20110722200015/http://www.stylite.de/egroupware_demo_login"&gt;demo sur le site du
projet.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ce rapport fait 38 pages et voici son sommaire:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;strong&gt;Remerciements&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Objectif du stage&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;L’entreprise&lt;/strong&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Historique&lt;/li&gt;
&lt;li&gt;La structure actuelle&lt;/li&gt;
&lt;li&gt;Le service informatique&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spécifications&lt;/strong&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Environnement de travail&lt;/li&gt;
&lt;li&gt;L’existant&lt;/li&gt;
&lt;li&gt;Besoins et contraintes&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;em&gt;Squid&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Egroupware&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mise en œuvre&lt;/strong&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Proxy&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;em&gt;Planning prévisionnel&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Mise en œuvre&lt;/em&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Squid&lt;/li&gt;
&lt;li&gt;Sarg&lt;/li&gt;
&lt;li&gt;Squidguard&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Problèmes rencontrés&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Annexes&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;eGroupware&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;em&gt;Schéma fonctionnel&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Planning previsionnel&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Mise en œuvre&lt;/em&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Configuration de openldap&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Problèmes rencontrés&lt;/em&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Conflit de schéma openldap&lt;/li&gt;
&lt;li&gt;Configuration de felamimail&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Préparation de la migration des utilisateurs&lt;/em&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Création du carnet d’adresses principal&lt;/li&gt;
&lt;li&gt;Importation des agendas Lotus Notes&lt;/li&gt;
&lt;li&gt;Importation des carnet d’adresse Lotus Notes&lt;/li&gt;
&lt;li&gt;Exportation des mails depuis LotusNotes dans eGroupware&lt;/li&gt;
&lt;li&gt;Importation mail depuis roundcube&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Annexes&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Procédure de migration serveur&lt;/strong&gt;&lt;ol class="arabic"&gt;
&lt;li&gt;Sur Revy&lt;/li&gt;
&lt;li&gt;Sur Revnew&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a class="reference external" href="http://blog.devarieux.net/wp-content/uploads/2015/08/RapportDeStage-Squid-Egroupware.pdf"&gt;RapportDeStage-Squid-Egroupware&lt;/a&gt;&lt;/p&gt;
</content><category term="Tech"></category></entry><entry><title>QRQVB : Les paquets UDP</title><link href="https://blog.devarieux.net/2009/12/qrqvb-les-paquets-udp.html" rel="alternate"></link><published>2009-12-29T11:23:00+01:00</published><updated>2009-12-29T11:23:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2009-12-29:/2009/12/qrqvb-les-paquets-udp.html</id><summary type="html">&lt;p&gt;Suite de la Question Réseau Qui Va Bien, nouveau billet purement réseau
donc. Je comptais me lancer dans la description des paquets TCP, mais je
pense qu’il est plus intéressant de se pencher d’abord sur UDP avant
d’appréhender TCP.&lt;/p&gt;
&lt;p&gt;UDP (Pour &lt;em&gt;User Datagram Protocol&lt;/em&gt;) se situe dans …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Suite de la Question Réseau Qui Va Bien, nouveau billet purement réseau
donc. Je comptais me lancer dans la description des paquets TCP, mais je
pense qu’il est plus intéressant de se pencher d’abord sur UDP avant
d’appréhender TCP.&lt;/p&gt;
&lt;p&gt;UDP (Pour &lt;em&gt;User Datagram Protocol&lt;/em&gt;) se situe dans la couche 4 du &lt;a class="reference external" href="http://blog.devarieux.net/2009/08/qrqvb-le-modele-osi/"&gt;modèle
OSI&lt;/a&gt; (couche
transport). Pour rappel, au niveau de la couche 3 (IP), &lt;a class="reference external" href="http://blog.devarieux.net/2009/09/qrqvb-datagramme-ip/"&gt;les
datagrammes&lt;/a&gt;
sont routés d’une machine à une autre en fonction des adresses IP (en
fait, le routage se fait en fonction de l’adresse réseau, voir &lt;a class="reference external" href="http://blog.devarieux.net/2009/09/309/"&gt;QRQVB :
L’adresse IP&lt;/a&gt;). Lors de cette
opération de routage, aucune distinction n’est faite entre les
différents services pour lesquels ces paquets peuvent être destinés. Que
ce soit pour une connexion SSH (port 22) ou HTTP (port 80) ou autre, les
datagrammes IP sont tous indifféremment mélangés.&lt;/p&gt;
&lt;p&gt;La couche 4 du modèle OSI ajoute un mécanisme qui permet
l’identification du service &amp;nbsp;concerné. Plusieurs programmes de plusieurs
utilisateurs pouvant simultanément circuler sur le réseau, il est
indispensable de faire un tri entre les applications. Ici, l’idée est
d’associer la destination du paquet à une fonction. L’identification de
cette fonction ce fait à l’aide d’un chiffre nommé &lt;strong&gt;Port&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="section" id="en-tete-udp"&gt;
&lt;h2&gt;En tête UDP&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/encaps.png"&gt;&lt;img alt="encaps" src="/images/encaps.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Lors de l’étude des &lt;a class="reference external" href="qrqvb-datagramme-ip.html"&gt;datagramme
IP&lt;/a&gt;, nous
avions vu le contenu de l’entête du paquet (partie verte). Ici, nous
allons observer le contenu de l’entête du message (partie jaune) lorsque
l’on traite un p&amp;gt;aquet UDP.&lt;/p&gt;
&lt;p&gt;Le paquet UDP est composé de 8 octets.&lt;/p&gt;
&lt;blockquote&gt;
&lt;a class="reference external" href="/images/entete.png"&gt;&lt;img alt="entete" src="/images/entete.png" /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Les 2 premiers octets contiennent le port source&lt;/strong&gt;. Codé sur 16 bits
donc. C’est le numéro de port de l’émetteur du paquet. C’est aussi le
numéro de port sur lequel le destinataire doit envoyer sa réponse.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Les octets 3 et 4 stockent le port de destination.&lt;/strong&gt; C’est sur ce port
que sera remis le paquet lors de sa livraison à la machine ciblée.&lt;/p&gt;
&lt;p&gt;Le port étant un entier positif de 16 bits, on en déduit que les bornes
sont 0 – 65535 (2^16). Cependant, le port 0 n’est pas exploitable.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Les octets 5 et 6 contiennent la longueur de l’entête UDP&lt;/strong&gt; et du
message. Sa longueur minimal est 8 (entête UDP avec 0 données à
transporter) et sa longueur maximal 2^16 = 65535 (64ko).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Les 2 derniers octets contiennent le cheksum&lt;/strong&gt;. C’est la somme de
contrôle de l’entête UDP et des données qui suivent.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ports-reserves"&gt;
&lt;h2&gt;Ports réservés&lt;/h2&gt;
&lt;p&gt;Toute machine qui utilise la pile TCP/IP se doit de connaitre un
certains nombre de services bien connus, aussi appelé «&amp;nbsp;well known port
number&amp;nbsp;» pour pouvoir dialoguer avec les autres machines sur internet.
Sur une machines Unix, cette liste est placée dans le fichier
&lt;strong&gt;*/etc/services*&lt;/strong&gt; et se doit d’être lisible par tous les utilisateurs
et toutes les applications. Voici un extrait du contenu de ce fichier :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Nom             Port/Protocol     Commentaire

netstat        15/tcp
 qotd       17/tcp      quote
 msp        18/tcp      # message send protocol
 msp        18/udp
 chargen    19/tcp      ttytst source
 chargen    19/udp      ttytst source
 ftp-data   20/tcp
 ftp        21/tcp
 fsp        21/udp      fspd
 ssh        22/tcp      # SSH Remote Login Protocol
 ssh        22/udp
 telnet     23/tcp
 smtp       25/tcp      mail
 time       37/tcp      timserver
 time       37/udp      timserver
 rlp        39/udp      resource    # resource location
 nameserver 42/tcp      name        # IEN 116
 whois      43/tcp      nicname
 tacacs     49/tcp              # Login Host Protocol (TACACS)
 tacacs     49/udp
 re-mail-ck 50/tcp              # Remote Mail Checking Protocol
 re-mail-ck 50/udp
 domain     53/tcp              # name-domain server
 domain     53/udp
 mtp        57/tcp              # deprecated
 tacacs-ds  65/tcp              # TACACS-Database Service
 tacacs-ds  65/udp
 bootps     67/tcp              # BOOTP server
 bootps     67/udp
 bootpc     68/tcp              # BOOTP client
 bootpc     68/udp
 tftp       69/udp
 gopher     70/tcp              # Internet Gopher
 gopher     70/udp
 rje        77/tcp      netrjs
 finger     79/tcp
 www        80/tcp      http        # WorldWideWeb HTTP
 www        80/udp              # HyperText Transfer Protocol
&lt;/pre&gt;
&lt;p&gt;Les ports 1 à 1023 sont réservés aux « well known ports ». Ils ne
peuvent être utilisés que par des applications qui s’exécutent avec des
droits privilégiés (root). Les autres ports peuvent être utilisés
librement sans privilège particulier et sont en général employés par les
applications clientes. Par exemple, sur ma machine, en ce moment, mon
client IRC utilise le port 59175 pour communiquer avec le serveur irc
holmes.freenode.net.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="mode-non-connecte"&gt;
&lt;h2&gt;Mode non connecté&lt;/h2&gt;
&lt;p&gt;Contrairement à TCP, UDP est conçu pour permettre un échange de données
entre 2 applications sans échange préliminaire. UDP est utilisé si les
données à transmettre n’ont pas besoin d’être fragmentées en plusieurs
paquet. La paquet est ainsi envoyé sans s’assurer qu’il arrive bien à
destination. UDP est appelé mode de transport non connecté par
opposition à TCP. Plus particulièrement, les paquets a destination d’une
application UDP sont conservés dans une pile de type FIFO. Si
l’application destinatrice ne les “consomme” pas assez rapidement, les
plus anciens paquets risquent d’être écrasés par les plus récents… Un
risque supplémentaire de perte de données.&lt;/p&gt;
&lt;p&gt;Nous verrons comment TCP peut palier à ce problème dans la prochaine
QRQVB&lt;/p&gt;
&lt;/div&gt;
</content><category term="QRQVB"></category></entry><entry><title>GNU/Linux : Résolution de problèmes</title><link href="https://blog.devarieux.net/2009/12/gnulinux-resolution-de-problemes.html" rel="alternate"></link><published>2009-12-25T19:34:00+01:00</published><updated>2009-12-25T19:34:00+01:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2009-12-25:/2009/12/gnulinux-resolution-de-problemes.html</id><summary type="html">&lt;p&gt;Une grande partie du travail sur les forums concernant les logiciels
libres est d'obtenir plus d'informations sur les problèmes des novices.
Il est très agréable d'aider les autres comme il peut être assez agaçant
d'essayer d'aider quelqu'un qui ne montre aucun effort pour s'aider
lui-même. Je ne pense pas que …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Une grande partie du travail sur les forums concernant les logiciels
libres est d'obtenir plus d'informations sur les problèmes des novices.
Il est très agréable d'aider les autres comme il peut être assez agaçant
d'essayer d'aider quelqu'un qui ne montre aucun effort pour s'aider
lui-même. Je ne pense pas que cela soit dû à de la fainéantise de la
part de celui qui pose la question. C'est simplement parce que les
novices ne connaissent pas les premières étapes de résolution des
problèmes sur GNU/Linux et ne savent pas quels types d'informations
rechercher ni comment les obtenir. J'espère que ce petit guide sera
utile pour ceux qui font leurs premiers pas sur linux.&lt;/p&gt;
&lt;div class="section" id="i-diagnostiquer-soi-meme"&gt;
&lt;h2&gt;I - Diagnostiquer soi-même&lt;/h2&gt;
&lt;div class="section" id="la-premiere-etape-est-la-collecte-d-informations"&gt;
&lt;h3&gt;1 - La première étape est la collecte d'informations.&lt;/h3&gt;
&lt;p&gt;Si un programme plante ou ne fait pas ce qu'il est censé faire, il faut
se poser et réfléchir calmement.&lt;/p&gt;
&lt;p&gt;Ouvrez un nouveau fichier dans votre éditeur de texte favori et
écrivez-y ce que vous faisiez quand le problème est apparu ainsi que
tous les messages d'erreurs reçus. Ces messages d'erreurs doivent être
recopiés exactement tel qu'ils sont apparus. Utilisez le copier/coller
si cela est possible.&lt;/p&gt;
&lt;p&gt;Ouvrez un terminal et tapez &lt;strong&gt;tail /var/log/messages&lt;/strong&gt;. Cette commande
affichera les 10 dernières lignes des logs du système. Si celui ci
contient un ou des messages qui sont clairement en rapport avec votre
problème, recopiez les également.&lt;/p&gt;
&lt;p&gt;Les erreurs des applications graphiques sont en général dans le fichier
.Xsession-errors ou .xsession-errors dans votre dossier /home. La
commande pour visualiser les 10 dernières lignes est donc &lt;strong&gt;tail
~/.xsession-errors&lt;/strong&gt;. Comme pour le fichier /var/log/messages, ajoutez
les lignes en rapport avec votre problème dans votre fichier de départ.
Si vous n'avez trouvé aucune information dans ces fichiers, essayez de
lancer l'application concernée depuis votre terminal. Lors de
l'apparition du bug, des messages devraient s'afficher.&lt;/p&gt;
&lt;p&gt;Si votre système ne démarre plus suite à un problème, démarrez alors sur
une autre distribution (soit en dual-boot si vous en avez soit depuis un
live-cd). Il est toujours bon d'avoir un live-cd sous la main pour ce
genre d'opération. Une fois que vous avez démarré sur le live-cd, montez
votre partition root et récupérez les informations dans les fichiers
cités plus haut.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="le-probleme-est-il-reproductible"&gt;
&lt;h3&gt;2 - Le problème est-il reproductible?&lt;/h3&gt;
&lt;p&gt;S'il est possible de reproduire le problème facilement, faites-le.
N'oubliez pas de le faire sur des fichiers peu important ou sur une
copie du fichier concerné afin de ne pas endommager vos données.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="est-ce-un-probleme-materiel"&gt;
&lt;h3&gt;3 - Est-ce un problème matériel ?&lt;/h3&gt;
&lt;p&gt;Les problèmes non reproductibles sont souvent dus au matériel. Si vous
pensez que c'est le cas, regardez alors dans le fichier
&lt;strong&gt;/var/log/boot&lt;/strong&gt; ainsi que &lt;strong&gt;/var/log/kern.log&lt;/strong&gt; ou
&lt;strong&gt;/var/log/kernel.log&lt;/strong&gt; suivant votre distribution pour voir si le
kernel reconnait bien votre matériel. Ce fichier étant très long, la
commande tail ne vous sera pas d'un grand secours. Utilisez plutôt
&lt;strong&gt;less /var/log/boot&lt;/strong&gt;et parcourez les pages à la recherche d'un
message en rapport avec votre problème. Recopiez également ce message
dans votre fichier de départ.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="lisez-la-documentation-du-programme"&gt;
&lt;h3&gt;4 - Lisez la documentation du programme.&lt;/h3&gt;
&lt;p&gt;Ceci est à faire en particulier si le programme ne réagit pas de la
manière souhaitée. Lisez l'aide en ligne du programme et utilisez
également le manuel universel (dans un terminal : man
nom_du_programme).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="recherchez-votre-message-d-erreur-sur-internet"&gt;
&lt;h3&gt;5 - Recherchez votre message d'erreur sur internet&lt;/h3&gt;
&lt;p&gt;Copiez/collez le message d'erreur dans un moteur de recherche ou un
meta-moteur tel que ixquick et ajoutez-y le nom du programme. Vous
trouverez certainement des messages sur des forums d'utilisateurs qui
ont le même problème que vous. Lisez le thread complet, vous y trouverez
peut-être une solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="reflechissez-avec-logique"&gt;
&lt;h3&gt;6 - Réfléchissez avec logique&lt;/h3&gt;
&lt;p&gt;Si, arrivé ici, vous commencez à avoir une idée sur la cause du
problème, vous pouvez peut être tester cette idée. Il y a beaucoup de
petites commandes simples qui peuvent vous aider à recueillir plus
d'informations sur votre problème et votre système, qui vont seront d'un
grand secours.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;lspci&lt;/strong&gt; pour lister votre matériel&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;lsusb&lt;/strong&gt; pour lister les périphériques usb&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cat /proc/cpuinfo&lt;/strong&gt; pour avoir les caractéristiques de votre CPU&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;free -m&lt;/strong&gt; pour connaitre le taux de charge de votre RAM&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="maintenant-vous-pouvez-penser-a-demander-de-l-aide"&gt;
&lt;h3&gt;7 - Maintenant, vous pouvez penser à demander de l'aide.&lt;/h3&gt;
&lt;p&gt;Si après tout ça, vous n'avez toujours pas résolu votre problème, il est
temps de demander de l'aide sur un forum d'utilisateurs. Avant de passer
à cette étape, rappelez vous que les utilisateurs des forums ne sont pas
payés pour répondre à vos questions. Ce sont seulement des utilisateurs
ayant une certaine expérience et qui font cela bénévolement.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="ii-obtenir-de-l-aide"&gt;
&lt;h2&gt;II - Obtenir de l'aide&lt;/h2&gt;
&lt;div class="section" id="d-abord-observer"&gt;
&lt;h3&gt;1 - D'abord, observer&lt;/h3&gt;
&lt;p&gt;Commencez par choisir votre forum. Il est préférable dans un premier
temps de choisir le forum de votre distribution, puis le forum du
programme concerné. Si ce forum possède une FAQ, lisez-la. Lisez aussi
les règles du forum. Si votre question ne respecte pas les règles, il y
a de grandes chances pour que vous n'obteniez pas de réponse.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ne-soyez-pas-hors-sujet"&gt;
&lt;h3&gt;2 - Ne soyez pas hors-sujet&lt;/h3&gt;
&lt;p&gt;Trouvez le sous-forum qui correspond à votre problème. Ne postez pas
votre message dans plusieurs sous-forums, ceci est très mal vu.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="choisissez-bien-le-titre-de-votre-topic"&gt;
&lt;h3&gt;3 - Choisissez bien le titre de votre topic.&lt;/h3&gt;
&lt;p&gt;N'utilisez pas de sujet tel que &amp;quot;Besoin d'aide&amp;quot; ou &amp;quot;J'ai un problème&amp;quot;.
Ceci a tendance à irriter les gens.&lt;/p&gt;
&lt;p&gt;Votre titre doit indiquer le plus clairement quel problème vous avez.
Ainsi, une personne qui pense pouvoir vous aider sera plus encline à
lire votre sujet et poster une réponse. Soyez aussi précis que possible.
Par exemple &amp;quot;Impossible d'obtenir une adresse IP&amp;quot; sera plus utile que
&amp;quot;Je n'arrive pas à aller sur internet&amp;quot;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="donnez-des-informations"&gt;
&lt;h3&gt;4 - Donnez des informations&lt;/h3&gt;
&lt;p&gt;Dans le corps de votre message, donnez le nom et la version de votre
distribution, le nom et la version du programme utilisé et les
informations sur votre matériel si cela est nécessaire. Recopiez-y aussi
les messages d'erreurs (c'est là que le fichier que vous avez créé au
début devient utile). Indiquez ce que vous avez fait pour tenter de
résoudre le problème. En faisant cela, vous montrerez aux autres que
vous ne vous êtes pas jeté sur le forum dès que le problème est apparu.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pas-de-langage-sms"&gt;
&lt;h3&gt;5 - Pas de langage SMS&lt;/h3&gt;
&lt;p&gt;Ça saoule! Ça n'aide pas à vous faire comprendre et on vous répondra
d'autant moins.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ne-perdez-pas-une-opportunite-d-apprendre"&gt;
&lt;h3&gt;6 - Ne perdez pas une opportunité d'apprendre&lt;/h3&gt;
&lt;p&gt;Ne suivez pas les conseils aveuglément. Vous êtes ici pour apprendre
quelque chose. Si on vous demande d'utiliser un outil en ligne de
commande, utilisez les pages man pour savoir à quoi sert cet outil. Vous
pourrez ensuite réutiliser cet outil si vous rencontrez un problème
similaire. Si on vous demande de poster un fichier pour plus
d'informations, recherchez l'utilité de ce fichier. Les fichiers
systèmes importants possèdent souvent une page man dédiée.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="dites-merci"&gt;
&lt;h3&gt;7 - Dites merci&lt;/h3&gt;
&lt;p&gt;Les logiciels libres reposent sur la communauté. Personne n'est payé
pour vous aider. Les personnes qui vous aident le font car elles ont
elles-mêmes reçu de l'aide dans le passé et veulent rendre la pareille.
En plus de dire merci, vous pouvez également aider les autres qui ne
savent peut-être pas quelque chose que vous savez. Vous ressentirez
alors une certaine satisfaction que les logiciels propriétaires ne
peuvent vous apporter.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="Tech"></category><category term="aide"></category><category term="GNU"></category><category term="Linux"></category><category term="probleme"></category></entry><entry><title>QRQVB : L'adresse IP</title><link href="https://blog.devarieux.net/2009/09/qrqvb-adresse-ip.html" rel="alternate"></link><published>2009-09-16T19:12:00+02:00</published><updated>2009-09-16T19:12:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2009-09-16:/2009/09/qrqvb-adresse-ip.html</id><summary type="html">&lt;div class="section" id="definition"&gt;
&lt;h2&gt;Définition :&lt;/h2&gt;
&lt;p&gt;Une adresse IP identifie de manière unique une machine ainsi que le
réseau sur lequel elle est située. Chaque adresse est une série de 4
octets dont une partie correspond à l’&lt;strong&gt;identificateur du réseau&lt;/strong&gt;&amp;nbsp;et
l’autre partie à l’&lt;strong&gt;identificateur de la machine&lt;/strong&gt;.
|  Exemple d’adresse IP …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="section" id="definition"&gt;
&lt;h2&gt;Définition :&lt;/h2&gt;
&lt;p&gt;Une adresse IP identifie de manière unique une machine ainsi que le
réseau sur lequel elle est située. Chaque adresse est une série de 4
octets dont une partie correspond à l’&lt;strong&gt;identificateur du réseau&lt;/strong&gt;&amp;nbsp;et
l’autre partie à l’&lt;strong&gt;identificateur de la machine&lt;/strong&gt;.
|  Exemple d’adresse IP : 172.19.174.125.&lt;/p&gt;
&lt;p&gt;Concrètement, qu’est ce que cela signifie? En fait, puisque les machines
ne savent traiter qu’avec des nombres binaires (0 ou 1) l’adresse est
codée en binaire sur 4 octets. Sachant qu’un octet correspond à 8 bits,
cela nous donne, pour chaque octet 256 possibilités (2^8) pour une
valeur comprise en 0 et 255.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="allons-un-peu-plus-loin"&gt;
&lt;h2&gt;Allons un peu plus loin!&lt;/h2&gt;
&lt;p&gt;C’est bien sympa d’avoir une adresse, encore faut-il qu’on puisse m’y
contacter! On vient de voir dans la définition que l’adresse IP est
divisée en 2 sous parties :&amp;nbsp;&lt;strong&gt;l’identificateur de
réseau&lt;/strong&gt;&amp;nbsp;et&amp;nbsp;&lt;strong&gt;l’identificateur d’hôte&lt;/strong&gt;. C’est là qu’intervient le
masque de réseau. Alors puisque je ne suis pas fort en blablatage, je
vais plutôt vous montrer un exemple.
|  Voici une adresse IP : 192.168.1.15
|  Voici un masque de réseau : 255.255.255.0&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/netmask1.png"&gt;&lt;img alt="netmask1" src="/images/netmask1.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;En fait, pour être plus précis, les bits se situant dans la partie de
l’identificateur réseau sont tous positionnés sur 1 et les bits de la
partie hôte sur 0. En procédant à une opération de ET logique entre
l’adresse IP et le masque de réseau, on trouve l’adresse réseau. Les
opérations de ET logique suivent cette règle :&lt;/p&gt;
&lt;pre class="literal-block"&gt;
0 ET 0 = 0
0 Et 1 = 0
1 ET 0 = 0
1 ET 1 = 1
&lt;/pre&gt;
&lt;p&gt;Grâce à cette adresse réseau, un routeur pourra déterminer quel chemin
doivent emprunter nos paquets IP. Pour bien comprendre ce système, nous
allons jouer un peu avec le binaire, même si je sais que ça va en
rebuter plus d’un :p&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/binaire.png"&gt;&lt;img alt="binaire" src="/images/binaire.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ceci est important puisque c’est de cette manière qu’on va pouvoir
déterminer le nombre maximal de machines qui peuvent appartenir à un
réseau. Il faut également savoir que sur 1 réseau, 2 adresses sont
réservées. L’adresse&amp;nbsp;&lt;strong&gt;‘bits hôte à 0′&lt;/strong&gt;&amp;nbsp;car c’est elle qui va définir
justement l’adresse de notre réseau, comme on vient de le voir, et
l’adresse&amp;nbsp;&lt;strong&gt;‘bits hôte à 1′&lt;/strong&gt;&amp;nbsp;car elle correspond à l’adresse de
diffusion (broadcast). L’adresse de broadcast est nécessaire pour
diffuser un message sur tout le réseau. Le message de ce genre le plus
classique est la requête&amp;nbsp;ARP. Celle ci permet à une machine de trouver
une autre machine sur le réseau en l’appelant.&lt;/p&gt;
&lt;p&gt;Voici un exemple de capture de trame avec wireshark :&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/arp2.png"&gt;&lt;img alt="arp2" src="/images/arp2.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Le premier paquet est donc une requête ARP. La machine source envoie ce
message sur tout le réseau : ‘who has 192.168.1.51? &amp;nbsp;Tell 192.168.1.25′.
La machine qui a pour IP 192.168.1.51 envoie donc sa réponse directement
à 192.168.1.15 et lui dit que c’est l’adresse MAC 00:0a:78:9e:8a qui
possède cette IP.&amp;nbsp;Tout ça pour vous dire que l’adresse IP ‘bits hôte à
1′ est donc réservée pour ce type de message.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="dimensionnement-de-reseau"&gt;
&lt;h2&gt;Dimensionnement de réseau&lt;/h2&gt;
&lt;p&gt;Puisque le masque de réseau détermine le nombre maximal de machines sur
un réseau et que les adresses IP ne sont pas illimitées, on va pouvoir
travailler sur le dimensionnement du réseau en modifiant le masque. En
effet,&amp;nbsp;&lt;strong&gt;il est possible d’emprunter des bits à la partie hôte pour
les donner à la partie réseau&lt;/strong&gt;. Par exemple, le masque 255.255.255.0
permet d’avoir 256-2 = 254 hôtes différents sur le même réseau. Hors,
rares sont ceux qui disposent de 254 machines à interconnecter.&lt;/p&gt;
&lt;p&gt;Admettons que mon réseau possède l’ip 192.168.1.0 (totalement au
hasard!) de masque 255.255.255.0 . Je dispose de 5 machines à connecter
sur ce réseau, jamais plus.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Si je garde 1bit dans la partie hôte, je vais disposer de 2^1 = 2
hôtes possibles. &amp;nbsp;On vient de voir plus haut que 2 adresses sont
reservées sur le réseau, (sisi, rapellez vous, juste au dessus!).
Donc 2-2 = 0, ce qui me fait 0 hôte disponible.&lt;/li&gt;
&lt;li&gt;Si je garde 2 bits pour ma partie hôte, il va me rester (2^2)-2 = 2
hôtes possibles. Ce n’est toujours pas suffisant!!&lt;/li&gt;
&lt;li&gt;Si je garde 3 bits pour la partie hôtes, j’obtiens (3^2)-2 = 6 hôtes
possibles. Ouf!! j’ai assez de place pour caser mes machines. On va
donc construire notre masque de réseau en gardant ces 3 bits sur 0,
ce qui nous donne :&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;11111111.11111111.11111111.11111 &amp;nbsp;&amp;nbsp; 000&lt;/div&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;Partie réseau &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp; &amp;nbsp;Partie hôte&lt;/div&gt;
&lt;div class="line"&gt;Ce qui, transformé en décimal nous donne un masque : 255.255.255.248.&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Ce qu’on vient de faire ici, c’est de créer des sous réseaux du réseau
192.168.1.0. Plusieurs sous réseaux composé chacun de 8 adresses IP.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Sous réseau 1 : de 192.168.1.0 à 192.168.1.7 (avec 192.168.1.0 adresse de sous réseau et 192.168.1.7 adresse de broadcast)
Sous réseau 2 : de 192.168.1.8 (adresse du réseau) à 192.168.1.15 (adresse de broadcast)
Sous réseau 3 : de 192.168.1.16(adresse du réseau) à 192.168.1.23 (adresse de broadcast)
etc etc..
dernier sous réseau : de 192.168.1.248 (adresse de réseau) à 192.168.1.255 (adresse de broadcast)
&lt;/pre&gt;
&lt;p&gt;Voilà donc ce qui se cache derrière les adresses IP. Plus mon sous
réseau sera petit, moins j’aurais de broadcast sur ce réseau. Parce que
mine ça papote pas mal la dedans et ça a tendance à broadcaster dans
tous les sens. Malheureusement, le broadcast n’est pas gratuit. Il coûte
de la bande passante. Et quand la bande passante sature, on commence à
perdre des paquets.&lt;/p&gt;
&lt;p&gt;C’est pour ça qu’il est important, en entreprise en tout cas, de bien
calculer le dimensionnement de son réseau et l’adressage IP de
l’entreprise, sans oublier de prévoir que si l’entreprise s’agrandit, il
va falloir rajouter des hôtes sur certains sous réseaux et en plus
ajouter un nouveau sous réseau à notre entreprise pour y connecter un
nouveau bâtiment par exemple. Ça a vite tendance à tourner cacahuète si
on fait pas attention.&lt;/p&gt;
&lt;/div&gt;
</content><category term="QRQVB"></category><category term="ip"></category><category term="qrqvb"></category><category term="réseaux"></category></entry><entry><title>QRQVB : Datagramme IP</title><link href="https://blog.devarieux.net/2009/09/qrqvb-datagramme-ip.html" rel="alternate"></link><published>2009-09-16T11:07:00+02:00</published><updated>2009-09-16T11:07:00+02:00</updated><author><name>alain</name></author><id>tag:blog.devarieux.net,2009-09-16:/2009/09/qrqvb-datagramme-ip.html</id><summary type="html">&lt;p&gt;Je vais tenter dans cet article de décortiquer un datagramme IP et
notamment son en-tête. Nous allons commencer par l’observation des
encapsulations des données suivant le &lt;a class="reference external" href="http://blog.devarieux.net/2009/08/qrqvb-le-modele-osi/"&gt;modèle
OSI&lt;/a&gt; que nous
avons étudié la dernière fois. Les données (couche application) sont
encapsulées dans un message (couche 4, transport) qui est …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Je vais tenter dans cet article de décortiquer un datagramme IP et
notamment son en-tête. Nous allons commencer par l’observation des
encapsulations des données suivant le &lt;a class="reference external" href="http://blog.devarieux.net/2009/08/qrqvb-le-modele-osi/"&gt;modèle
OSI&lt;/a&gt; que nous
avons étudié la dernière fois. Les données (couche application) sont
encapsulées dans un message (couche 4, transport) qui est lui même
encapsulé dans un paquet (couche 3, réseau), lui même encapsulé dans une
trame (couche 2, liaison). Rien ne vaut un bon dessin pour
comprendre.&lt;a class="reference external" href="/images/encaps.png"&gt;&lt;img alt="encaps" src="/images/encaps.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Aujourd’hui, on va donc s’intéresser à ce que contient le petit carré
vert lorsque le paquet est un paquet IP.&lt;/p&gt;
&lt;p&gt;Cet en-tête est codé par défaut sur 20 octets. Nous allons donc nous
appliquer à décrypter le contenu de chacun de ses octets. J’ai fait pour
cela un schéma pas terrible mais qui me servira de support pour les
explications :p.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/entete1.png"&gt;&lt;img alt="entete1" src="/images/entete1.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Le premier octet contient 2 informations.&lt;/strong&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La première est la version du protocole utilisé, codée sur 4 bits.
pour le protocole IPv4, on utilisera le code 0100 qui correspond
au 4 décimal. Pour IPv6, c’est 0110 (6 décimal).&lt;/li&gt;
&lt;li&gt;La seconde information, codée également sur 4 bits contient l’IHM.
C’est la longueur, en mot de 32bits (4 octets), de l’en-tête du
datagramme. Par défaut, ces bits sont positionnés sur 0101, ce qui
correspond au 5 décimal, ce qui est logique pour un en-tête par
défaut de 20 octets.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Le deuxième octet est le TOS (type of service)&lt;/strong&gt; et va définir la
manière dont le datagramme doit être traité. Il se décompose lui
aussi en 2 :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;3 bits pour la priorité à donner au datagramme (0 à 7)&lt;/li&gt;
&lt;li&gt;4 bits qui définissent chacun une option activée ou pas (1 option
activée, 0 option desactivée)&lt;ul&gt;
&lt;li&gt;1er bit : D → Positionné sur 1 pour privilégier le délai
d’acheminement&lt;/li&gt;
&lt;li&gt;2ème bit : T →&amp;nbsp;Positionné sur 1 pour privilégier le débit&lt;/li&gt;
&lt;li&gt;3ème bit : R →&amp;nbsp;Positionné sur 1 pour privilégier la fiabilité&lt;/li&gt;
&lt;li&gt;4ème bit : C → Positionné sur 1 pour privilégier le coût&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;1 bit qui ne contient aucune information. Il est appelé MBZ pour
Must Be Zero. comme son nom l’indique, ce bit doit être positionné
sur 0.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Les 3ème et 4ème octets contiennent le champ Longueur Totale (Total
Lenght)&lt;/strong&gt;. Codé sur 16 bits, il contient la taille, en octet, du
datagramme complet (en-tête + données). On en déduit donc que la
longueur totale du paquet ne peut dépasser 65535 octets. Grâce à
cette valeur, on peut calculer la taille des données :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;longueur données = Longueur totale – (IHM x 4)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Les 5ème et 6ème octets contiennent le champ Identification&lt;/strong&gt;.
Celui ci intervient lors du ré-assemblage des paquets pour
reconstituer les données lorsque celles ci sont fragmentées.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Les 7ème et 8ème octets contiennent 2 informations.&lt;/strong&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;3 bits correspondent au champ &lt;strong&gt;flag&lt;/strong&gt;. Il sert a déterminer
l’état de fragmentation.&lt;ul&gt;
&lt;li&gt;1er bit : Réservé, il doit être sur 0&lt;/li&gt;
&lt;li&gt;2ème bit : Don’t Fragment. Indique si la fragmentation est
autorisée.&lt;/li&gt;
&lt;li&gt;3ème bit : More Fragment. Positionné sur 1 il signifie que ce
datagramme n’est pas le dernier fragment.&lt;/li&gt;
&lt;li&gt;13 bits correspondent au champ &lt;strong&gt;Position Fragment&lt;/strong&gt;. Ce champ
indique la position du fragment par rapport au premier
datagramme et interviendra lors de la reconstitution du
message.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Le 9ème octet contient le TTL (Time to Live).&lt;/strong&gt; ‘Durée de vie’ en
français. Il indique le nombre maximal de routeurs que peut traverser
le datagramme. Il est initialisé par la station émettrice et
décrémenté de 1 par chaque routeur qui reçoit le datagramme et le
réexpédie. Si un routeur reçoit un datagramme dont le TTL est nul, il
le détruit et renvoie à l’expéditeur un message ICMP. Le but de ce
champ est d’éviter les paquets fantômes qui circuleraient en boucle
sur le réseau sans atteindre leur destination.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Pour la petite histoire, c’est de cette manière que fonctionne
l’application &lt;strong&gt;traceroute&lt;/strong&gt;. Lorsqu’on lance traceroute
&lt;a class="reference external" href="http://www.devarieux.net"&gt;www.devarieux.net&lt;/a&gt;, traceroute envoie
un ping vers www.devarieux.net avec un TTL de 1. Lorsque le premier
routeur reçoit le paquet, il le détruit et renvoie à l’expediteur un
message ICMP l’informant que le paquet a été détruit (time to live
exceeded). Ce message ICMP contient dans son en-tête l’adresse IP du
routeur. Suite à cela, traceroute recommence l’opération mais avec
un TTL de 2 et ainsi de suite jusqu’à toucher www.aldevar.fr. Et
c’est de cette manière qu’on obtient la route prise par notre
paquet. Attention ceci dit car 2 paquets envoyés vers la même
destination peuvent emprunter des routes différentes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;Le 10ème octet sert à coder le protocole&lt;/strong&gt; qui se trouve dans les
données qui suivent l’en-tête. Il est codé sur 8 bits. Les protocoles
les plus communs sont ICMP (0000.0001), TCP (0000.0110) et UDP
(0001.0001).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;11ème et 12ème octets : Le checksum&lt;/strong&gt;. C’est la somme de contrôle
de l’en-tête du datagramme. Chaque machine qui reçoit le paquet doit
recalculer ce checksum car la modification du TTL modifie celui ci.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Les octets 13 à 16 contiennent l’&lt;strong&gt;adresse IP de la machine
émétrice&lt;/strong&gt;. C’est également l’adresse de réponse.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Et enfin les 4 derniers octets contiennent eux l’&lt;strong&gt;adresse IP de
destination&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="section" id="capture-de-trame"&gt;
&lt;h2&gt;Capture de trame&lt;/h2&gt;
&lt;p&gt;Puisqu’il n’est pas particulièrement évident pour nous, simples mortels,
de lire ces bits pour comprendre ce que contient le datagramme, on peut
utiliser un logiciel de capture de trame tel que &lt;strong&gt;wireshark&lt;/strong&gt; en mode
graphique ou &lt;strong&gt;tcpdump&lt;/strong&gt; en mode commande. Je vous laisse vous même
découvrir ces applications. Je vais me contenter ici de montrer un
screenshot d’une capture faite avec wireshark qui montre ce que ce
logiciel peut nous dire sur le contenu de nos paquets.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/trame01.png"&gt;&lt;img alt="trame01" src="/images/trame01.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Voici le type de paquet que nous avons capturé. C’est un
simple ping entre 2 machines se situant sur des réseaux différents.
Wireshark nous dit déjà que c’est un paquet ICMP. Voyons le détail de ce
datagramme :&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="/images/trame02.png"&gt;&lt;img alt="trame02" src="/images/trame02.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;En dépliant le contenu de l’en-tête IP, voici ce que wireshark peut nous
dire :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Nous sommes en IPv4.&lt;/li&gt;
&lt;li&gt;Le header fait 20 octets (bytes et non bits).&lt;/li&gt;
&lt;li&gt;La longueur total du datagramme est de 60 octets. On en conclue donc
que nous avons 40 octets de données.&lt;/li&gt;
&lt;li&gt;Le message n’est pas fragmenté.&lt;/li&gt;
&lt;li&gt;Le TTL est de 128 ce qui signifie qu’après avoir traversé 128
routeurs, le paquet sera détruit.&lt;/li&gt;
&lt;li&gt;Le protocole contenu dans les data est ICMP&lt;/li&gt;
&lt;li&gt;Le checksum est correct.&lt;/li&gt;
&lt;li&gt;Enfin, à la fin, les IP de départ et de destination.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Voilà, c’est terminé pour l’analyse de paquet de niveau 3. La prochaine
fois, j’essaierai d’expliquer le contenu d’un en-tête &amp;nbsp;de niveau 4
(couche transport : UDP, TCP etc…) ou de niveau 2 (couche liaison, trame
ethernet). Si vous trouvez que cet article manque de précision n’hésitez
pas à m’en faire part.&lt;/p&gt;
&lt;/div&gt;
</content><category term="QRQVB"></category></entry><entry><title>QRQVB : Le modèle OSI</title><link href="https://blog.devarieux.net/2009/08/qrqvb-le-modele-osi.html" rel="alternate"></link><published>2009-08-17T18:30:00+02:00</published><updated>2009-08-17T18:30:00+02:00</updated><author><name>aldevar</name></author><id>tag:blog.devarieux.net,2009-08-17:/2009/08/qrqvb-le-modele-osi.html</id><summary type="html">&lt;p&gt;Dans cette nouvelle catégorie (la Question Réseau Qui Va Bien), je vous
propose de (re)découvrir avec moi, quelques notions fondamentales de
réseau. Ces articles s'adressent en particulier à ceux qui souhaitent
comprendre les mécanismes d'Internet et/ou du routage en&amp;nbsp;WAN&amp;nbsp;ou en&amp;nbsp;LAN.
J'essaierai d'être le plus clair …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Dans cette nouvelle catégorie (la Question Réseau Qui Va Bien), je vous
propose de (re)découvrir avec moi, quelques notions fondamentales de
réseau. Ces articles s'adressent en particulier à ceux qui souhaitent
comprendre les mécanismes d'Internet et/ou du routage en&amp;nbsp;WAN&amp;nbsp;ou en&amp;nbsp;LAN.
J'essaierai d'être le plus clair possible. Si vous trouvez des erreurs,
non-sens dans ces articles, je suis ouvert à toutes critiques,
corrections. Et pour inaugurer cette catégorie, commençons donc par le
modèle OSI, qui est la base pour une bonne compréhension des mécanismes
des réseaux informatiques.&lt;/p&gt;
&lt;div class="section" id="definition"&gt;
&lt;h2&gt;Définition&lt;/h2&gt;
&lt;p&gt;Le modèle OSI est une norme définie par l'ISO pour permettre
l'interconnexion des systèmes. Il propose un modèle d'architecture
réseau afin de s'assurer que tous les systèmes interconnectés puissent
communiquer entre eux quel que soit le constructeur du matériel. Les
constructeurs informatiques ont proposé des architectures réseaux
propres à leurs équipements. Par exemple, IBM a proposé SNA, DEC a
proposé DNA... Ces architectures ont toutes le même défaut : du fait de
leur caractère propriétaire, il n'est pas facile des les interconnecter,
à moins d'un accord entre constructeurs.&amp;nbsp;Le modèle OSI ne précise pas
vraiment les services et protocoles à utiliser pour chaque couches. Il
décrit plutôt ce que doivent faire ces couches. Je sais que ça ne parait
pas très clair pour le moment, mais ça va le devenir.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="schema-du-modele"&gt;
&lt;h2&gt;Schéma du modèle&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="images/modele_OSI.gif"&gt;&lt;img alt="modele_OSI" src="images/modele_OSI.gif" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Le modèle OSI est donc représenté en 7 couches distinctes. J'ai ici
représenté 2 machines (Système A et Système B) pour bien montrer que
lors de la communication de 2 hôtes, chaque couche 'discute' directement
avec la couche équivalente de l'hôte d'en face.&lt;/p&gt;
&lt;div class="section" id="couche-physique"&gt;
&lt;h3&gt;1°) Couche Physique&lt;/h3&gt;
&lt;p&gt;La couche physique s'occupe de la transmission des bits de façon brute
sur un canal de communication. Plus clairement, elle est typiquement
représentée par votre carte réseau et sa prise ethernet (et non pas le
protocole ethernet!!).&amp;nbsp;La couche phyique discute directement avec l'hôte
suivant sur le réseau. C'est à dire que lors d'une communication sur
internet, cette couche ne s'occupe de l'envoie des données que vers la
machine suivante, en général un routeur.&amp;nbsp;La couche physique traite
exclusivement avec des bits 0 et 1 et normalise l'écriture de ces bits
(une tension de 5V corespond à un 1, -5V un 0).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="couche-liaison"&gt;
&lt;h3&gt;2°) Couche Liaison&lt;/h3&gt;
&lt;p&gt;La couche de liaison (ou liaison de donnée) est un liant entre les 2
couches physiques des hôtes en communications. Elle fractionne les
données en trames et tente d'exempter la couche physique des erreurs de
transmissions. Elle doit être capable de renvoyer une trame lorsqu'il y
a un problème sur la ligne et intègre également un système de gestion de
flux pour éviter les engorgements. Par exemple une carte 100Mb/s relié à
une carte 1Gb/S doivent pouvoir communiquer sans que la carte 100Mb/s
recoive 10x trop de données.&amp;nbsp;L'unité d'information de cette couche est
donc la trame qui est composé de quelques centaines d'octets.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="couche-reseau"&gt;
&lt;h3&gt;3°) Couche Réseau&lt;/h3&gt;
&lt;p&gt;La couche réseau construit la liaison de bout en bout lors de la
communication de 2 hôtes. C'est la seule couche directement concernée
par la topologie du réseau. Elle va trouver la route parmis les routeurs
pour atteindre l'hôte cible.&amp;nbsp;Lors d'un envoie de données, 2 paquets
différents peuvent emprunter des routes différentes suivant
l'architecture du réseau et ses point d'engorgement.&amp;nbsp;C'est la dernière
couche supportée par TOUTES les machines du réseau (hôtes, switchs,
routeurs, serveurs). Son unité d'information est le paquet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="couche-transport"&gt;
&lt;h3&gt;4°) Couche Transport&lt;/h3&gt;
&lt;p&gt;Cette couche est responsable du bon acheminement des messages complets
au destinataire. Le rôle principal de la couche transport est de prendre
les messages de la couche session, de les découper s'il le faut en
unités plus petites et de les passer à la couche réseau et inversement
du coté du recepteur.&amp;nbsp;Comme on l'a vu dans la couche réseau, 2 paquets
d'un même message peuvent prendre des routes différentes et donc arriver
dans le désordre. Le rôle de la couche transport est donc de remettre
ces paquets dans l'ordre. Elle peut aussi gérer le multiplexage lors de
communications multiples entre 2 mêmes hôtes (par exemple une connexion
http et ftp sur le même canal).&amp;nbsp;Son unité d'information est le message.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="couche-session"&gt;
&lt;h3&gt;5°) Couche Session&lt;/h3&gt;
&lt;p&gt;Le service principale de la couche session est la synchronisation des
communications. Qui veut parler? Qui parle? Elle permet aussi de prendre
des 'snapshots' des flots de données pour pouvoir reprendre le dialogue
là où il en était avant une coupure du canal de communication.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="couche-presentation"&gt;
&lt;h3&gt;6°) Couche Présentation&lt;/h3&gt;
&lt;p&gt;La couche présentation est chargée du codage des données de la couche
application. En effet, toutes les couches plus basses transportent des
octets sans chercher comprendre leur signification. Ici, elle va
s'occuper d'encoder du texte, des images, de la video, de la voix etc...
en données transportables, c'est à dire en octet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="couche-application"&gt;
&lt;h3&gt;7°) Couche Application&lt;/h3&gt;
&lt;p&gt;Cette couche est le point de contact entre l'utilisateur et le réseau.
Elle lui apporte l'interface lui permettant de communiquer avec celui ci
(messagerie, http, ftp etc...).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="exemples-de-protocoles"&gt;
&lt;h2&gt;Exemples de protocoles&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Physique → biphase, bipolaire simple&lt;/li&gt;
&lt;li&gt;Liaison → ATM, Ethernet, PPP, TokenRing, Fiber Distributed Date
Interface (FDDI)&lt;/li&gt;
&lt;li&gt;Réseau → IP, IPX, ICMP&lt;/li&gt;
&lt;li&gt;Transport → TCP, UDP (pour les plus connus)&lt;/li&gt;
&lt;li&gt;Session → SIP, Appletalk&lt;/li&gt;
&lt;li&gt;Présentation → ASCII, Unicode, ASN.1, Videotex&lt;/li&gt;
&lt;li&gt;Application → HTTP, SMTP, POP, FTP, DNS, SNMP&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</content><category term="QRQVB"></category><category term="osi"></category><category term="qrqvb"></category><category term="réseaux"></category></entry></feed>