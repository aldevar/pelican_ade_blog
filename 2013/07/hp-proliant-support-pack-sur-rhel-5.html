<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    HP Proliant Support Pack sur RHEL 5
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="../../theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../../theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../theme/css/main.css">

    <link rel="stylesheet" href="../../theme/css/blog.css">
    <link rel="stylesheet" href="../../theme/css/github.css">
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aldevar - Le Blog Atom Feed" />
        <script src="../../theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
        <a id="site-title" href="../.."><h1><i class="icon-coffee"></i> Aldevar - Le Blog</h1></a>
        <p id="site-desc"> Un Blog IT </p>
    </hgroup>
    <nav>
        <ul id="nav-links">
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2013-07-23T18:07:00+02:00" pubdate>
                            Tue 23 July 2013
                        </time>
                        <a href="../../2013/07/hp-proliant-support-pack-sur-rhel-5.html" rel="bookmark"><h1>HP Proliant Support Pack sur RHEL 5</h1></a>
                    </header>

                    <section class="post-content">
                        <p>Dans le cadre de mon travail, je suis en train d'installer et de
configurer un serveur HP System Insight Manager (SIM). Une sorte de
Nagios amélioré pour serveur HP, avec anticipation des pannes matériel.</p>
<p>Ce serveur SIM nous a permis par exemple de détecter qu'une pile de
cache RAID était en train de lâcher et nous avons donc pu remplacer
cette pile avant que le problème intervienne (pas de cache RAID = temps
d'accès en écriture tout moisi et ça le fait moyen sur un serveur de
sauvegarde).</p>
<p>Pour que le serveur HPSIM accède aux serveurs qu'il surveille, il faut
installer un agent. Cet agent, c'est HP Proliant Support Pack. Une suite
d'utilitaires et de pilotes pour serveur HP Proliant.</p>
<p>J'ai donc téléchargé l'iso <a class="reference external" href="http://h18004.www1.hp.com/products/servers/service_packs/en/index.html">sur le site
d'HP.&nbsp;</a>Celle
ci contient les utilitaires pour tous les OS supportés (Windows, RedHat,
HP-UX). Une fois l'iso transférée sur le serveur, je la monte :</p>
<pre class="literal-block">
mkdir /media/iso
mount -o loop /tmp/fichier.iso /media/iso
</pre>
<p>Ensuite, c'est l'utilitaire HPSUM qui va s'occuper d'installer les
différents modules et utilitaires.</p>
<pre class="literal-block">
cd /media/iso/hp/swpackages/
./hpsum
</pre>
<p>Cette commande utilise un serveur X.
|  Pour info, la doc complète : <a class="reference external" href="http://bizsupport1.austin.hp.com/bc/docs/support/SupportManual/c03114114/c03114114.pdf">Guide de l'Utilisateur, HP Smart Update
Manager</a></p>
<p>En suivant les étapes une à une, les packages sont tous compilés et
installés.</p>
<div class="section" id="aie">
<h2>Aïe</h2>
<p>Malheureusement, parfois, tout ne tourne pas rond et dans mon cas,
certains paquets n'ont pas pu être compilés. Les logs montrent un obscur
message de problème de dépendance avec ksym.</p>
<p>Pour résoudre ce problème et terminer l'installation des paquets, voici
la procédure ;</p>
<p>Installation des sources :</p>
<pre class="literal-block">
cd /media/iso/hp/swpackages/
rpm -ivh &lt;paquet&gt;.src.rpm
rpmbuild -bb /usr/src/redhat/SPECS/&lt;paquet&gt;.spec
rpm -ivh --nodeps /usr/src/redhat/RPMS/&lt;arch&gt;/&lt;paquet&gt;.rpm
</pre>
<p>On vérifie que le module a bien été installé :</p>
<dl class="docutils">
<dt>::</dt>
<dd>modinfo &lt;nomdumondule&gt;</dd>
</dl>
<p>On charge le module :</p>
<dl class="docutils">
<dt>::</dt>
<dd>modprobe &lt;nomdumodule&gt;</dd>
</dl>
<p>Ce qui donne, avec le paquet qla4xxx qui me concernait :</p>
<pre class="literal-block">
rpm -ivh hp-qla4xxx-&lt;version&gt;.src.rpm
rpmbuild -bb /usr/src/redhat/SPECS/hp-qla4xxx.spec
rpm -ivh --nodeps /usr/src/redhat/RPMS/x86_64/kmod-hp-qla4xxx-&lt;version&gt;-x86_64.rpm
modprobe qla4xxx
</pre>
</div>
<div class="section" id="explication">
<h2>Explication</h2>
<p>Les RPM utilisent les dépendances de KMP (Kernel Module Packaging) pour
s'assurer que les binaires RPM puissent être installés. Red Hat
maintient une liste blanche de&nbsp;<em>kernel symbols</em> (ksym donc) que les
RPM utilisent. Certains de ses symboles peuvent être dans le kernel mais
pas dans la liste blanche. Le résultat est que certains RPM, qui y font
référence, ne peuvent pas être installés.</p>
<p>L'utilisateur doit donc utiliser l'option &quot;--nodeps&quot; lors de
l'installation des binaires.</p>
<p>La paquet qla4xxx utilisent les symboles suivant sur RHEL 5 qui ne sont
pas dans la liste blanche ;</p>
<p>ksym(kobject_uevent_env) ksym(iscsi2_session_chkready)
ksym(pci_get_domain_bus_and_slot)</p>
</div>

                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="../../category/tech.html">Tech</a></p>
                        <p>Tags: <a href="../../tag/hpsim.html">HPSIM</a>, <a href="../../tag/hpsum.html">hpsum</a>, <a href="../../tag/insight-manager.html">insight manager</a>, <a href="../../tag/ksym.html">ksym</a>, <a href="../../tag/proliant-support-pack.html">proliant support pack</a>, <a href="../../tag/psp.html">psp</a>, <a href="../../tag/redhat.html">redhat</a>, </p>
                    </aside>
                    <hr/>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="../../theme/js/main.js"></script>
    </body>
</html>