<!doctype html>
<html lang="fr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Authentification Wifi iPSK avec Cisco ISE | Aldevar - Le Blog
</title>
  <link rel="canonical" href="../../2022/12/ise-ipsk.html">


  <link rel="stylesheet" href="https://bootswatch.com/4/superhero/bootstrap.css">
  <link rel="stylesheet" href="../../theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="../../theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://blog.devarieux.net/feed/atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://blog.devarieux.net/feed/{slug}.atom.xml">  
  <meta name="description" content="Je vais décrire dans cet article comment configurer Cisco ISE pour authentifier des équipements Wifi sur un réseau en utilisant le protocole RADIUS. Notamment, en fonctions de la PSK utiliser par un client Wifi, nous pourrons lui attribuer un VLAN spécifique. Ces PSK sont nommés iPSK (identity Pre Shared Key …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="../../">
        <img class="img-fluid rounded" src=../../images/avat180.png width=100 height=100 alt="Aldevar - Le Blog">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="../../">Aldevar - Le Blog</a></h1>
      <p class="text-muted">Yet Another Blog</p>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="../../pages/about.html">About</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/aldevar" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-twitter" href="https://twitter.com/landvarx" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-linkedin" href="https://www.linkedin.com/in/alain-devarieux" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-rss" href="../../feed/atom.xml" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Authentification Wifi iPSK avec Cisco ISE
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2022-12-12T08:55:00+01:00">
          <i class="fa fa-clock-o"></i>
          Mon 12 December 2022
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="../../category/tech.html">Tech</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="../../tag/ise.html">#ISE</a>,               <a href="../../tag/wifi.html">#wifi</a>,               <a href="../../tag/meraki.html">#meraki</a>,               <a href="../../tag/security.html">#security</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Je vais décrire dans cet article comment configurer Cisco ISE pour authentifier des équipements Wifi sur un réseau en utilisant le protocole RADIUS. Notamment, en fonctions de la PSK utiliser par un client Wifi, nous pourrons lui attribuer un VLAN spécifique. Ces PSK sont nommés iPSK (identity Pre Shared Key), justement grace au rôle qu'elles peuvent avoir dans l'attribution de l'identité de l'équipement, permettant de le placer dans le VLAN adequat.</p>
<p>Cisco ISE (Identity Service Engine) est une appliance proposant un grand nombre de fonctionnalités de sécurité. Il peut authentifier les utilisateurs sur le réseau (Wifi, câble ou VPN), il gère le contrôle d'accès, les politiques de groupe et peut également faire du device posturing (s'assurer qu'un équipement est à jour et que son anti-virus est activé avant de lui donner accès au réseau). Les fonctionnalités sont assez complètes et son utilisation demande une certaine expertise.</p>
<p>Pour cet article, le réseau Wifi sur lequel on s'appuit est un réseau Meraki mais je ne doute pas que le fonctionnement doit être grandement similaire avec d'autres constructeurs.</p>
<div class="section" id="configuration-meraki">
<h2>Configuration Meraki</h2>
<p>La configuration du SSID se fait dans le menu Wireless &gt; Access Control en choisissant le SSID cible dans le menu déroulant en haut de la page.</p>
<div class="section" id="network-access">
<h3>Network Access</h3>
<p>Cette section permet de choisir le mode d'association des équipements. L'option à choisir ici est Identity PSK with Radius. Le chiffrement se fait en WPA2. Si vous avez plusieurs bornes, je vous invite à activer le mode 802.11r (fast-transition) qui améliore les performances lors du roaming.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK01.png" />
</div>
<div class="section" id="splash-page">
<h3>Splash Page</h3>
<p>Nous n'utilisons pas de Splash Page sur ce SSID. Une fois associé et authentifié, l'accès au réseau se fait directement.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK02.png" />
</div>
<div class="section" id="configuration-radius">
<h3>Configuration Radius</h3>
<p>Lors du choix IPSK with Radius dans la section 'Network Access', une nouvelle section dédiée à la configuration Radius apparaît.
On entre les adresses des serveurs Radius, ports et secrets. RADIUS testing est désactivé et le support de CoA est activé. Les serveurs Radius accounting sont activés et paramétrés.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK03.png" />
</div>
<div class="section" id="assignement-de-l-ip">
<h3>Assignement de l'IP</h3>
<p>L'assignement de l'adresse IP de l'équipement se fait en mode Bridge. Les équipements se retrouvent sur le VLAN qui leur est assigné et peuvent recevoir une IP en DHCP via, par exemple, le serveur Cisco ISE.
Le VLAN tagging est activé avec un VLAN par défaut (ici XXX).</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK04.png" />
</div>
</div>
<div class="section" id="configuration-cisco-ise">
<h2>Configuration Cisco ISE</h2>
<p>Voici le flux de données lors d'une authentification iPSK sur un serveur Cisco ISE. Cette image est directement extraite de la documentation officielle Meraki.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK05.png" />
<div class="section" id="ajout-des-ap-et-assignation-a-un-groupe">
<h3>Ajout des AP et assignation à un groupe</h3>
<p>Sur ISE, aller dans Administration &gt; Network Ressources &gt; Network Devices et cliquer sur Add</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK06.png" />
<p>Remplir les champs pour l'AP à intégrer : Nom de l'AP et adresse IP.</p>
<p>Créer une nouvelle <cite>Location</cite> du nom du lieu où sont placées les AP (par exemple Headquarter ou Agence_Rennes) et un <cite>device type</cite> MR. Ce device type permettra d'y placer l'ensemble des AP de type Meraki MR.
La localisation &quot;Headquarters&quot; va permettre de faire correspondre l'authentification des clients avec la bonne Policy Set (jeu de politique), que l'on verra plus tard.</p>
<p>Cocher Radius Authentication Settings et paramétrer un secret pour ce serveur Radius. Ce secret est celui utilisé dans la configuration Radius du SSID sur Meraki.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK07.png" />
</div>
<div class="section" id="creer-une-policy-set">
<h3>Créer une Policy Set</h3>
<p>Créer une nouvelle Policy Set avec la condition <strong>Device&gt;Location</strong> et sélectionner la localisation Headquarter créée précédemment. Ajouter une seconde condition <strong>Radius &gt; Called-Station-ID Ends_With &quot;Nom_du_SSID&quot;</strong>.</p>
<p>J'insiste sur le fait de bien mettre la condition &quot;Ends_With&quot; et nom &quot;Equals&quot; car lors de l'authentification Radius, le nom du SSID envoyé par MEraki sera précédé d'autres informations. En mettant &quot;Equals&quot; l'authentification ne peut pas fonctionner.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK08.png" />
<p>Sauvegarder puis se rendre dans la policy en utilisant la flèche à l'extrémité droite. Aller dans <strong>Authentication Policy</strong> et paramétrer la règle comme ci-dessous. S'assurer que le menu déroulant est bien positionné sur <strong>Internal Endpoints</strong> et que l'option <strong>If User not found Continue</strong> est bien sélectionnée. Cette option permet de continuer à vérifier l'authentification d’un équipement qui ne serait pas valide sur cette policy.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK09.png" />
<p>Se rendre ensuite dans <strong>Authorization Policy</strong>. Sur la règle par défaut, supprimer <em>Deny Access</em> et cliquer sur l'icône + pour créer un nouveau profil avec les paramètres ci-dessous.
Dans <strong>Advanced Attributes</strong>, sélectionner <strong>Radius:Tunnel-Password</strong>. Entrer la PSK utilisée par défaut sur ce SSID puis sauvegarder.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK10.png" />
<p>Sélectionner ce profil dans la règle par défaut puis sauvegarder.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK11.png" />
</div>
<div class="section" id="creer-un-identity-group">
<h3>Créer un Identity Group</h3>
<p>Aller dans <strong>Work Center &gt; Guest Access &gt; Id Group</strong>.
Cliquer sur <strong>Add</strong> pour ajouter un nouveau groupe qui contiendra les équipements autorisé à s'authentifier sur le réseau Wifi.</p>
</div>
<div class="section" id="creer-une-policy-set-pour-chaque-psk">
<h3>Créer une Policy Set pour chaque PSK</h3>
<p>A partir de maintenant, nous pouvons créer une Policy Set pour chaque groupe d'équipement qui utilisera sa propre iPSK. Chaque iPSK identifiera un type d'équipement et le VLAN sur lequel il sera placé.</p>
<p>Ici, nous allons créer la policy set pour le VLAN de bureautique (VLAN 84).
Aller dans <strong>Policy &gt; Policy Elements &gt; Results &gt; Authorization &gt; Authorization Profiles</strong>. Cliquer sur <strong>Add</strong> et créer un nouveau profil. C’est celui-ci qui sera utilisé pour surcharger le VLAN par défaut si besoin.
Les champs importants sont :
- Nom du profil
- Common Tasks &gt; VLAN &gt; 84
- Advances Attributes Settings &gt; Radius:Tunnel-Password ⇒ Entrer la PSK pour les équipements de bureautique (PC portable en général).</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK12.png" />
<p>Aller ensuite dans <strong>Policy &gt; Policy Sets</strong> et éditer la Policy Set créée précédemment. Dans la section <strong>Authorization Rules</strong> ajouter une nouvelle règle au-dessus de la règle par défaut.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK13.png" />
<p>Nommer cette règle et lui appliquer la condition suivante, en choissant le groupe créé dans la section <strong>Créer un Identity Group</strong> :</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK14.png" />
<p>Appliquer ensuite le profil d'autorisation PSK1 créé en juste au-dessus et sauvegarder.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK15.png" />
</div>
<div class="section" id="ajouter-des-euipements-au-groupe">
<h3>Ajouter des éuipements au groupe</h3>
<p>Aller dans <strong>Context Visibility &gt; Endpoints</strong>.
Ajouter un nouvel équipement en prenant soin de l placer dans le groupe créer précédement.</p>
<img alt="" class="align-center" src="/images/2022-12-12-ISEiPSK16.png" />
<p>Cette technique d'authentification permet donc de placer les équipements/utilisateurs sur des VLANs différents en fonction de la PSK utilisée, sans créer un SSID différent pour chaque VLAN.</p>
<p>En effet, il est déconseillé de diffuser plus de 5 SSID par AP ou par zone afin de limiter les interférences et optimiser la qualité du signal, notamment lorsqu'on souhaite y faire transiter de la voix et/ou faire du roaming. Grâce à iPSK, nous pouvons segmenter les utilisateurs dans différents VLAN en limitant le nombre de SSID diffusé.</p>
</div>
</div>

    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="../../archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="../../categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="../../tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>